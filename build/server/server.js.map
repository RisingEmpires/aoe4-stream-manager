{"version":3,"file":"server.js","mappings":"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","sources":["webpack://nodecg/./scripts/warn-engines.js","webpack://nodecg/./src/server/api.server.ts","webpack://nodecg/./src/server/assets/AssetFile.ts","webpack://nodecg/./src/server/assets/index.ts","webpack://nodecg/./src/server/bootstrap.ts","webpack://nodecg/./src/server/bundle-manager.ts","webpack://nodecg/./src/server/bundle-parser/assets.ts","webpack://nodecg/./src/server/bundle-parser/config.ts","webpack://nodecg/./src/server/bundle-parser/extension.ts","webpack://nodecg/./src/server/bundle-parser/git.ts","webpack://nodecg/./src/server/bundle-parser/graphics.ts","webpack://nodecg/./src/server/bundle-parser/index.ts","webpack://nodecg/./src/server/bundle-parser/manifest.ts","webpack://nodecg/./src/server/bundle-parser/mounts.ts","webpack://nodecg/./src/server/bundle-parser/panels.ts","webpack://nodecg/./src/server/bundle-parser/sounds.ts","webpack://nodecg/./src/server/config/index.ts","webpack://nodecg/./src/server/config/loader.ts","webpack://nodecg/./src/server/dashboard/index.ts","webpack://nodecg/./src/server/database/datasource.ts","webpack://nodecg/./src/server/database/entity/ApiKey.ts","webpack://nodecg/./src/server/database/entity/Identity.ts","webpack://nodecg/./src/server/database/entity/Permission.ts","webpack://nodecg/./src/server/database/entity/Replicant.ts","webpack://nodecg/./src/server/database/entity/Role.ts","webpack://nodecg/./src/server/database/entity/Session.ts","webpack://nodecg/./src/server/database/entity/User.ts","webpack://nodecg/./src/server/database/entity/index.ts","webpack://nodecg/./src/server/database/index.ts","webpack://nodecg/./src/server/database/utils.ts","webpack://nodecg/./src/server/graphics/index.ts","webpack://nodecg/./src/server/graphics/registration.ts","webpack://nodecg/./src/server/logger/index.ts","webpack://nodecg/./src/server/logger/logger.server.ts","webpack://nodecg/./src/server/login/UnauthorizedError.ts","webpack://nodecg/./src/server/login/index.ts","webpack://nodecg/./src/server/login/socketAuthMiddleware.ts","webpack://nodecg/./src/server/mounts.ts","webpack://nodecg/./src/server/replicant/replicator.ts","webpack://nodecg/./src/server/replicant/schema-hacks.ts","webpack://nodecg/./src/server/replicant/server-replicant.ts","webpack://nodecg/./src/server/server/extensions.ts","webpack://nodecg/./src/server/server/index.ts","webpack://nodecg/./src/server/server/socketApiMiddleware.ts","webpack://nodecg/./src/server/shared-sources.ts","webpack://nodecg/./src/server/sounds.ts","webpack://nodecg/./src/server/util/authcheck.ts","webpack://nodecg/./src/server/util/debounce-name.ts","webpack://nodecg/./src/server/util/exit-hook.ts","webpack://nodecg/./src/server/util/index.ts","webpack://nodecg/./src/server/util/injectscripts.ts","webpack://nodecg/./src/server/util/isChildOf.ts","webpack://nodecg/./src/server/util/noop.ts","webpack://nodecg/./src/server/util/pjson.ts","webpack://nodecg/./src/server/util/sendFile.ts","webpack://nodecg/./src/server/util/sentry-config.ts","webpack://nodecg/./src/server/util/throttle-name.ts","webpack://nodecg/./src/shared/api.base.ts","webpack://nodecg/./src/shared/logger-interface.ts","webpack://nodecg/./src/shared/replicants.shared.ts","webpack://nodecg/./src/shared/typed-emitter.ts","webpack://nodecg/./src/shared/utils/compileJsonSchema.ts","webpack://nodecg/./src/shared/utils/index.ts","webpack://nodecg/./src/shared/utils/rootPath.ts","webpack://nodecg/./src/types/socket-protocol.ts","webpack://nodecg/./src/server/server/ sync","webpack://nodecg/external commonjs \"@nodecg/json-schema-defaults\"","webpack://nodecg/external commonjs \"@sentry/node\"","webpack://nodecg/external commonjs \"ajv\"","webpack://nodecg/external commonjs \"ajv-draft-04\"","webpack://nodecg/external commonjs \"ajv-formats\"","webpack://nodecg/external commonjs \"ajv/dist/2019\"","webpack://nodecg/external commonjs \"ajv/dist/2020\"","webpack://nodecg/external commonjs \"body-parser\"","webpack://nodecg/external commonjs \"cheerio\"","webpack://nodecg/external commonjs \"chokidar\"","webpack://nodecg/external commonjs \"clone\"","webpack://nodecg/external commonjs \"compression\"","webpack://nodecg/external commonjs \"connect-typeorm\"","webpack://nodecg/external commonjs \"cookie-parser\"","webpack://nodecg/external commonjs \"cosmiconfig\"","webpack://nodecg/external commonjs \"events\"","webpack://nodecg/external commonjs \"express\"","webpack://nodecg/external commonjs \"express-session\"","webpack://nodecg/external commonjs \"express-transform-bare-module-specifiers\"","webpack://nodecg/external commonjs \"extend\"","webpack://nodecg/external commonjs \"fast-memoize\"","webpack://nodecg/external commonjs \"fs-extra\"","webpack://nodecg/external commonjs \"git-rev-sync\"","webpack://nodecg/external commonjs \"httpolyglot\"","webpack://nodecg/external commonjs \"is-error\"","webpack://nodecg/external commonjs \"joi\"","webpack://nodecg/external commonjs \"json-ptr\"","webpack://nodecg/external commonjs \"json-schema-lib\"","webpack://nodecg/external commonjs \"json-schema-lib/lib/util/stripHash\"","webpack://nodecg/external commonjs \"json-schema-lib/lib/util/typeOf\"","webpack://nodecg/external commonjs \"lodash.debounce\"","webpack://nodecg/external commonjs \"lodash.template\"","webpack://nodecg/external commonjs \"multer\"","webpack://nodecg/external commonjs \"node-fetch-commonjs\"","webpack://nodecg/external commonjs \"object-path\"","webpack://nodecg/external commonjs \"passport\"","webpack://nodecg/external commonjs \"passport-discord\"","webpack://nodecg/external commonjs \"passport-local\"","webpack://nodecg/external commonjs \"passport-steam\"","webpack://nodecg/external commonjs \"passport-twitch-helix\"","webpack://nodecg/external commonjs \"reflect-metadata\"","webpack://nodecg/external commonjs \"semver\"","webpack://nodecg/external commonjs \"serialize-error\"","webpack://nodecg/external commonjs \"sha1\"","webpack://nodecg/external commonjs \"sha1-file\"","webpack://nodecg/external commonjs \"socket.io\"","webpack://nodecg/external commonjs \"typeorm\"","webpack://nodecg/external commonjs \"util\"","webpack://nodecg/external commonjs \"uuid\"","webpack://nodecg/external commonjs \"winston\"","webpack://nodecg/external commonjs \"yargs\"","webpack://nodecg/external node-commonjs \"crypto\"","webpack://nodecg/external node-commonjs \"fs\"","webpack://nodecg/external node-commonjs \"http\"","webpack://nodecg/external node-commonjs \"https\"","webpack://nodecg/external node-commonjs \"node:process\"","webpack://nodecg/external node-commonjs \"os\"","webpack://nodecg/external node-commonjs \"path\"","webpack://nodecg/webpack/bootstrap","webpack://nodecg/webpack/runtime/hasOwnProperty shorthand","webpack://nodecg/webpack/before-startup","webpack://nodecg/webpack/startup","webpack://nodecg/webpack/after-startup"],"sourcesContent":["const semver = require('semver');\n\nif (!semver.satisfies(process.versions.node, '^16 || ^18')) {\n\tconsole.warn(\n\t\t`WARNING: Unsupported Node.js version v${process.versions.node}. NodeCG may not function as expected!`,\n\t);\n}\n","// Packages\nimport express from 'express';\nimport isError from 'is-error';\nimport { serializeError } from 'serialize-error';\nimport type { DeepReadonly } from 'ts-essentials';\n\n// Ours\nimport { NodeCGAPIBase } from '../shared/api.base';\nimport type { Replicator, ServerReplicant } from './replicant';\nimport { config } from './config';\nimport { Logger } from './logger';\nimport * as ncgUtils from './util';\nimport type { RootNS } from '../types/socket-protocol';\nimport type { NodeCG } from '../types/nodecg';\nimport type { ExtensionEventMap } from './server/extensions';\n\nexport default (io: RootNS, replicator: Replicator, extensions: Record<string, unknown>, mount: NodeCG.Middleware) => {\n\tconst apiContexts = new Set<NodeCGAPIBase<'server', NodeCG.Bundle.UnknownConfig, ExtensionEventMap>>();\n\n\t/**\n\t * This is what enables intra-context messaging.\n\t * I.e., passing messages from one extension to another in the same Node.js context.\n\t */\n\tfunction _forwardMessageToContext(messageName: string, bundleName: string, data: unknown): void {\n\t\tprocess.nextTick(() => {\n\t\t\tapiContexts.forEach((ctx) => {\n\t\t\t\tctx._messageHandlers.forEach((handler) => {\n\t\t\t\t\tif (messageName === handler.messageName && bundleName === handler.bundleName) {\n\t\t\t\t\t\thandler.func(data);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\treturn class NodeCGAPIServer<C extends Record<string, any> = NodeCG.Bundle.UnknownConfig> extends NodeCGAPIBase<\n\t\t'server',\n\t\tC,\n\t\tExtensionEventMap\n\t> {\n\t\tstatic sendMessageToBundle(messageName: string, bundleName: string, data?: unknown): void {\n\t\t\t_forwardMessageToContext(messageName, bundleName, data);\n\t\t\tio.emit('message', {\n\t\t\t\tbundleName,\n\t\t\t\tmessageName,\n\t\t\t\tcontent: data,\n\t\t\t});\n\t\t}\n\n\t\tstatic readReplicant<T = unknown>(name: string, namespace: string): T | undefined {\n\t\t\tif (!name || typeof name !== 'string') {\n\t\t\t\tthrow new Error('Must supply a name when reading a Replicant');\n\t\t\t}\n\n\t\t\tif (!namespace || typeof namespace !== 'string') {\n\t\t\t\tthrow new Error('Must supply a namespace when reading a Replicant');\n\t\t\t}\n\n\t\t\tconst replicant = replicator.declare(name, namespace);\n\t\t\treturn replicant.value as T | undefined;\n\t\t}\n\n\t\tstatic Replicant<V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>>(\n\t\t\tname: string,\n\t\t\tnamespace: string,\n\t\t\topts: O,\n\t\t): ServerReplicant<V, O> {\n\t\t\tif (!name || typeof name !== 'string') {\n\t\t\t\tthrow new Error('Must supply a name when reading a Replicant');\n\t\t\t}\n\n\t\t\tif (!namespace || typeof namespace !== 'string') {\n\t\t\t\tthrow new Error('Must supply a namespace when reading a Replicant');\n\t\t\t}\n\n\t\t\treturn replicator.declare(name, namespace, opts);\n\t\t}\n\n\t\tget Logger(): new (name: string) => NodeCG.Logger {\n\t\t\treturn Logger;\n\t\t}\n\n\t\tget log(): NodeCG.Logger {\n\t\t\tif (this._memoizedLogger) {\n\t\t\t\treturn this._memoizedLogger;\n\t\t\t}\n\n\t\t\tthis._memoizedLogger = new Logger(this.bundleName);\n\t\t\treturn this._memoizedLogger;\n\t\t}\n\n\t\t/**\n\t\t * The full NodeCG server config, including potentially sensitive keys.\n\t\t */\n\t\tget config(): DeepReadonly<typeof config> {\n\t\t\treturn JSON.parse(JSON.stringify(config));\n\t\t}\n\n\t\t/**\n\t\t * _Extension only_<br/>\n\t\t * Creates a new express router.\n\t\t * See the [express docs](http://expressjs.com/en/api.html#express.router) for usage.\n\t\t * @function\n\t\t */\n\t\treadonly Router = express.Router;\n\n\t\tutil = {\n\t\t\t/**\n\t\t\t * _Extension only_<br/>\n\t\t\t * Checks if a session is authorized. Intended to be used in express routes.\n\t\t\t * @param {object} req - A HTTP request.\n\t\t\t * @param {object} res - A HTTP response.\n\t\t\t * @param {function} next - The next middleware in the control flow.\n\t\t\t */\n\t\t\tauthCheck: ncgUtils.authCheck,\n\t\t};\n\n\t\t/**\n\t\t * _Extension only_<br/>\n\t\t * Object containing references to all other loaded extensions. To access another bundle's extension,\n\t\t * it _must_ be declared as a `bundleDependency` in your bundle's [`package.json`]{@tutorial manifest}.\n\t\t * @name NodeCG#extensions\n\t\t *\n\t\t * @example\n\t\t * // bundles/my-bundle/package.json\n\t\t * {\n\t\t *     \"name\": \"my-bundle\"\n\t\t *     ...\n\t\t *     \"bundleDependencies\": {\n\t\t *         \"other-bundle\": \"^1.0.0\"\n\t\t *     }\n\t\t * }\n\t\t *\n\t\t * // bundles/my-bundle/extension.js\n\t\t * module.exports = function (nodecg) {\n\t\t *     const otherBundle = nodecg.extensions['other-bundle'];\n\t\t *     // Now I can use `otherBundle`!\n\t\t * }\n\t\t */\n\t\tget extensions(): Record<string, unknown> {\n\t\t\treturn extensions;\n\t\t}\n\n\t\t/**\n\t\t * _Extension only_<br/>\n\t\t * Mounts express middleware to the main server express app.\n\t\t * See the [express docs](http://expressjs.com/en/api.html#app.use) for usage.\n\t\t * @function\n\t\t */\n\t\tmount = mount;\n\n\t\t_memoizedLogger?: NodeCG.Logger;\n\n\t\tconstructor(bundle: NodeCG.Bundle) {\n\t\t\tsuper(bundle);\n\t\t\tapiContexts.add(this);\n\t\t\tio.on('connection', (socket) => {\n\t\t\t\tsocket.on('message', (data, ack) => {\n\t\t\t\t\tconst wrappedAck = _wrapAcknowledgement(ack);\n\t\t\t\t\tthis._messageHandlers.forEach((handler) => {\n\t\t\t\t\t\tif (data.messageName === handler.messageName && data.bundleName === handler.bundleName) {\n\t\t\t\t\t\t\thandler.func(data.content, wrappedAck);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * _Extension only_<br/>\n\t\t * Gets the server Socket.IO context.\n\t\t * @function\n\t\t */\n\t\treadonly getSocketIOServer = (): RootNS => io;\n\n\t\t/**\n\t\t * Sends a message to a specific bundle. Also available as a static method.\n\t\t * See {@link NodeCG#sendMessage} for usage details.\n\t\t * @param {string} messageName - The name of the message.\n\t\t * @param {string} bundleName - The name of the target bundle.\n\t\t * @param {mixed} [data] - The data to send.\n\t\t * @param {function} [cb] - _Browser only_ The error-first callback to handle the server's\n\t\t * [acknowledgement](http://socket.io/docs/#sending-and-getting-data-%28acknowledgements%29) message, if any.\n\t\t * @return {Promise|undefined} - _Browser only_ A Promise that is rejected if the first argument provided to the\n\t\t * acknowledgement is an `Error`, otherwise it is resolved with the remaining arguments provided to the acknowledgement.\n\t\t * But, if a callback was provided, this return value will be `undefined`, and there will be no Promise.\n\t\t */\n\t\tsendMessageToBundle(messageName: string, bundleName: string, data?: unknown): void {\n\t\t\tthis.log.trace('Sending message %s to bundle %s with data:', messageName, bundleName, data);\n\t\t\t// eslint-disable-next-line prefer-rest-params,@typescript-eslint/no-confusing-void-expression\n\t\t\treturn NodeCGAPIServer.sendMessageToBundle.apply(NodeCGAPIBase, arguments as any);\n\t\t}\n\n\t\t/**\n\t\t * Sends a message with optional data within the current bundle.\n\t\t * Messages can be sent from client to server, server to client, or client to client.\n\t\t *\n\t\t * Messages are namespaced by bundle. To send a message in another bundle's namespace,\n\t\t * use {@link NodeCG#sendMessageToBundle}.\n\t\t *\n\t\t * When a `sendMessage` is used from a client context (i.e., graphic or dashboard panel),\n\t\t * it returns a `Promise` called an \"acknowledgement\". Your server-side code (i.e., extension)\n\t\t * can invoke this acknowledgement with whatever data (or error) it wants. Errors sent to acknowledgements\n\t\t * from the server will be properly serialized and intact when received on the client.\n\t\t *\n\t\t * Alternatively, if you do not wish to use a `Promise`, you can provide a standard error-first\n\t\t * callback as the last argument to `sendMessage`.\n\t\t *\n\t\t * If your server-side code has multiple listenFor handlers for your message,\n\t\t * you must first check if the acknowledgement has already been handled before\n\t\t * attempting to call it. You may so do by checking the `.handled` boolean\n\t\t * property of the `ack` function passed to your listenFor handler.\n\t\t *\n\t\t * See [Socket.IO's docs](http://socket.io/docs/#sending-and-getting-data-%28acknowledgements%29)\n\t\t * for more information on how acknowledgements work under the hood.\n\t\t *\n\t\t * @param {string} messageName - The name of the message.\n\t\t * @param {mixed} [data] - The data to send.\n\t\t * @param {function} [cb] - _Browser only_ The error-first callback to handle the server's\n\t\t * [acknowledgement](http://socket.io/docs/#sending-and-getting-data-%28acknowledgements%29) message, if any.\n\t\t * @return {Promise} - _Browser only_ A Promise that is rejected if the first argument provided to the\n\t\t * acknowledgement is an `Error`, otherwise it is resolved with the remaining arguments provided to the acknowledgement.\n\t\t *\n\t\t * @example <caption>Sending a normal message:</caption>\n\t\t * nodecg.sendMessage('printMessage', 'dope.');\n\t\t *\n\t\t * @example <caption>Sending a message and replying with an acknowledgement:</caption>\n\t\t * // bundles/my-bundle/extension.js\n\t\t * module.exports = function (nodecg) {\n\t\t *     nodecg.listenFor('multiplyByTwo', (value, ack) => {\n\t\t *         if (value === 4) {\n\t\t *             ack(new Error('I don\\'t like multiplying the number 4!');\n\t\t *             return;\n\t\t *         }\n\t\t *\n\t\t *         // acknowledgements should always be error-first callbacks.\n\t\t *         // If you do not wish to send an error, send \"null\"\n\t\t *         if (ack && !ack.handled) {\n\t\t *             ack(null, value * 2);\n\t\t *         }\n\t\t *     });\n\t\t * }\n\t\t *\n\t\t * // bundles/my-bundle/graphics/script.js\n\t\t * // Both of these examples are functionally identical.\n\t\t *\n\t\t * // Promise acknowledgement\n\t\t * nodecg.sendMessage('multiplyByTwo', 2)\n\t\t *     .then(result => {\n\t\t *         console.log(result); // Will eventually print '4'\n\t\t *     .catch(error => {\n\t\t *         console.error(error);\n\t\t *     });\n\t\t *\n\t\t * // Error-first callback acknowledgement\n\t\t * nodecg.sendMessage('multiplyByTwo', 2, (error, result) => {\n\t\t *     if (error) {\n\t\t *         console.error(error);\n\t\t *         return;\n\t\t *     }\n\t\t *\n\t\t *     console.log(result); // Will eventually print '4'\n\t\t * });\n\t\t */\n\t\tsendMessage(messageName: string, data?: unknown): void {\n\t\t\tthis.sendMessageToBundle(messageName, this.bundleName, data);\n\t\t}\n\n\t\t/**\n\t\t * Reads the value of a replicant once, and doesn't create a subscription to it. Also available as a static method.\n\t\t * @param {string} name - The name of the replicant.\n\t\t * @param {string} [bundle=CURR_BNDL] - The bundle namespace to in which to look for this replicant.\n\t\t * @param {function} cb - _Browser only_ The callback that handles the server's response which contains the value.\n\t\t * @example <caption>From an extension:</caption>\n\t\t * // Extensions have immediate access to the database of Replicants.\n\t\t * // For this reason, they can use readReplicant synchronously, without a callback.\n\t\t * module.exports = function (nodecg) {\n\t\t *     var myVal = nodecg.readReplicant('myVar', 'some-bundle');\n\t\t * }\n\t\t * @example <caption>From a graphic or dashboard panel:</caption>\n\t\t * // Graphics and dashboard panels must query the server to retrieve the value,\n\t\t * // and therefore must provide a callback.\n\t\t * nodecg.readReplicant('myRep', 'some-bundle', value => {\n\t\t *     // I can use 'value' now!\n\t\t *     console.log('myRep has the value '+ value +'!');\n\t\t * });\n\t\t */\n\t\treadReplicant<T = unknown>(name: string, param2?: string | NodeCG.Bundle): T | undefined {\n\t\t\tlet { bundleName } = this;\n\t\t\tif (typeof param2 === 'string') {\n\t\t\t\tbundleName = param2;\n\t\t\t} else if (typeof param2 === 'object' && bundleName in param2) {\n\t\t\t\tbundleName = param2.name;\n\t\t\t}\n\n\t\t\treturn (this.constructor as any).readReplicant(name, bundleName);\n\t\t}\n\n\t\t_replicantFactory = <V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>>(\n\t\t\tname: string,\n\t\t\tnamespace: string,\n\t\t\topts: O,\n\t\t): ServerReplicant<V, O> => replicator.declare<V, O>(name, namespace, opts);\n\t};\n};\n\n/**\n * By default, Errors get serialized to empty objects when run through JSON.stringify.\n * This function wraps an \"acknowledgement\" callback and checks if the first argument\n * is an Error. If it is, that Error is serialized _before_ being sent off to Socket.IO\n * for serialization to be sent across the wire.\n * @param ack {Function}\n * @private\n * @ignore\n * @returns {Function}\n */\nfunction _wrapAcknowledgement(ack: (err?: any, response?: unknown) => void): NodeCG.Acknowledgement {\n\tlet handled = false;\n\tconst wrappedAck = function (firstArg: any, ...restArgs: any[]): void {\n\t\tif (handled) {\n\t\t\tthrow new Error('Acknowledgement already handled');\n\t\t}\n\n\t\thandled = true;\n\t\tif (isError(firstArg)) {\n\t\t\tfirstArg = serializeError(firstArg);\n\t\t}\n\n\t\tack(firstArg, ...restArgs);\n\t};\n\n\tObject.defineProperty(wrappedAck, 'handled', {\n\t\tget() {\n\t\t\treturn handled;\n\t\t},\n\t});\n\n\treturn wrappedAck as NodeCG.Acknowledgement;\n}\n","// Native\nimport * as path from 'path';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nconst ASSETS_ROOT = path.join(process.env.NODECG_ROOT, 'assets');\n\nexport default class AssetFile implements NodeCG.AssetFile {\n\tsum: string;\n\n\tbase: string;\n\n\text: string;\n\n\tname: string;\n\n\tnamespace: string;\n\n\tcategory: string;\n\n\turl: string;\n\n\tconstructor(filepath: string, sum: string) {\n\t\tconst parsedPath = path.parse(filepath);\n\t\tconst parts = parsedPath.dir.replace(ASSETS_ROOT + path.sep, '').split(path.sep);\n\n\t\tthis.sum = sum;\n\t\tthis.base = parsedPath.base;\n\t\tthis.ext = parsedPath.ext;\n\t\tthis.name = parsedPath.name;\n\t\tthis.namespace = parts[0];\n\t\tthis.category = parts[1];\n\t\tthis.url = `/assets/${this.namespace}/${this.category}/${encodeURIComponent(this.base)}`;\n\t}\n}\n","// Native\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Packages\nimport express from 'express';\nimport chokidar from 'chokidar';\nimport multer from 'multer';\nimport sha1File from 'sha1-file';\n\n// Ours\nimport AssetFile from './AssetFile';\nimport { authCheck, debounceName, sendFile } from '../util';\nimport createLogger from '../logger';\nimport type Replicator from '../replicant/replicator';\nimport type ServerReplicant from '../replicant/server-replicant';\nimport type { NodeCG } from '../../types/nodecg';\nimport { stringifyError } from '../../shared/utils';\n\ntype Collection = {\n\tname: string;\n\tcategories: NodeCG.Bundle.AssetCategory[];\n};\n\nexport default class AssetManager {\n\treadonly log = createLogger('assets');\n\n\treadonly assetsRoot = path.join(process.env.NODECG_ROOT, 'assets');\n\n\treadonly collectionsRep: ServerReplicant<Collection[], NodeCG.Replicant.OptionsWithDefault<Collection[]>>;\n\n\treadonly app: ReturnType<typeof express>;\n\n\tprivate readonly _repsByNamespace = new Map<\n\t\tstring,\n\t\tMap<string, ServerReplicant<AssetFile[], NodeCG.Replicant.OptionsWithDefault<AssetFile[]>>>\n\t>();\n\n\tprivate readonly _replicator: Replicator;\n\n\tconstructor(bundles: NodeCG.Bundle[], replicator: Replicator) {\n\t\tthis._replicator = replicator;\n\n\t\t// Create assetsRoot folder if it does not exist.\n\t\t/* istanbul ignore next: Simple directory creation. */\n\t\tif (!fs.existsSync(this.assetsRoot)) {\n\t\t\tfs.mkdirSync(this.assetsRoot);\n\t\t}\n\n\t\tthis.collectionsRep = replicator.declare<Collection[]>('collections', '_assets', {\n\t\t\tdefaultValue: [],\n\t\t\tpersistent: false,\n\t\t});\n\n\t\tconst { watchPatterns } = this._computeCollections(bundles);\n\t\tthis._setupWatcher(watchPatterns);\n\t\tthis.app = this._setupExpress();\n\t}\n\n\tprivate _computeCollections(bundles: NodeCG.Bundle[]): { collections: Collection[]; watchPatterns: Set<string> } {\n\t\tconst watchPatterns = new Set<string>();\n\t\tconst collections: Collection[] = [];\n\t\tbundles.forEach((bundle) => {\n\t\t\tif (!bundle.hasAssignableSoundCues && (!bundle.assetCategories || bundle.assetCategories.length <= 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If this bundle has sounds && at least one of those sounds is assignable, create the assets:sounds replicant.\n\t\t\tif (bundle.hasAssignableSoundCues) {\n\t\t\t\tbundle.assetCategories.unshift({\n\t\t\t\t\tname: 'sounds',\n\t\t\t\t\ttitle: 'Sounds',\n\t\t\t\t\tallowedTypes: ['mp3', 'ogg'],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcollections.push({\n\t\t\t\tname: bundle.name,\n\t\t\t\tcategories: bundle.assetCategories,\n\t\t\t});\n\t\t});\n\n\t\tcollections.forEach(({ name, categories }) => {\n\t\t\tconst namespacedAssetsPath = this._calcNamespacedAssetsPath(name);\n\t\t\tconst collectionReps = new Map<\n\t\t\t\tstring,\n\t\t\t\tServerReplicant<AssetFile[], NodeCG.Replicant.OptionsWithDefault<AssetFile[]>>\n\t\t\t>();\n\t\t\tthis._repsByNamespace.set(name, collectionReps);\n\t\t\tthis.collectionsRep.value.push({ name, categories });\n\n\t\t\tfor (const category of categories) {\n\t\t\t\t/* istanbul ignore next: Simple directory creation. */\n\t\t\t\tconst categoryPath = path.join(namespacedAssetsPath, category.name);\n\t\t\t\tif (!fs.existsSync(categoryPath)) {\n\t\t\t\t\tfs.mkdirSync(categoryPath);\n\t\t\t\t}\n\n\t\t\t\tcollectionReps.set(\n\t\t\t\t\tcategory.name,\n\t\t\t\t\tthis._replicator.declare<AssetFile[]>(`assets:${category.name}`, name, {\n\t\t\t\t\t\tdefaultValue: [],\n\t\t\t\t\t\tpersistent: false,\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\tif (category.allowedTypes && category.allowedTypes.length > 0) {\n\t\t\t\t\tcategory.allowedTypes.forEach((type) => {\n\t\t\t\t\t\twatchPatterns.add(`${categoryPath}/**/*.${type}`);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\twatchPatterns.add(`${categoryPath}/**/*`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn { collections, watchPatterns };\n\t}\n\n\tprivate _setupWatcher(watchPatterns: Set<string>): void {\n\t\t// Chokidar no longer accepts Windows-style path separators when using globs.\n\t\t// Therefore, we must replace them with Unix-style ones.\n\t\t// See https://github.com/paulmillr/chokidar/issues/777 for more details.\n\t\tconst fixedPaths = Array.from(watchPatterns).map((pattern) => pattern.replace(/\\\\/g, '/'));\n\t\tconst watcher = chokidar.watch(fixedPaths, { ignored: '**/.*' });\n\n\t\t/* When the Chokidar watcher first starts up, it will fire an 'add' event for each file found.\n\t\t * After that, it will emit the 'ready' event.\n\t\t * To avoid thrashing the replicant, we want to add all of these first files at once.\n\t\t * This is what the ready Boolean, deferredFiles Map, and resolveDeferreds function are for.\n\t\t */\n\t\tlet ready = false;\n\t\tconst deferredFiles = new Map<string, AssetFile | undefined>();\n\t\twatcher.on('add', async (filepath) => {\n\t\t\tif (!ready) {\n\t\t\t\tdeferredFiles.set(filepath, undefined);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst sum = await sha1File(filepath);\n\t\t\t\tconst uploadedFile = new AssetFile(filepath, sum);\n\t\t\t\tif (deferredFiles) {\n\t\t\t\t\tdeferredFiles.set(filepath, uploadedFile);\n\t\t\t\t\tthis._resolveDeferreds(deferredFiles);\n\t\t\t\t} else {\n\t\t\t\t\tconst rep = this._getCollectRep(uploadedFile.namespace, uploadedFile.category);\n\t\t\t\t\tif (rep) {\n\t\t\t\t\t\trep.value.push(uploadedFile);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err: unknown) {\n\t\t\t\tif (deferredFiles) {\n\t\t\t\t\tdeferredFiles.delete(filepath);\n\t\t\t\t}\n\n\t\t\t\tthis.log.error(stringifyError(err));\n\t\t\t}\n\t\t});\n\n\t\twatcher.on('ready', () => {\n\t\t\tready = true;\n\t\t});\n\n\t\twatcher.on('change', (filepath) => {\n\t\t\tdebounceName(filepath, async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst sum = await sha1File(filepath);\n\t\t\t\t\tconst newUploadedFile = new AssetFile(filepath, sum);\n\t\t\t\t\tconst rep = this._getCollectRep(newUploadedFile.namespace, newUploadedFile.category);\n\t\t\t\t\tif (!rep) {\n\t\t\t\t\t\tthrow new Error('should have had a replicant here');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst index = rep.value.findIndex((uf) => uf.url === newUploadedFile.url);\n\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\trep.value.splice(index, 1, newUploadedFile);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trep.value.push(newUploadedFile);\n\t\t\t\t\t}\n\t\t\t\t} catch (err: unknown) {\n\t\t\t\t\tthis.log.error(stringifyError(err));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\twatcher.on('unlink', (filepath) => {\n\t\t\tconst deletedFile = new AssetFile(filepath, 'temp');\n\t\t\tconst rep = this._getCollectRep(deletedFile.namespace, deletedFile.category);\n\t\t\tif (!rep) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trep.value.some((assetFile, index) => {\n\t\t\t\tif (assetFile.url === deletedFile.url) {\n\t\t\t\t\trep.value.splice(index, 1);\n\t\t\t\t\tthis.log.debug('\"%s\" was deleted', deletedFile.url);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\twatcher.on('error', (e) => {\n\t\t\tthis.log.error(e.stack);\n\t\t});\n\t}\n\n\tprivate _setupExpress(): ReturnType<typeof express> {\n\t\tconst app = express();\n\t\tconst upload = multer({\n\t\t\tstorage: multer.diskStorage({\n\t\t\t\tdestination: this.assetsRoot,\n\t\t\t\tfilename(req, file, cb) {\n\t\t\t\t\tconst p = req.params as Record<string, string>;\n\t\t\t\t\t// https://github.com/expressjs/multer/issues/1104\n\t\t\t\t\tcb(\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\t`${p.namespace}/${p.category}/${Buffer.from(file.originalname, 'latin1').toString('utf8')}`,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t}),\n\t\t});\n\t\tconst uploader = upload.array('file', 64);\n\n\t\t// Retrieving existing files\n\t\tapp.get(\n\t\t\t'/assets/:namespace/:category/:filePath',\n\n\t\t\t// Check if the user is authorized.\n\t\t\tauthCheck,\n\n\t\t\t// Send the file (or an appropriate error).\n\t\t\t(req, res, next) => {\n\t\t\t\tconst parentDir = this.assetsRoot;\n\t\t\t\tconst fullPath = path.join(parentDir, req.params.namespace, req.params.category, req.params.filePath);\n\t\t\t\tsendFile(parentDir, fullPath, res, next);\n\t\t\t},\n\t\t);\n\n\t\t// Uploading new files\n\t\tapp.post(\n\t\t\t'/assets/:namespace/:category',\n\n\t\t\t// Check if the user is authorized.\n\t\t\tauthCheck,\n\n\t\t\t// Then receive the files they are sending, up to a max of 64.\n\t\t\t(req, res, next) => {\n\t\t\t\tuploader(req, res, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\tres.send(500);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tnext();\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t// Then send a response.\n\t\t\t(req, res) => {\n\t\t\t\tif (req.files) {\n\t\t\t\t\tres.status(200).send('Success');\n\t\t\t\t} else {\n\t\t\t\t\tres.status(400).send('Bad Request');\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\t// Deleting existing files\n\t\tapp.delete(\n\t\t\t'/assets/:namespace/:category/:filename',\n\n\t\t\t// Check if the user is authorized.\n\t\t\tauthCheck,\n\n\t\t\t// Delete the file (or an send appropriate error).\n\t\t\t(req, res) => {\n\t\t\t\tconst { namespace, category, filename } = req.params as Record<string, string>;\n\t\t\t\tconst fullPath = path.join(this.assetsRoot, namespace, category, filename);\n\n\t\t\t\tfs.unlink(fullPath, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tif (err.code === 'ENOENT') {\n\t\t\t\t\t\t\treturn res.status(410).send(`The file to delete does not exist: ${filename}`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.log.error(`Failed to delete file ${fullPath}`, err);\n\t\t\t\t\t\treturn res.status(500).send(`Failed to delete file: ${filename}`);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn res.sendStatus(200);\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\n\t\treturn app;\n\t}\n\n\tprivate _calcNamespacedAssetsPath(namespace: string): string {\n\t\tconst assetsPath = path.join(this.assetsRoot, namespace);\n\t\t/* istanbul ignore next: Simple directory creation. */\n\t\tif (!fs.existsSync(assetsPath)) {\n\t\t\tfs.mkdirSync(assetsPath);\n\t\t}\n\n\t\treturn assetsPath;\n\t}\n\n\tprivate _resolveDeferreds(deferredFiles: Map<string, AssetFile | undefined>): void {\n\t\tlet foundNull = false;\n\t\tdeferredFiles.forEach((uf) => {\n\t\t\tif (uf === null) {\n\t\t\t\tfoundNull = true;\n\t\t\t}\n\t\t});\n\n\t\tif (!foundNull) {\n\t\t\tdeferredFiles.forEach((uploadedFile) => {\n\t\t\t\tif (!uploadedFile) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst rep = this._getCollectRep(uploadedFile.namespace, uploadedFile.category);\n\t\t\t\tif (rep) {\n\t\t\t\t\trep.value.push(uploadedFile);\n\t\t\t\t}\n\t\t\t});\n\t\t\tdeferredFiles.clear();\n\t\t}\n\t}\n\n\tprivate _getCollectRep(\n\t\tnamespace: string,\n\t\tcategory: string,\n\t): ServerReplicant<AssetFile[], NodeCG.Replicant.OptionsWithDefault<AssetFile[]>> | undefined {\n\t\tconst nspReps = this._repsByNamespace.get(namespace);\n\t\tif (nspReps) {\n\t\t\treturn nspReps.get(category);\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n","/**\n * This file is used to automatically bootstrap a NodeCG Server instance.\n * It exports nothing and offers no controls.\n *\n * At this time, other means of starting NodeCG are not officially supported,\n * but they are used internally by our tests.\n *\n * Tests directly instantiate the NodeCGServer class, so that they may have full control\n * over its lifecycle and when the process exits.\n */\n\n// Packages\nimport semver from 'semver';\nimport fetch from 'node-fetch-commonjs';\n\n// Ours\nimport rootPath from '../shared/utils/rootPath';\n\nconst cwd = process.cwd();\nif (cwd !== rootPath.path) {\n\tconsole.warn('[nodecg] process.cwd is %s, expected %s', cwd, rootPath.path);\n\tprocess.chdir(rootPath.path);\n\tconsole.info('[nodecg] Changed process.cwd to %s', rootPath.path);\n}\n\nif (!process.env.NODECG_ROOT) {\n\t// This must happen before we import any of our other application code.\n\tprocess.env.NODECG_ROOT = process.cwd();\n}\n\n// Ours\nimport { pjson, asyncExitHook } from './util';\nimport NodeCGServer from './server';\nimport { gracefulExit } from './util/exit-hook';\n\nprocess.title = 'NodeCG';\nglobal.exitOnUncaught = true;\n\nprocess.title += ` - ${String(pjson.version)}`;\n\nprocess.on('uncaughtException', (err) => {\n\tif (!global.sentryEnabled) {\n\t\tif (global.exitOnUncaught) {\n\t\t\tconsole.error('UNCAUGHT EXCEPTION! NodeCG will now exit.');\n\t\t} else {\n\t\t\tconsole.error('UNCAUGHT EXCEPTION!');\n\t\t}\n\n\t\tconsole.error(err);\n\t\tif (global.exitOnUncaught) {\n\t\t\tgracefulExit(1);\n\t\t}\n\t}\n});\n\nprocess.on('unhandledRejection', (err) => {\n\tif (!global.sentryEnabled) {\n\t\tconsole.error('UNHANDLED PROMISE REJECTION!');\n\t\tconsole.error(err);\n\t}\n});\n\nconst server = new NodeCGServer();\nserver.on('error', () => {\n\tgracefulExit(1);\n});\nserver.on('stopped', () => {\n\tif (!process.exitCode) {\n\t\tgracefulExit(0);\n\t}\n});\nserver.start().catch((error) => {\n\tconsole.error(error);\n\tprocess.nextTick(() => {\n\t\tgracefulExit(1);\n\t});\n});\n\nasyncExitHook(\n\tasync () => {\n\t\tawait server.stop();\n\t},\n\t{\n\t\tminimumWait: 100,\n\t},\n);\n\n// Check for updates\nfetch('https://registry.npmjs.org/nodecg/latest')\n\t.then((res: any) => res.json())\n\t.then((body: any) => {\n\t\tif (semver.gt(body.version, pjson.version)) {\n\t\t\tconsole.warn(\n\t\t\t\t'An update is available for NodeCG: %s (current: %s)',\n\t\t\t\tJSON.parse(body).version,\n\t\t\t\tpjson.version,\n\t\t\t);\n\t\t}\n\t})\n\t.catch(\n\t\t/* istanbul ignore next */ () => {\n\t\t\t// Discard errors.\n\t\t},\n\t);\n","// Native\nimport path from 'path';\n\n// Packages\nimport fs from 'fs-extra';\nimport chokidar from 'chokidar';\nimport debounce from 'lodash.debounce';\nimport semver from 'semver';\nimport { cosmiconfigSync as cosmiconfig } from 'cosmiconfig';\n\n// Ours\nimport parseBundle from './bundle-parser';\nimport parseBundleGit from './bundle-parser/git';\nimport createLogger from './logger';\nimport type { NodeCG } from '../types/nodecg';\nimport { TypedEmitter } from '../shared/typed-emitter';\n\n/**\n * Milliseconds\n */\nconst READY_WAIT_THRESHOLD = 1000;\n\n// Start up the watcher, but don't watch any files yet.\n// We'll add the files we want to watch later, in the init() method.\nconst watcher = chokidar.watch(\n\t[\n\t\t'!**/*___jb_*___', // Ignore temp files created by JetBrains IDEs\n\t\t'!**/node_modules/**', // Ignore node_modules folders\n\t\t'!**/bower_components/**', // Ignore bower_components folders\n\t\t'!**/*.lock', // Ignore lockfiles\n\t],\n\t{\n\t\tpersistent: true,\n\t\tignoreInitial: true,\n\t\tfollowSymlinks: true,\n\t},\n);\n\nconst blacklistedBundleDirectories = ['node_modules', 'bower_components'];\n\nconst bundles: NodeCG.Bundle[] = [];\nconst log = createLogger('bundle-manager');\nconst hasChanged = new Set<string>();\nlet backoffTimer: NodeJS.Timeout | undefined;\n\ntype EventMap = {\n\tbundleRemoved: (bundleName: string) => void;\n\tgitChanged: (bundle: NodeCG.Bundle) => void;\n\tbundleChanged: (reparsedBundle: NodeCG.Bundle) => void;\n\tinvalidBundle: (bundle: NodeCG.Bundle, error: Error) => void;\n\tready: () => void;\n};\n\nexport default class BundleManager extends TypedEmitter<EventMap> {\n\tbundles: NodeCG.Bundle[] = [];\n\n\tget ready() {\n\t\treturn this._ready;\n\t}\n\n\tprivate _ready = false;\n\n\tprivate readonly _cfgPath: string;\n\n\t// This is on a debouncer to avoid false-positives that can happen when editing a manifest.\n\tprivate readonly _debouncedManifestDeletionCheck = debounce((bundleName, manifestPath) => {\n\t\tif (fs.existsSync(manifestPath)) {\n\t\t\tthis.handleChange(bundleName);\n\t\t} else {\n\t\t\tlog.debug('Processing removed event for', bundleName);\n\t\t\tlog.info(\n\t\t\t\t\"%s's package.json can no longer be found on disk, assuming the bundle has been deleted or moved\",\n\t\t\t\tbundleName,\n\t\t\t);\n\t\t\tthis.remove(bundleName);\n\t\t\tthis.emit('bundleRemoved', bundleName);\n\t\t}\n\t}, 100);\n\n\tprivate readonly _debouncedGitChangeHandler = debounce((bundleName) => {\n\t\tconst bundle = this.find(bundleName);\n\t\tif (!bundle) {\n\t\t\treturn;\n\t\t}\n\n\t\tbundle.git = parseBundleGit(bundle.dir);\n\t\tthis.emit('gitChanged', bundle);\n\t}, 250);\n\n\tconstructor(bundlesPaths: string[], cfgPath: string, nodecgVersion: string, nodecgConfig: Record<string, any>) {\n\t\tsuper();\n\n\t\tthis._cfgPath = cfgPath;\n\n\t\tconst readyTimeout = setTimeout(() => {\n\t\t\tthis._ready = true;\n\t\t\tthis.emit('ready');\n\t\t}, READY_WAIT_THRESHOLD);\n\n\t\tbundlesPaths.forEach((bundlesPath) => {\n\t\t\tlog.trace(`Loading bundles from ${bundlesPath}`);\n\n\t\t\t// Create the \"bundles\" dir if it does not exist.\n\t\t\t/* istanbul ignore if: We know this code works and testing it is tedious, so we don't bother to test it. */\n\t\t\tif (!fs.existsSync(bundlesPath)) {\n\t\t\t\tfs.mkdirpSync(bundlesPath);\n\t\t\t}\n\n\t\t\t/* istanbul ignore next */\n\t\t\twatcher.on('add', (filePath) => {\n\t\t\t\tconst bundleName = extractBundleName(bundlesPath, filePath);\n\n\t\t\t\t// In theory, the bundle parser would have thrown an error long before this block would execute,\n\t\t\t\t// because in order for us to be adding a panel HTML file, that means that the file would have been missing,\n\t\t\t\t// which the parser does not allow and would throw an error for.\n\t\t\t\t// Just in case though, its here.\n\t\t\t\tif (this.isPanelHTMLFile(bundleName, filePath)) {\n\t\t\t\t\tthis.handleChange(bundleName);\n\t\t\t\t} else if (isGitData(bundleName, filePath)) {\n\t\t\t\t\tthis._debouncedGitChangeHandler(bundleName);\n\t\t\t\t}\n\n\t\t\t\tif (!this.ready) {\n\t\t\t\t\treadyTimeout.refresh();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twatcher.on('change', (filePath) => {\n\t\t\t\tconst bundleName = extractBundleName(bundlesPath, filePath);\n\n\t\t\t\tif (isManifest(bundleName, filePath) || this.isPanelHTMLFile(bundleName, filePath)) {\n\t\t\t\t\tthis.handleChange(bundleName);\n\t\t\t\t} else if (isGitData(bundleName, filePath)) {\n\t\t\t\t\tthis._debouncedGitChangeHandler(bundleName);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twatcher.on('unlink', (filePath) => {\n\t\t\t\tconst bundleName = extractBundleName(bundlesPath, filePath);\n\n\t\t\t\tif (this.isPanelHTMLFile(bundleName, filePath)) {\n\t\t\t\t\t// This will cause NodeCG to crash, because the parser will throw an error due to\n\t\t\t\t\t// a panel's HTML file no longer being present.\n\t\t\t\t\tthis.handleChange(bundleName);\n\t\t\t\t} else if (isManifest(bundleName, filePath)) {\n\t\t\t\t\tthis._debouncedManifestDeletionCheck(bundleName, filePath);\n\t\t\t\t} else if (isGitData(bundleName, filePath)) {\n\t\t\t\t\tthis._debouncedGitChangeHandler(bundleName);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/* istanbul ignore next */\n\t\t\twatcher.on('error', (error) => {\n\t\t\t\tlog.error(error.stack);\n\t\t\t});\n\n\t\t\t// Do an initial load of each bundle in the \"bundles\" folder.\n\t\t\t// During runtime, any changes to a bundle's \"dashboard\" folder will trigger a re-load of that bundle,\n\t\t\t// as will changes to its `package.json`.\n\t\t\tconst bundleFolders = fs.readdirSync(bundlesPath);\n\t\t\tbundleFolders.forEach((bundleFolderName) => {\n\t\t\t\tconst bundlePath = path.join(bundlesPath, bundleFolderName);\n\t\t\t\tif (!fs.statSync(bundlePath).isDirectory()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Prevent attempting to load unwanted directories. Those specified above and all dot-prefixed.\n\t\t\t\tif (blacklistedBundleDirectories.includes(bundleFolderName) || bundleFolderName.startsWith('.')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (nodecgConfig?.bundles?.disabled?.includes(bundleFolderName)) {\n\t\t\t\t\tlog.debug(`Not loading bundle ${bundleFolderName} as it is disabled in config`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (nodecgConfig?.bundles?.enabled && !nodecgConfig.bundles.enabled.includes(bundleFolderName)) {\n\t\t\t\t\tlog.debug(`Not loading bundle ${bundleFolderName} as it is not enabled in config`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlog.debug(`Loading bundle ${bundleFolderName}`);\n\n\t\t\t\t// Parse each bundle and push the result onto the bundles array\n\t\t\t\tconst bundle = parseBundle(bundlePath, loadBundleCfg(cfgPath, bundleFolderName));\n\n\t\t\t\t// Check if the bundle is compatible with this version of NodeCG\n\t\t\t\tif (!semver.satisfies(nodecgVersion, bundle.compatibleRange)) {\n\t\t\t\t\tlog.error(\n\t\t\t\t\t\t'%s requires NodeCG version %s, current version is %s',\n\t\t\t\t\t\tbundle.name,\n\t\t\t\t\t\tbundle.compatibleRange,\n\t\t\t\t\t\tnodecgVersion,\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbundles.push(bundle);\n\n\t\t\t\t// Use `chokidar` to watch for file changes within bundles.\n\t\t\t\t// Workaround for https://github.com/paulmillr/chokidar/issues/419\n\t\t\t\t// This workaround is necessary to fully support symlinks.\n\t\t\t\t// This is applied after the bundle has been validated and loaded.\n\t\t\t\t// Bundles that do not properly load upon startup are not recognized for updates.\n\t\t\t\twatcher.add([\n\t\t\t\t\tpath.join(bundlePath, '.git'), // Watch `.git` directories.\n\t\t\t\t\tpath.join(bundlePath, 'dashboard'), // Watch `dashboard` directories.\n\t\t\t\t\tpath.join(bundlePath, 'package.json'), // Watch each bundle's `package.json`.\n\t\t\t\t]);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns a shallow-cloned array of all currently active bundles.\n\t * @returns {Array.<Object>}\n\t */\n\tall(): NodeCG.Bundle[] {\n\t\treturn bundles.slice(0);\n\t}\n\n\t/**\n\t * Returns the bundle with the given name. undefined if not found.\n\t * @param name {String} - The name of the bundle to find.\n\t * @returns {Object|undefined}\n\t */\n\tfind(name: string): NodeCG.Bundle | undefined {\n\t\treturn bundles.find((b) => b.name === name);\n\t}\n\n\t/**\n\t * Adds a bundle to the internal list, replacing any existing bundle with the same name.\n\t * @param bundle {Object}\n\t */\n\tadd(bundle: NodeCG.Bundle): void {\n\t\t/* istanbul ignore if: Again, it shouldn't be possible for \"bundle\" to be undefined, but just in case... */\n\t\tif (!bundle) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Remove any existing bundles with this name\n\t\tif (this.find(bundle.name)) {\n\t\t\tthis.remove(bundle.name);\n\t\t}\n\n\t\tbundles.push(bundle);\n\t}\n\n\t/**\n\t * Removes a bundle with the given name from the internal list. Does nothing if no match found.\n\t * @param bundleName {String}\n\t */\n\tremove(bundleName: string): void {\n\t\tconst len = bundles.length;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\t// TODO: this check shouldn't have to happen, idk why things in this array can sometimes be undefined\n\t\t\tif (!bundles[i]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (bundles[i].name === bundleName) {\n\t\t\t\tbundles.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\thandleChange(bundleName: string): void {\n\t\tsetTimeout(() => {\n\t\t\tthis._handleChange(bundleName);\n\t\t}, 100);\n\t}\n\n\t/**\n\t * Resets the backoff timer used to avoid event thrashing when many files change rapidly.\n\t */\n\tresetBackoffTimer(): void {\n\t\tclearTimeout(backoffTimer as any); // Typedefs for clearTimeout are always wonky\n\t\tbackoffTimer = setTimeout(() => {\n\t\t\tbackoffTimer = undefined;\n\t\t\tfor (const bundleName of hasChanged) {\n\t\t\t\tlog.debug('Backoff finished, emitting change event for', bundleName);\n\t\t\t\tthis.handleChange(bundleName);\n\t\t\t}\n\n\t\t\thasChanged.clear();\n\t\t}, 500);\n\t}\n\n\t/**\n\t * Checks if a given path is a panel HTML file of a given bundle.\n\t * @param bundleName {String}\n\t * @param filePath {String}\n\t * @returns {Boolean}\n\t * @private\n\t */\n\tisPanelHTMLFile(bundleName: string, filePath: string): boolean {\n\t\tconst bundle = this.find(bundleName);\n\t\tif (bundle) {\n\t\t\treturn bundle.dashboard.panels.some((panel) => panel.path.endsWith(filePath));\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Only used by tests.\n\t */\n\t_stopWatching(): void {\n\t\tvoid watcher.close();\n\t}\n\n\tprivate _handleChange(bundleName: string): void {\n\t\tconst bundle = this.find(bundleName);\n\n\t\t/* istanbul ignore if: It's rare for `bundle` to be undefined here, but it can happen when using black/whitelisting. */\n\t\tif (!bundle) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (backoffTimer) {\n\t\t\tlog.debug('Backoff active, delaying processing of change detected in', bundleName);\n\t\t\thasChanged.add(bundleName);\n\t\t\tthis.resetBackoffTimer();\n\t\t} else {\n\t\t\tlog.debug('Processing change event for', bundleName);\n\t\t\tthis.resetBackoffTimer();\n\n\t\t\ttry {\n\t\t\t\tconst reparsedBundle = parseBundle(bundle.dir, loadBundleCfg(this._cfgPath, bundle.name));\n\t\t\t\tthis.add(reparsedBundle);\n\t\t\t\tthis.emit('bundleChanged', reparsedBundle);\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t\t\t} catch (error: any) {\n\t\t\t\tlog.warn('Unable to handle the bundle \"%s\" change:\\n%s', bundleName, error.stack);\n\t\t\t\tthis.emit('invalidBundle', bundle, error);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Returns the name of a bundle that owns a given path.\n * @param filePath {String} - The path of the file to extract a bundle name from.\n * @returns {String} - The name of the bundle that owns this path.\n * @private\n */\nfunction extractBundleName(bundlesPath: string, filePath: string): string {\n\treturn filePath.replace(bundlesPath, '').split(path.sep)[1];\n}\n\n/**\n * Checks if a given path is the manifest file for a given bundle.\n * @param bundleName {String}\n * @param filePath {String}\n * @returns {Boolean}\n * @private\n */\nfunction isManifest(bundleName: string, filePath: string): boolean {\n\treturn path.dirname(filePath).endsWith(bundleName) && path.basename(filePath) === 'package.json';\n}\n\n/**\n * Checks if a given path is in the .git dir of a bundle.\n * @param bundleName {String}\n * @param filePath {String}\n * @returns {Boolean}\n * @private\n */\nfunction isGitData(bundleName: string, filePath: string): boolean {\n\tconst regex = new RegExp(`${bundleName}${'\\\\'}${path.sep}${'\\\\'}.git`);\n\treturn regex.test(filePath);\n}\n\n/**\n * Determines which config file to use for a bundle.\n */\nfunction loadBundleCfg(cfgDir: string, bundleName: string): NodeCG.Bundle.UnknownConfig | undefined {\n\ttry {\n\t\tconst cc = cosmiconfig('nodecg', {\n\t\t\tsearchPlaces: [\n\t\t\t\t`${bundleName}.json`,\n\t\t\t\t`${bundleName}.yaml`,\n\t\t\t\t`${bundleName}.yml`,\n\t\t\t\t`${bundleName}.js`,\n\t\t\t\t`${bundleName}.config.js`,\n\t\t\t],\n\t\t\tstopDir: cfgDir,\n\t\t});\n\t\tconst result = cc.search(cfgDir);\n\t\treturn result?.config;\n\t} catch (_: unknown) {\n\t\tthrow new Error(\n\t\t\t`Config for bundle \"${bundleName}\" could not be read. Ensure that it is valid JSON, YAML, or CommonJS.`,\n\t\t);\n\t}\n}\n","// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (manifest: Pick<NodeCG.Manifest, 'assetCategories' | 'name'>): NodeCG.Bundle.AssetCategory[] {\n\tif (!manifest.assetCategories) {\n\t\treturn [];\n\t}\n\n\tif (!Array.isArray(manifest.assetCategories)) {\n\t\tthrow new Error(`${manifest.name}'s nodecg.assetCategories is not an Array`);\n\t}\n\n\treturn manifest.assetCategories.map((category, index) => {\n\t\tif (typeof category.name !== 'string') {\n\t\t\tthrow new Error(`nodecg.assetCategories[${index}] in bundle ${manifest.name} lacks a \"name\" property`);\n\t\t}\n\n\t\tif (category.name.toLowerCase() === 'sounds') {\n\t\t\tthrow new Error(\n\t\t\t\t'\"sounds\" is a reserved assetCategory name. ' +\n\t\t\t\t\t`Please change nodecg.assetCategories[${index}].name in bundle ${manifest.name}`,\n\t\t\t);\n\t\t}\n\n\t\tif (typeof category.title !== 'string') {\n\t\t\tthrow new Error(`nodecg.assetCategories[${index}] in bundle ${manifest.name} lacks a \"title\" property`);\n\t\t}\n\n\t\tif (category.allowedTypes && !Array.isArray(category.allowedTypes)) {\n\t\t\tthrow new Error(`nodecg.assetCategories[${index}].allowedTypes in bundle ${manifest.name} is not an Array`);\n\t\t}\n\n\t\treturn category;\n\t});\n}\n","// Native\nimport * as path from 'path';\nimport * as fs from 'fs';\n\n// Packages\nimport clone from 'clone';\nimport extend from 'extend';\nimport type { NodeCG } from '../../types/nodecg';\nimport type { ValidateFunction } from 'ajv';\n\n// Ours\nimport { compileJsonSchema, formatJsonSchemaErrors, getSchemaDefault, stringifyError } from '../../shared/utils';\n\nexport function parse(\n\tbundleName: string,\n\tbundleDir: string,\n\tuserConfig: NodeCG.Bundle.UnknownConfig,\n): NodeCG.Bundle.UnknownConfig {\n\tconst cfgSchemaPath = path.resolve(bundleDir, 'configschema.json');\n\tif (!fs.existsSync(cfgSchemaPath)) {\n\t\treturn userConfig;\n\t}\n\n\tconst schema = _parseSchema(bundleName, cfgSchemaPath);\n\tconst defaultConfig = getSchemaDefault(schema, bundleName) as NodeCG.Bundle.UnknownConfig;\n\tlet validateUserConfig: ValidateFunction;\n\ttry {\n\t\tvalidateUserConfig = compileJsonSchema(schema);\n\t} catch (error: unknown) {\n\t\tthrow new Error(`Error compiling JSON Schema for bundle config \"${bundleName}\":\\n\\t${stringifyError(error)}`);\n\t}\n\n\tconst userConfigValid = validateUserConfig(userConfig);\n\tlet finalConfig;\n\n\t// If the user's config is currently valid before any defaults from the schema have been added,\n\t// then ensure that adding the defaults won't suddenly invalidate the schema.\n\t// Else, if the user's config is currently invalid, then try adding the defaults and check if that makes it valid.\n\tif (userConfigValid) {\n\t\tfinalConfig = clone(userConfig);\n\t\tfor (const key in defaultConfig) {\n\t\t\t/* istanbul ignore if */\n\t\t\tif (!{}.hasOwnProperty.call(defaultConfig, key)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst _foo: Record<string, any> = {};\n\t\t\t_foo[key] = defaultConfig[key];\n\n\t\t\tconst _tempMerged: Record<string, any> = extend(true, _foo, clone(finalConfig));\n\t\t\tconst result = validateUserConfig(_tempMerged);\n\t\t\tif (result) {\n\t\t\t\tfinalConfig = _tempMerged;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfinalConfig = extend(true, defaultConfig, userConfig);\n\t}\n\n\tconst result = validateUserConfig(finalConfig);\n\tif (result) {\n\t\treturn finalConfig;\n\t}\n\n\tthrow new Error(\n\t\t`Config for bundle \"${bundleName}\" is invalid:\\n${formatJsonSchemaErrors(schema, validateUserConfig.errors)}`,\n\t);\n}\n\nexport function parseDefaults(bundleName: string, bundleDir: string): Record<string, any> {\n\tconst cfgSchemaPath = path.resolve(bundleDir, 'configschema.json');\n\tif (fs.existsSync(cfgSchemaPath)) {\n\t\tconst schema = _parseSchema(bundleName, cfgSchemaPath);\n\t\treturn getSchemaDefault(schema, bundleName) as Record<string, any>;\n\t}\n\n\treturn {};\n}\n\nfunction _parseSchema(bundleName: string, schemaPath: string): Record<string, any> {\n\ttry {\n\t\treturn JSON.parse(fs.readFileSync(schemaPath, { encoding: 'utf8' }));\n\t} catch (_: unknown) {\n\t\tthrow new Error(\n\t\t\t`configschema.json for bundle \"${bundleName}\" could not be read. Ensure that it is valid JSON.`,\n\t\t);\n\t}\n}\n","// Native\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (bundleDir: string, manifest: NodeCG.Manifest): boolean {\n\tconst singleFilePath = path.resolve(bundleDir, 'extension.js');\n\tconst directoryPath = path.resolve(bundleDir, 'extension');\n\tconst singleFileExists = fs.existsSync(singleFilePath);\n\tconst directoryExists = fs.existsSync(directoryPath);\n\n\t// If there is a file named \"extension\", throw an error. It should be a directory.\n\tif (directoryExists && !fs.lstatSync(directoryPath).isDirectory()) {\n\t\tthrow new Error(\n\t\t\t`${manifest.name} has an illegal file named \"extension\" in its root. ` +\n\t\t\t\t'Either rename it to \"extension.js\", or make a directory named \"extension\"',\n\t\t);\n\t}\n\n\t// If both \"extension.js\" and a directory named \"extension\" exist, throw an error.\n\tif (singleFileExists && directoryExists) {\n\t\tthrow new Error(\n\t\t\t`${manifest.name} has both \"extension.js\" and a folder named \"extension\". ` +\n\t\t\t\t'There can only be one of these, not both.',\n\t\t);\n\t}\n\n\t// Return \"true\" if either \"extension.js\" or a directory named \"extension\" exist.\n\treturn singleFileExists || directoryExists;\n}\n","// Packages\nimport * as git from 'git-rev-sync';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (bundleDir: string): NodeCG.Bundle.GitData {\n\tconst workingDir = process.cwd();\n\tlet retValue: NodeCG.Bundle.GitData;\n\ttry {\n\t\t// These will error if bundleDir is not a git repo\n\t\tconst branch = git.branch(bundleDir);\n\t\tconst hash = git.long(bundleDir);\n\t\tconst shortHash = git.short(bundleDir);\n\n\t\ttry {\n\t\t\t// Needed for the below commands to work.\n\t\t\tprocess.chdir(bundleDir);\n\n\t\t\t// These will error if bundleDir is not a git repo and if `git` is not in $PATH.\n\t\t\tconst date = git.date().toISOString();\n\t\t\tconst message = git.message();\n\t\t\tretValue = { branch, hash, shortHash, date, message };\n\t\t} catch {\n\t\t\tretValue = {\n\t\t\t\tbranch,\n\t\t\t\thash,\n\t\t\t\tshortHash,\n\t\t\t};\n\t\t}\n\t} catch {}\n\n\tprocess.chdir(workingDir);\n\treturn retValue;\n}\n","// Native\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (graphicsDir: string, manifest: NodeCG.Manifest): NodeCG.Bundle.Graphic[] {\n\tconst graphics: NodeCG.Bundle.Graphic[] = [];\n\n\tif (fs.existsSync(graphicsDir) && typeof manifest.graphics === 'undefined') {\n\t\t// If the graphics folder exists but the nodecg.graphics property doesn't, throw an error.\n\t\tthrow new Error(\n\t\t\t`${manifest.name} has a \"graphics\" folder, ` +\n\t\t\t\t'but no \"nodecg.graphics\" property was found in its package.json',\n\t\t);\n\t}\n\n\t// If nodecg.graphics exists but the graphics folder doesn't, throw an error.\n\tif (!fs.existsSync(graphicsDir) && typeof manifest.graphics !== 'undefined') {\n\t\tthrow new Error(\n\t\t\t`${manifest.name} has a \"nodecg.graphics\" property in its package.json, but no \"graphics\" folder`,\n\t\t);\n\t}\n\n\t// If neither the folder nor the manifest exist, return an empty array.\n\tif (!fs.existsSync(graphicsDir) && typeof manifest.graphics === 'undefined') {\n\t\treturn graphics;\n\t}\n\n\tif (!manifest.graphics) {\n\t\treturn graphics;\n\t}\n\n\tmanifest.graphics.forEach((graphic, index) => {\n\t\tconst missingProps = [];\n\t\tif (typeof graphic.file === 'undefined') {\n\t\t\tmissingProps.push('file');\n\t\t}\n\n\t\tif (typeof graphic.width === 'undefined') {\n\t\t\tmissingProps.push('width');\n\t\t}\n\n\t\tif (typeof graphic.height === 'undefined') {\n\t\t\tmissingProps.push('height');\n\t\t}\n\n\t\tif (missingProps.length) {\n\t\t\tthrow new Error(\n\t\t\t\t`Graphic #${index} could not be parsed as it is missing the following properties: ` +\n\t\t\t\t\t`${missingProps.join(', ')}`,\n\t\t\t);\n\t\t}\n\n\t\t// Check if this bundle already has a graphic for this file\n\t\tconst dupeFound = graphics.some((g) => g.file === graphic.file);\n\t\tif (dupeFound) {\n\t\t\tthrow new Error(\n\t\t\t\t`Graphic #${index} (${graphic.file}) has the same file as another graphic in ${manifest.name}`,\n\t\t\t);\n\t\t}\n\n\t\tconst filePath = path.join(graphicsDir, graphic.file);\n\n\t\t// Check that the panel file exists, throws error if it doesn't\n\t\t// eslint-disable-next-line no-bitwise\n\t\tfs.accessSync(filePath, fs.constants.F_OK | fs.constants.R_OK);\n\n\t\tconst parsedGraphic: NodeCG.Bundle.Graphic = {\n\t\t\t...graphic,\n\t\t\tsingleInstance: Boolean(graphic.singleInstance),\n\t\t\turl: `/bundles/${manifest.name}/graphics/${graphic.file}`,\n\t\t};\n\n\t\tgraphics.push(parsedGraphic);\n\t});\n\n\treturn graphics;\n}\n","// Native\nimport * as path from 'path';\nimport * as fs from 'fs';\n\n// Ours\nimport parsePanels from './panels';\nimport parseMounts from './mounts';\nimport parseGraphics from './graphics';\nimport parseManifest from './manifest';\nimport parseAssets from './assets';\nimport parseSounds from './sounds';\nimport * as config from './config';\nimport parseExtension from './extension';\nimport parseGit from './git';\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (bundlePath: string, bundleCfg?: NodeCG.Bundle.UnknownConfig): NodeCG.Bundle {\n\t// Resolve the path to the bundle and its package.json\n\tconst pkgPath = path.join(bundlePath, 'package.json');\n\n\tif (!fs.existsSync(pkgPath)) {\n\t\tthrow new Error(`Bundle at path ${bundlePath} does not contain a package.json!`);\n\t}\n\n\t// Read metadata from the package.json\n\tlet pkg: NodeCG.PackageJSON;\n\ttry {\n\t\tpkg = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n\t} catch (_: unknown) {\n\t\tthrow new Error(`${pkgPath} is not valid JSON, please check it against a validator such as jsonlint.com`);\n\t}\n\n\tconst dashboardDir = path.resolve(bundlePath, 'dashboard');\n\tconst graphicsDir = path.resolve(bundlePath, 'graphics');\n\tconst manifest = parseManifest(pkg, bundlePath);\n\tconst bundle: NodeCG.Bundle = {\n\t\t...manifest,\n\t\tdir: bundlePath,\n\n\t\t// If there is a config file for this bundle, parse it.\n\t\t// Else if there is only a configschema for this bundle, parse that and apply any defaults.\n\t\tconfig: bundleCfg\n\t\t\t? config.parse(manifest.name, bundlePath, bundleCfg)\n\t\t\t: config.parseDefaults(manifest.name, bundlePath),\n\n\t\tdashboard: {\n\t\t\tdir: dashboardDir,\n\t\t\tpanels: parsePanels(dashboardDir, manifest),\n\t\t},\n\t\tmount: parseMounts(manifest),\n\t\tgraphics: parseGraphics(graphicsDir, manifest),\n\t\tassetCategories: parseAssets(manifest),\n\t\thasExtension: parseExtension(bundlePath, manifest),\n\t\tgit: parseGit(bundlePath),\n\t\t...parseSounds(bundlePath, manifest),\n\t};\n\n\treturn bundle;\n}\n","// Native\nimport * as path from 'path';\n\n// Packages\nimport * as semver from 'semver';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (pkg: NodeCG.PackageJSON, bundlePath: string): NodeCG.Manifest {\n\tif (!semver.valid(pkg.version)) {\n\t\tthrow new Error(`${pkg.name}'s package.json must specify a valid version.`);\n\t}\n\n\t// Check if this manifest has a nodecg property\n\tif (!{}.hasOwnProperty.call(pkg, 'nodecg')) {\n\t\tthrow new Error(`${pkg.name}'s package.json lacks a \"nodecg\" property, and therefore cannot be parsed.`);\n\t}\n\n\tif (!semver.validRange(pkg.nodecg.compatibleRange)) {\n\t\tthrow new Error(`${pkg.name}'s package.json does not have a valid \"nodecg.compatibleRange\" property.`);\n\t}\n\n\tconst bundleFolderName = path.parse(bundlePath).base;\n\tif (bundleFolderName !== pkg.name) {\n\t\tthrow new Error(`${pkg.name}'s folder is named \"${bundleFolderName}\". Please rename it to \"${pkg.name}\".`);\n\t}\n\n\t// Grab the standard properties from the package.json that we care about.\n\tconst manifest: NodeCG.Manifest = {\n\t\t...pkg.nodecg,\n\t\tname: pkg.name,\n\t\tversion: pkg.version,\n\t\tlicense: pkg.license,\n\t\tdescription: pkg.description,\n\t\thomepage: pkg.homepage,\n\t\tauthor: pkg.author,\n\t\tcontributors: pkg.contributors,\n\t\ttransformBareModuleSpecifiers: Boolean(pkg.nodecg.transformBareModuleSpecifiers),\n\t};\n\n\treturn manifest;\n}\n","// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (manifest: Pick<NodeCG.Manifest, 'mount' | 'name'>): NodeCG.Bundle.Mount[] {\n\tconst mounts: NodeCG.Bundle.Mount[] = [];\n\n\t// Return early if no mounts\n\tif (typeof manifest.mount === 'undefined' || manifest.mount.length <= 0) {\n\t\treturn mounts;\n\t}\n\n\tif (!Array.isArray(manifest.mount)) {\n\t\tthrow new Error(\n\t\t\t`${manifest.name} has an invalid \"nodecg.mount\" property in its package.json, it must be an array`,\n\t\t);\n\t}\n\n\tmanifest.mount.forEach((mount, index) => {\n\t\tconst missingProps = [];\n\t\t// Check for missing properties\n\t\tif (typeof mount.directory === 'undefined') {\n\t\t\tmissingProps.push('directory');\n\t\t}\n\n\t\tif (typeof mount.endpoint === 'undefined') {\n\t\t\tmissingProps.push('endpoint');\n\t\t}\n\n\t\tif (missingProps.length > 0) {\n\t\t\tthrow new Error(\n\t\t\t\t`Mount #${index} could not be parsed as it is missing the following properties: ` +\n\t\t\t\t\t`${missingProps.join(', ')}`,\n\t\t\t);\n\t\t}\n\n\t\t// Remove trailing slashes from endpoint\n\t\tif (mount.endpoint.endsWith('/')) {\n\t\t\tmount.endpoint = mount.endpoint.slice(0, -1);\n\t\t}\n\n\t\tmounts.push(mount);\n\t});\n\n\treturn mounts;\n}\n","// Native\nimport * as path from 'path';\nimport * as fs from 'fs';\n\n// Packages\nimport cheerio from 'cheerio';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (dashboardDir: string, manifest: NodeCG.Manifest): NodeCG.Bundle.Panel[] {\n\tconst unparsedPanels = manifest.dashboardPanels ?? undefined;\n\tconst bundleName = manifest.name;\n\tconst panels: NodeCG.Bundle.Panel[] = [];\n\n\t// If the dashboard folder exists but the nodecg.dashboardPanels property doesn't, throw an error.\n\tif (fs.existsSync(dashboardDir) && typeof unparsedPanels === 'undefined') {\n\t\tthrow new Error(\n\t\t\t`${bundleName} has a \"dashboard\" folder, ` +\n\t\t\t\t'but no \"nodecg.dashboardPanels\" property was found in its package.json',\n\t\t);\n\t}\n\n\t// If nodecg.dashboardPanels exists but the dashboard folder doesn't, throw an error.\n\tif (!fs.existsSync(dashboardDir) && typeof unparsedPanels !== 'undefined') {\n\t\tthrow new Error(\n\t\t\t`${bundleName} has a \"nodecg.dashboardPanels\" property in its package.json, but no \"dashboard\" folder`,\n\t\t);\n\t}\n\n\t// If neither the folder nor the manifest exist, return an empty array.\n\tif (!fs.existsSync(dashboardDir) && typeof unparsedPanels === 'undefined') {\n\t\treturn panels;\n\t}\n\n\tunparsedPanels?.forEach((panel, index) => {\n\t\tassertRequiredProps(panel, index);\n\n\t\t// Check if this bundle already has a panel by this name\n\t\tconst dupeFound = panels.some((p) => p.name === panel.name);\n\t\tif (dupeFound) {\n\t\t\tthrow new Error(`Panel #${index} (${panel.name}) has the same name as another panel in ${bundleName}.`);\n\t\t}\n\n\t\tconst filePath = path.join(dashboardDir, panel.file);\n\n\t\t// Check that the panel file exists, throws error if it doesn't\n\t\tif (!fs.existsSync(filePath)) {\n\t\t\tthrow new Error(`Panel file \"${panel.file}\" in bundle \"${bundleName}\" does not exist.`);\n\t\t}\n\n\t\t// This fixes some harder to spot issues with Unicode Byte Order Markings in dashboard HTML.\n\t\tconst panelStr = fs.readFileSync(filePath, 'utf8');\n\t\tconst $ = cheerio.load(panelStr.trim());\n\n\t\t// We used to need to check for a <head> tag, but modern versions of Cheerio add this for us automatically!\n\n\t\t// Check that the panel has a DOCTYPE\n\t\tconst html = $.html();\n\t\tif (!html.match(/(<!doctype )/gi)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Panel \"${path.basename(panel.file)}\" in bundle \"${bundleName}\" has no DOCTYPE,` +\n\t\t\t\t\t'panel resizing will not work. Add <!DOCTYPE html> to it.',\n\t\t\t);\n\t\t}\n\n\t\t// Error if this panel is a dialog but also has a workspace defined\n\t\tif (panel.dialog && panel.workspace) {\n\t\t\tthrow new Error(\n\t\t\t\t`Dialog \"${path.basename(panel.file)}\" in bundle \"${bundleName}\" has a \"workspace\" ` +\n\t\t\t\t\t'configured. Dialogs don\\'t get put into workspaces. Either remove the \"workspace\" property from ' +\n\t\t\t\t\t'this dialog, or turn it into a normal panel by setting \"dialog\" to false.',\n\t\t\t);\n\t\t}\n\n\t\tif (panel.dialog && panel.fullbleed) {\n\t\t\tthrow new Error(\n\t\t\t\t`Panel \"${path.basename(panel.file)}\" in bundle \"${bundleName}\" is fullbleed, ` +\n\t\t\t\t\t'but it also a dialog. Fullbleed panels cannot be dialogs. Either set fullbleed or dialog ' +\n\t\t\t\t\t'to false.',\n\t\t\t);\n\t\t}\n\n\t\tif (panel.fullbleed && panel.workspace) {\n\t\t\tthrow new Error(\n\t\t\t\t`Panel \"${path.basename(panel.file)}\" in bundle \"${bundleName}\" is fullbleed, ` +\n\t\t\t\t\t'but it also has a workspace defined. Fullbleed panels are not allowed to define a workspace, ' +\n\t\t\t\t\t'as they are automatically put into their own workspace. Either set fullbleed to ' +\n\t\t\t\t\t'false or remove the workspace property from this panel.',\n\t\t\t);\n\t\t}\n\n\t\tif (panel.fullbleed && typeof panel.width !== 'undefined') {\n\t\t\tthrow new Error(\n\t\t\t\t`Panel \"${path.basename(panel.file)}\" in bundle \"${bundleName}\" is fullbleed, ` +\n\t\t\t\t\t'but it also has a width defined. Fullbleed panels have their width set based on the, ' +\n\t\t\t\t\t'width of the browser viewport. Either set fullbleed to ' +\n\t\t\t\t\t'false or remove the width property from this panel.',\n\t\t\t);\n\t\t}\n\n\t\tif (panel.workspace?.toLowerCase().startsWith('__nodecg')) {\n\t\t\tthrow new Error(\n\t\t\t\t`Panel \"${path.basename(panel.file)}\" in bundle \"${bundleName}\" is in a workspace ` +\n\t\t\t\t\t'whose name begins with __nodecg, which is a reserved string. Please change the name ' +\n\t\t\t\t\t'of this workspace to not begin with this string.',\n\t\t\t);\n\t\t}\n\n\t\tlet sizeInfo:\n\t\t\t| {\n\t\t\t\t\tfullbleed: false;\n\t\t\t\t\twidth: number;\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tfullbleed: true;\n\t\t\t  };\n\t\tif (panel.fullbleed) {\n\t\t\tsizeInfo = {\n\t\t\t\tfullbleed: true,\n\t\t\t};\n\t\t} else {\n\t\t\tsizeInfo = {\n\t\t\t\tfullbleed: false,\n\t\t\t\twidth: panel.width ?? 1,\n\t\t\t};\n\t\t}\n\n\t\tlet workspaceInfo:\n\t\t\t| {\n\t\t\t\t\tdialog: false;\n\t\t\t\t\tworkspace: string;\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tdialog: true;\n\t\t\t\t\tdialogButtons?: NodeCG.Manifest.UnparsedPanel['dialogButtons'];\n\t\t\t  };\n\t\tif (panel.dialog) {\n\t\t\tworkspaceInfo = {\n\t\t\t\tdialog: true,\n\t\t\t\tdialogButtons: panel.dialogButtons,\n\t\t\t};\n\t\t} else {\n\t\t\tworkspaceInfo = {\n\t\t\t\tdialog: false,\n\t\t\t\tworkspace: panel.workspace ? panel.workspace.toLowerCase() : 'default',\n\t\t\t};\n\t\t}\n\n\t\tconst parsedPanel: NodeCG.Bundle.Panel = {\n\t\t\tname: panel.name,\n\t\t\ttitle: panel.title,\n\t\t\tfile: panel.file,\n\t\t\t...sizeInfo,\n\t\t\t...workspaceInfo,\n\t\t\tpath: filePath,\n\t\t\theaderColor: panel.headerColor ?? '#525F78',\n\t\t\tbundleName,\n\t\t\thtml: $.html(),\n\t\t};\n\n\t\tpanels.push(parsedPanel);\n\t});\n\n\treturn panels;\n}\n\nfunction assertRequiredProps(panel: NodeCG.Manifest.UnparsedPanel, index: number): void {\n\tconst missingProps = [];\n\tif (typeof panel.name === 'undefined') {\n\t\tmissingProps.push('name');\n\t}\n\n\tif (typeof panel.title === 'undefined') {\n\t\tmissingProps.push('title');\n\t}\n\n\tif (typeof panel.file === 'undefined') {\n\t\tmissingProps.push('file');\n\t}\n\n\tif (missingProps.length) {\n\t\tthrow new Error(\n\t\t\t`Panel #${index} could not be parsed as it is missing the following properties: ` +\n\t\t\t\t`${missingProps.join(', ')}`,\n\t\t);\n\t}\n}\n","// Native\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Ours\nimport type { NodeCG } from '../../types/nodecg';\n\nexport default function (\n\tbundlePath: string,\n\tmanifest: Pick<NodeCG.Manifest, 'soundCues' | 'name'>,\n): { soundCues: NodeCG.Bundle.SoundCue[]; hasAssignableSoundCues: boolean } {\n\tif (!manifest.soundCues) {\n\t\treturn { soundCues: [], hasAssignableSoundCues: false };\n\t}\n\n\tif (!Array.isArray(manifest.soundCues)) {\n\t\tthrow new Error(`${manifest.name}'s nodecg.soundCues is not an Array`);\n\t}\n\n\tlet hasAssignable = false;\n\tconst parsedCues = manifest.soundCues.map((unparsedCue, index) => {\n\t\tif (typeof unparsedCue.name !== 'string') {\n\t\t\tthrow new Error(`nodecg.soundCues[${index}] in bundle ${manifest.name} lacks a \"name\" property`);\n\t\t}\n\n\t\tconst parsedCue = {\n\t\t\t...unparsedCue,\n\t\t};\n\n\t\tif (typeof parsedCue.assignable === 'undefined') {\n\t\t\tparsedCue.assignable = true;\n\t\t}\n\n\t\tif (parsedCue.assignable) {\n\t\t\thasAssignable = true;\n\t\t}\n\n\t\t// Clamp default volume to 0-100.\n\t\tif (parsedCue.defaultVolume) {\n\t\t\tparsedCue.defaultVolume = Math.min(parsedCue.defaultVolume, 100);\n\t\t\tparsedCue.defaultVolume = Math.max(parsedCue.defaultVolume, 0);\n\t\t}\n\n\t\t// Verify that defaultFile exists, if provided.\n\t\tif (parsedCue.defaultFile) {\n\t\t\tconst defaultFilePath = path.join(bundlePath, parsedCue.defaultFile);\n\t\t\tif (!fs.existsSync(defaultFilePath)) {\n\t\t\t\tthrow new Error(`nodecg.soundCues[${index}].defaultFile in bundle ${manifest.name} does not exist`);\n\t\t\t}\n\t\t}\n\n\t\treturn parsedCue;\n\t});\n\n\treturn { soundCues: parsedCues, hasAssignableSoundCues: hasAssignable };\n}\n","// Native\nimport * as path from 'path';\n\n// Packages\nimport * as fs from 'fs-extra';\nimport { argv } from 'yargs';\n\n// Ours\nimport loadConfig from './loader';\n\nconst cfgDirectoryPath = (argv.cfgPath as string) ?? path.join(process.env.NODECG_ROOT, 'cfg');\n\n// Make 'cfg' folder if it doesn't exist\nif (!fs.existsSync(cfgDirectoryPath)) {\n\tfs.mkdirpSync(cfgDirectoryPath);\n}\n\nconst { config, filteredConfig } = loadConfig(cfgDirectoryPath);\nexport { config, filteredConfig };\n","// Native\nimport fs from 'fs';\nimport path from 'path';\n\n// Packages\nimport clone from 'clone';\nimport Joi from 'joi';\nimport { cosmiconfigSync as cosmiconfig } from 'cosmiconfig';\nimport { argv } from 'yargs';\n\n// Ours\nimport { LogLevel } from '../../shared/logger-interface';\nimport type { NodeCG } from '../../types/nodecg';\n\n// eslint-disable-next-line complexity\nfunction getConfigSchema(userConfig: Record<string, any>) {\n\treturn Joi.object({\n\t\thost: Joi.string().default('0.0.0.0').description('The IP address or hostname that NodeCG should bind to.'),\n\n\t\tport: Joi.number().port().default(9090).description('The port that NodeCG should listen on.'),\n\n\t\tbaseURL: Joi.string()\n\t\t\t.default('')\n\t\t\t.description(\n\t\t\t\t'The URL of this instance. Used for things like cookies. Defaults to HOST:PORT. ' +\n\t\t\t\t\t\"If you use a reverse proxy, you'll likely need to set this value.\",\n\t\t\t),\n\n\t\texitOnUncaught: Joi.boolean().default(true).description('Whether or not to exit on uncaught exceptions.'),\n\n\t\tlogging: Joi.object({\n\t\t\tconsole: Joi.object({\n\t\t\t\tenabled: Joi.boolean().default(true).description('Whether to enable console logging.'),\n\n\t\t\t\tlevel: Joi.string()\n\t\t\t\t\t.valid(...Object.values(LogLevel))\n\t\t\t\t\t.default('info'),\n\n\t\t\t\ttimestamps: Joi.boolean()\n\t\t\t\t\t.default(true)\n\t\t\t\t\t.description('Whether to add timestamps to the console logging.'),\n\n\t\t\t\treplicants: Joi.boolean()\n\t\t\t\t\t.default(false)\n\t\t\t\t\t.description('Whether to enable logging of the Replicants subsystem. Very spammy.'),\n\t\t\t}).default(),\n\n\t\t\tfile: Joi.object({\n\t\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable file logging.'),\n\t\t\t\tlevel: Joi.string()\n\t\t\t\t\t.valid(...Object.values(LogLevel))\n\t\t\t\t\t.default('info'),\n\n\t\t\t\tpath: Joi.string().default('logs/nodecg.log').description('The filepath to log to.'),\n\n\t\t\t\ttimestamps: Joi.boolean().default(true).description('Whether to add timestamps to the file logging.'),\n\n\t\t\t\treplicants: Joi.boolean()\n\t\t\t\t\t.default(false)\n\t\t\t\t\t.description('Whether to enable logging of the Replicants subsystem. Very spammy.'),\n\t\t\t}).default(),\n\t\t}).default(),\n\n\t\tbundles: Joi.object({\n\t\t\tenabled: Joi.array()\n\t\t\t\t.items(Joi.string())\n\t\t\t\t.allow(null)\n\t\t\t\t.default(argv.bundlesEnabled ?? null)\n\t\t\t\t.description('A whitelist array of bundle names that will be the only ones loaded at startup.'),\n\n\t\t\tdisabled: Joi.array()\n\t\t\t\t.items(Joi.string())\n\t\t\t\t.allow(null)\n\t\t\t\t.default(argv.bundlesDisabled ?? null)\n\t\t\t\t.description('A blacklist array of bundle names that will be excluded from loading at startup.'),\n\n\t\t\tpaths: Joi.array()\n\t\t\t\t.items(Joi.string())\n\t\t\t\t.default(argv.bundlesPaths ?? [])\n\t\t\t\t.description('An array of additional paths where bundles are located.'),\n\t\t}).default({\n\t\t\tenabled: null,\n\t\t\tdisabled: null,\n\t\t\tpaths: [],\n\t\t}),\n\n\t\tlogin: Joi.object({\n\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable login security.'),\n\t\t\tsessionSecret: Joi.string()\n\t\t\t\t// This will throw if the user does not provide a value, but only if login security is enabled.\n\t\t\t\t.default(userConfig?.login?.enabled ? null : 'insecureButUnused')\n\t\t\t\t.description('The secret used to salt sessions.'),\n\t\t\tforceHttpsReturn: Joi.boolean()\n\t\t\t\t.default(false)\n\t\t\t\t.description(\n\t\t\t\t\t'Forces Steam & Twitch login return URLs to use HTTPS instead of HTTP. Useful in reverse proxy setups.',\n\t\t\t\t),\n\t\t\tsteam: Joi.object({\n\t\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable Steam authentication.'),\n\t\t\t\tapiKey: Joi.string()\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Steam auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.steam?.enabled ? null : '')\n\t\t\t\t\t.description('A Steam API Key. Obtained from http://steamcommunity.com/dev/apikey'),\n\t\t\t\tallowedIds: Joi.array()\n\t\t\t\t\t.items(Joi.string())\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Steam auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.steam?.enabled ? null : [])\n\t\t\t\t\t.description('Which 64 bit Steam IDs to allow. Can be obtained from https://steamid.io/'),\n\t\t\t}),\n\n\t\t\ttwitch: Joi.object({\n\t\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable Twitch authentication.'),\n\t\t\t\tclientID: Joi.string()\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Twitch auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.twitch?.enabled ? null : '')\n\t\t\t\t\t.description('A Twitch application ClientID http://twitch.tv/kraken/oauth2/clients/new'),\n\t\t\t\tclientSecret: Joi.string()\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Twitch auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.twitch?.enabled ? null : '')\n\t\t\t\t\t.description('A Twitch application ClientSecret http://twitch.tv/kraken/oauth2/clients/new'),\n\t\t\t\tscope: Joi.string()\n\t\t\t\t\t.default('user_read')\n\t\t\t\t\t.description('A space-separated string of Twitch application permissions.'),\n\t\t\t\tallowedUsernames: Joi.array()\n\t\t\t\t\t.items(Joi.string())\n\t\t\t\t\t// This will throw if the user does not provide a value and is not using allowedIds, but only if Twitch auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.twitch?.enabled && !userConfig?.login?.twitch?.allowedIds ? null : [])\n\t\t\t\t\t.description('Which Twitch usernames to allow.'),\n\t\t\t\tallowedIds: Joi.array()\n\t\t\t\t\t.items(Joi.string())\n\t\t\t\t\t// This will throw if the user does not provide a value and is not using allowedUsernames, but only if Twitch auth is enabled.\n\t\t\t\t\t.default(\n\t\t\t\t\t\tuserConfig?.login?.twitch?.enabled && !userConfig?.login?.twitch?.allowedUsernames ? null : [],\n\t\t\t\t\t)\n\t\t\t\t\t.description(\n\t\t\t\t\t\t'Which Twitch IDs to allow. Can be obtained from https://twitchinsights.net/checkuser',\n\t\t\t\t\t),\n\t\t\t}),\n\n\t\t\tdiscord: Joi.object({\n\t\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable Discord authentication.'),\n\t\t\t\tclientID: Joi.string()\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Twitch auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.discord?.enabled ? null : '')\n\t\t\t\t\t.description('A Discord application ClientID https://discord.com/developers/applications'),\n\t\t\t\tclientSecret: Joi.string()\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Twitch auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.discord?.enabled ? null : '')\n\t\t\t\t\t.description('A Discord application ClientSecret https://discord.com/developers/applications'),\n\t\t\t\tscope: Joi.string()\n\t\t\t\t\t.default('identify')\n\t\t\t\t\t.description(\n\t\t\t\t\t\t'A space-separated string of Discord application scopes. https://discord.com/developers/docs/topics/oauth2#shared-resources-oauth2-scopes',\n\t\t\t\t\t),\n\t\t\t\tallowedUserIDs: Joi.array()\n\t\t\t\t\t.items(Joi.string())\n\t\t\t\t\t// This will throw if the user does not provide a value and is not using allowedGuilds, but only if Discord auth is enabled.\n\t\t\t\t\t.default(\n\t\t\t\t\t\tuserConfig?.login?.discord?.enabled && !userConfig?.login?.discord?.allowedGuilds ? null : [],\n\t\t\t\t\t)\n\t\t\t\t\t.description('Which Discord user IDs to allow.'),\n\t\t\t\tallowedGuilds: Joi.array()\n\t\t\t\t\t.items(\n\t\t\t\t\t\tJoi.object({\n\t\t\t\t\t\t\tguildID: Joi.string().description('Users in this Discord Server are allowed to log in.'),\n\t\t\t\t\t\t\tallowedRoleIDs: Joi.array()\n\t\t\t\t\t\t\t\t.items(Joi.string())\n\t\t\t\t\t\t\t\t.default([])\n\t\t\t\t\t\t\t\t.description('Additionally require one of the roles on the server to log in.'),\n\t\t\t\t\t\t\tguildBotToken: Joi.string()\n\t\t\t\t\t\t\t\t.default('')\n\t\t\t\t\t\t\t\t.description('Discord bot token, needed if allowedRoleIDs is used.'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t)\n\t\t\t\t\t// This will throw if the user does not provide a value and is not using allowedUserIDs, but only if Discord auth is enabled.\n\t\t\t\t\t.default(\n\t\t\t\t\t\tuserConfig?.login?.discord?.enabled && !userConfig?.login?.discord?.allowedUserIDs ? null : [],\n\t\t\t\t\t),\n\t\t\t}),\n\n\t\t\tlocal: Joi.object({\n\t\t\t\tenabled: Joi.boolean().default(false).description('Enable Local authentication.'),\n\t\t\t\tallowedUsers: Joi.array()\n\t\t\t\t\t.items(\n\t\t\t\t\t\tJoi.object({\n\t\t\t\t\t\t\tusername: Joi.string(),\n\t\t\t\t\t\t\tpassword: Joi.string(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t)\n\t\t\t\t\t// This will throw if the user does not provide a value, but only if Local auth is enabled.\n\t\t\t\t\t.default(userConfig?.login?.local?.enabled ? null : [])\n\t\t\t\t\t.description('Which users can log in.'),\n\t\t\t}),\n\t\t}).default(),\n\n\t\tssl: Joi.object({\n\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable SSL/HTTPS encryption.'),\n\t\t\tallowHTTP: Joi.boolean()\n\t\t\t\t.default(false)\n\t\t\t\t.description('Whether to allow insecure HTTP connections while SSL is active.'),\n\t\t\tkeyPath: Joi.string()\n\t\t\t\t// This will throw if the user does not provide a value, but only if SSL is enabled.\n\t\t\t\t.default(userConfig?.ssl?.enabled ? null : '')\n\t\t\t\t.description('The path to an SSL key file.'),\n\t\t\tcertificatePath: Joi.string()\n\t\t\t\t// This will throw if the user does not provide a value, but only if SSL is enabled.\n\t\t\t\t.default(userConfig?.ssl?.enabled ? null : '')\n\t\t\t\t.description('The path to an SSL certificate file.'),\n\t\t\tpassphrase: Joi.string().description('The passphrase for the provided key file.').optional(),\n\t\t}).optional(),\n\n\t\tsentry: Joi.object({\n\t\t\tenabled: Joi.boolean().default(false).description('Whether to enable Sentry error reporting.'),\n\t\t\tdsn: Joi.string()\n\t\t\t\t// This will throw if the user does not provide a value, but only if Sentry is enabled.\n\t\t\t\t.default(userConfig?.sentry?.enabled ? null : '')\n\t\t\t\t.description(\"Your project's DSN, used to route alerts to the correct place.\"),\n\t\t}).optional(),\n\t});\n}\n\n// eslint-disable-next-line complexity\nexport default function (cfgDirOrFile: string) {\n\tlet isDir = false;\n\ttry {\n\t\tisDir = fs.lstatSync(cfgDirOrFile).isDirectory();\n\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t} catch (error: any) {\n\t\tif (error.code !== 'ENOENT') {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-throw-literal\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tconst cfgDir = isDir ? cfgDirOrFile : path.dirname(cfgDirOrFile);\n\tconst cc = cosmiconfig('nodecg', {\n\t\tsearchPlaces: isDir\n\t\t\t? ['nodecg.json', 'nodecg.yaml', 'nodecg.yml', 'nodecg.js', 'nodecg.config.js']\n\t\t\t: [path.basename(cfgDirOrFile)],\n\t\tstopDir: cfgDir,\n\t});\n\tconst result = cc.search(cfgDir);\n\tconst userCfg = result?.config ?? {};\n\n\tif (userCfg?.bundles?.enabled && userCfg?.bundles?.disabled) {\n\t\tthrow new Error('nodecg.json may only contain EITHER bundles.enabled OR bundles.disabled, not both.');\n\t} else if (!userCfg) {\n\t\tconsole.info('[nodecg] No config found, using defaults.');\n\t}\n\n\tconst schema = getConfigSchema(userCfg);\n\n\t/**\n\t * Generate the config in two passes, because Joi is kind of weird.\n\t *\n\t * We apply defaults, but we need to do that in a separate pass\n\t * before we report validation errors.\n\t */\n\tconst { value: cfgWithDefaults } = schema.validate(userCfg, { abortEarly: false, allowUnknown: true });\n\tcfgWithDefaults.baseURL =\n\t\tcfgWithDefaults.baseURL ||\n\t\t`${cfgWithDefaults.host === '0.0.0.0' ? 'localhost' : String(cfgWithDefaults.host)}:${String(\n\t\t\tcfgWithDefaults.port,\n\t\t)}`;\n\n\tconst validationResult = schema.validate(cfgWithDefaults, { noDefaults: true });\n\tif (validationResult.error) {\n\t\tif (!process.env.NODECG_TEST) {\n\t\t\tconsole.error('[nodecg] Config invalid:\\n', validationResult.error.annotate());\n\t\t}\n\n\t\tthrow new Error(validationResult.error.details[0].message);\n\t}\n\n\tconst config: NodeCG.Config = validationResult.value;\n\tif (!config) {\n\t\tif (!process.env.NODECG_TEST) {\n\t\t\tconsole.error('[nodecg] config unexpectedly undefined. This is a bug with NodeCG, not your config.');\n\t\t}\n\n\t\tthrow new Error('config undefined');\n\t}\n\n\t// Create the filtered config\n\tconst filteredConfig: NodeCG.FilteredConfig = {\n\t\thost: config.host,\n\t\tport: config.port,\n\t\tbaseURL: config.baseURL,\n\t\tlogging: {\n\t\t\tconsole: {\n\t\t\t\tenabled: config.logging.console.enabled,\n\t\t\t\tlevel: config.logging.console.level,\n\t\t\t\ttimestamps: config.logging.console.timestamps,\n\t\t\t\treplicants: config.logging.console.replicants,\n\t\t\t},\n\t\t\tfile: {\n\t\t\t\tenabled: config.logging.file.enabled,\n\t\t\t\tlevel: config.logging.file.level,\n\t\t\t\ttimestamps: config.logging.file.timestamps,\n\t\t\t\treplicants: config.logging.file.replicants,\n\t\t\t},\n\t\t},\n\t\tlogin: {\n\t\t\tenabled: config.login?.enabled,\n\t\t},\n\t\tsentry: {\n\t\t\tenabled: config.sentry?.enabled ?? false,\n\t\t\tdsn: config.sentry?.dsn ?? '',\n\t\t},\n\t};\n\n\tif (config.login.steam) {\n\t\tfilteredConfig.login.steam = {\n\t\t\tenabled: config.login.steam.enabled,\n\t\t};\n\t}\n\n\tif (config.login.twitch) {\n\t\tfilteredConfig.login.twitch = {\n\t\t\tenabled: config.login.twitch.enabled,\n\t\t\tclientID: config.login.twitch.clientID, // Validation wil have thrown if this is falsey.\n\t\t\tscope: config.login.twitch.scope,\n\t\t};\n\t}\n\n\tif (config.login.local) {\n\t\tfilteredConfig.login.local = {\n\t\t\tenabled: config.login.local.enabled,\n\t\t};\n\t}\n\n\tif (config.login.discord) {\n\t\tfilteredConfig.login.discord = {\n\t\t\tenabled: config.login.discord.enabled,\n\t\t\tclientID: config.login.discord.clientID, // Validation wil have thrown if this is falsey.\n\t\t\tscope: config.login.discord.scope,\n\t\t};\n\t}\n\n\tif (config.ssl) {\n\t\tfilteredConfig.ssl = {\n\t\t\tenabled: config.ssl.enabled,\n\t\t};\n\t}\n\n\treturn {\n\t\tconfig: clone(config),\n\t\tfilteredConfig: clone(filteredConfig),\n\t};\n}\n","// Native\nimport path from 'path';\n\n// Packages\nimport clone from 'clone';\nimport express from 'express';\n\n// Ours\nimport { config, filteredConfig } from '../config';\nimport * as ncgUtils from '../util';\nimport type BundleManager from '../bundle-manager';\nimport type { NodeCG } from '../../types/nodecg';\nimport rootPath from '../../shared/utils/rootPath';\n\ntype Workspace = NodeCG.Workspace;\n\ntype DashboardContext = {\n\tbundles: NodeCG.Bundle[];\n\tpublicConfig: typeof filteredConfig;\n\tprivateConfig: typeof config;\n\tworkspaces: Workspace[];\n\tsentryEnabled: boolean;\n};\n\nconst BUILD_PATH = path.join(rootPath.path, 'build/client');\nconst VIEWS_PATH = path.join(rootPath.path, 'build/server/templates');\n\nexport default class DashboardLib {\n\tapp = express();\n\n\tdashboardContext: DashboardContext | undefined = undefined;\n\n\tconstructor(bundleManager: BundleManager) {\n\t\tconst { app } = this;\n\n\t\tapp.set('views', VIEWS_PATH);\n\n\t\tapp.use(express.static(BUILD_PATH));\n\n\t\tapp.use('/node_modules', express.static(path.join(rootPath.path, 'node_modules')));\n\n\t\tapp.get('/', (_, res) => {\n\t\t\tres.redirect('/dashboard/');\n\t\t});\n\n\t\tapp.get('/dashboard', ncgUtils.authCheck, (req, res) => {\n\t\t\tif (!req.url.endsWith('/')) {\n\t\t\t\tres.redirect('/dashboard/');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.dashboardContext) {\n\t\t\t\tthis.dashboardContext = getDashboardContext(bundleManager.all());\n\t\t\t}\n\n\t\t\tres.render(path.join(VIEWS_PATH, 'dashboard.tmpl'), this.dashboardContext);\n\t\t});\n\n\t\tapp.get('/nodecg-api.min.js', (_, res) => {\n\t\t\tres.sendFile(path.join(BUILD_PATH, 'api.js'));\n\t\t});\n\n\t\tapp.get('/nodecg-api.min.js.map', (_, res) => {\n\t\t\tres.sendFile(path.join(BUILD_PATH, 'api.js.map'));\n\t\t});\n\n\t\tapp.get('/bundles/:bundleName/dashboard/*', ncgUtils.authCheck, (req, res, next) => {\n\t\t\tconst { bundleName } = req.params;\n\t\t\tconst bundle = bundleManager.find(bundleName);\n\t\t\tif (!bundle) {\n\t\t\t\tnext();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst resName = req.params[0];\n\t\t\t// If the target file is a panel or dialog, inject the appropriate scripts.\n\t\t\t// Else, serve the file as-is.\n\t\t\tconst panel = bundle.dashboard.panels.find((p) => p.file === resName);\n\t\t\tif (panel) {\n\t\t\t\tconst resourceType = panel.dialog ? 'dialog' : 'panel';\n\t\t\t\tncgUtils.injectScripts(\n\t\t\t\t\tpanel.html,\n\t\t\t\t\tresourceType,\n\t\t\t\t\t{\n\t\t\t\t\t\tcreateApiInstance: bundle,\n\t\t\t\t\t\tstandalone: Boolean(req.query.standalone),\n\t\t\t\t\t\tfullbleed: panel.fullbleed,\n\t\t\t\t\t},\n\t\t\t\t\t(html) => res.send(html),\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst parentDir = bundle.dashboard.dir;\n\t\t\t\tconst fileLocation = path.join(parentDir, resName);\n\t\t\t\tncgUtils.sendFile(parentDir, fileLocation, res, next);\n\t\t\t}\n\t\t});\n\n\t\t// When a bundle changes, delete the cached dashboard context\n\t\tbundleManager.on('bundleChanged', () => {\n\t\t\tthis.dashboardContext = undefined;\n\t\t});\n\t}\n}\n\nfunction getDashboardContext(bundles: NodeCG.Bundle[]): DashboardContext {\n\treturn {\n\t\tbundles: bundles.map((bundle) => {\n\t\t\tconst cleanedBundle = clone(bundle);\n\t\t\tif (cleanedBundle.dashboard.panels) {\n\t\t\t\tcleanedBundle.dashboard.panels.forEach((panel) => {\n\t\t\t\t\t// @ts-expect-error This is a performance hack.\n\t\t\t\t\tdelete panel.html;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn cleanedBundle;\n\t\t}),\n\t\tpublicConfig: filteredConfig,\n\t\tprivateConfig: config,\n\t\tworkspaces: parseWorkspaces(bundles),\n\t\tsentryEnabled: global.sentryEnabled,\n\t};\n}\n\nfunction parseWorkspaces(bundles: NodeCG.Bundle[]): Workspace[] {\n\tlet defaultWorkspaceHasPanels = false;\n\tlet otherWorkspacesHavePanels = false;\n\tconst workspaces: Workspace[] = [];\n\tconst workspaceNames = new Set<string>();\n\tbundles.forEach((bundle) => {\n\t\tbundle.dashboard.panels.forEach((panel) => {\n\t\t\tif (panel.dialog) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (panel.fullbleed) {\n\t\t\t\totherWorkspacesHavePanels = true;\n\t\t\t\tconst workspaceName = `__nodecg_fullbleed__${bundle.name}_${panel.name}`;\n\t\t\t\tworkspaces.push({\n\t\t\t\t\tname: workspaceName,\n\t\t\t\t\tlabel: panel.title,\n\t\t\t\t\troute: `fullbleed/${panel.name}`,\n\t\t\t\t\tfullbleed: true,\n\t\t\t\t});\n\t\t\t} else if (panel.workspace === 'default') {\n\t\t\t\tdefaultWorkspaceHasPanels = true;\n\t\t\t} else {\n\t\t\t\tworkspaceNames.add(panel.workspace);\n\t\t\t\totherWorkspacesHavePanels = true;\n\t\t\t}\n\t\t});\n\t});\n\n\tworkspaceNames.forEach((name) => {\n\t\tworkspaces.push({\n\t\t\tname,\n\t\t\tlabel: name,\n\t\t\troute: `workspace/${name}`,\n\t\t});\n\t});\n\n\tworkspaces.sort((a, b) => a.label.localeCompare(b.label));\n\n\tif (defaultWorkspaceHasPanels || !otherWorkspacesHavePanels) {\n\t\tworkspaces.unshift({\n\t\t\tname: 'default',\n\t\t\tlabel: otherWorkspacesHavePanels ? 'Main Workspace' : 'Workspace',\n\t\t\troute: '',\n\t\t});\n\t}\n\n\treturn workspaces;\n}\n","// Native\nimport path from 'path';\n\n// Packages\nimport 'reflect-metadata';\nimport { DataSource } from 'typeorm';\nexport * from './entity';\n\n// Ours\nimport { User } from './entity/User';\nimport { Session } from './entity/Session';\nimport { Role } from './entity/Role';\nimport { Replicant } from './entity/Replicant';\nimport { Permission } from './entity/Permission';\nimport { Identity } from './entity/Identity';\nimport { ApiKey } from './entity/ApiKey';\nimport rootPath from '../../shared/utils/rootPath';\n\nconst dbPath = path.join(rootPath.path, 'db/nodecg.sqlite3');\nexport const testing = process.env.NODECG_TEST?.toLowerCase() === 'true';\n\nconst dataSource = new DataSource({\n\ttype: 'better-sqlite3',\n\n\t/**\n\t * TypeORM has this special :memory: key which indicates\n\t * that an in-memory version of SQLite should be used.\n\t *\n\t * I can't find ANY documentation on this,\n\t * only references to it in GitHub issue threads\n\t * and in the TypeORM source code.\n\t *\n\t * But, bad docs aside, it is still useful\n\t * and we use it for tests.\n\t */\n\tdatabase: testing ? ':memory:' : dbPath,\n\tlogging: false,\n\tentities: [ApiKey, Identity, Permission, Replicant, Role, Session, User],\n\tmigrations: [path.join(rootPath.path, 'build/typeorm/migration/**/*.js')],\n\tsubscribers: [path.join(rootPath.path, 'build/typeorm/subscriber/**/*.js')],\n\tmigrationsRun: true,\n\tsynchronize: false,\n});\n\nexport default dataSource;\n","import { Entity, ManyToOne, Generated, PrimaryColumn } from 'typeorm';\nimport { User } from './User';\n\n@Entity()\nexport class ApiKey {\n\t@PrimaryColumn()\n\t@Generated('uuid')\n\tsecret_key!: string;\n\n\t@ManyToOne(() => User, (user) => user.apiKeys)\n\tuser!: User;\n}\n","import { Entity, ManyToOne, PrimaryGeneratedColumn, Column } from 'typeorm';\nimport { User } from './User';\n\n@Entity()\nexport class Identity {\n\t@PrimaryGeneratedColumn('uuid')\n\tid!: string;\n\n\t@Column('text')\n\tprovider_type!: 'twitch' | 'steam' | 'local' | 'discord';\n\n\t/**\n\t * Hashed password for local, auth token from twitch, etc.\n\t */\n\t@Column('text')\n\tprovider_hash!: string;\n\n\t/**\n\t * Only used by Twitch and Discord providers.\n\t */\n\t@Column('text', { nullable: true })\n\tprovider_access_token: string | null = null;\n\n\t/**\n\t * Only used by Twitch and Discord providers.\n\t */\n\t@Column('text', { nullable: true })\n\tprovider_refresh_token: string | null = null;\n\n\t@ManyToOne(() => User, (user) => user.identities)\n\tuser!: User;\n}\n","/* eslint-disable @typescript-eslint/prefer-literal-enum-member */\nimport { Entity, PrimaryGeneratedColumn, Column, ManyToOne } from 'typeorm';\nimport { Role } from './Role';\n\nexport const enum Action {\n\tNONE = 0,\n\tREAD = 1 << 0,\n\tWRITE = 1 << 1,\n}\n\n@Entity()\nexport class Permission {\n\t@PrimaryGeneratedColumn('uuid')\n\tid!: string;\n\n\t@Column('text')\n\tname!: string;\n\n\t@ManyToOne(() => Role, (role) => role.permissions)\n\trole!: Role;\n\n\t@Column('text')\n\tentityId!: string;\n\n\t@Column('int')\n\tactions!: number;\n}\n","import { Entity, PrimaryColumn, Column } from 'typeorm';\n\n@Entity()\nexport class Replicant {\n\t@PrimaryColumn('text')\n\tnamespace!: string;\n\n\t@PrimaryColumn('text')\n\tname!: string;\n\n\t@Column('text')\n\tvalue!: string;\n}\n","import { Entity, PrimaryGeneratedColumn, Column, OneToMany } from 'typeorm';\nimport { Permission } from './Permission';\n\n@Entity()\nexport class Role {\n\t@PrimaryGeneratedColumn('uuid')\n\tid!: string;\n\n\t@Column({\n\t\ttype: 'text',\n\t\tunique: true,\n\t})\n\tname!: string;\n\n\t@OneToMany(() => Permission, (permission) => permission.role)\n\tpermissions!: Permission[];\n}\n","import type { ISession } from 'connect-typeorm';\nimport { Column, Entity, Index, PrimaryColumn, DeleteDateColumn } from 'typeorm';\nimport type { ValueTransformer } from 'typeorm';\n\n// Postgres returns string by default. Return number instead.\nconst Bigint: ValueTransformer = {\n\tfrom: (value) => Number(value),\n\tto: (value) => (value === Infinity ? '+Infinity' : Number(value)),\n};\n\n@Entity()\nexport class Session implements ISession {\n\t@Index()\n\t@Column('bigint', { transformer: Bigint })\n\texpiredAt = Date.now();\n\n\t@PrimaryColumn('varchar', { length: 255 })\n\tid = '';\n\n\t@Column('text')\n\tjson = '';\n\n\t@DeleteDateColumn()\n\tpublic destroyedAt?: Date;\n}\n","import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, ManyToMany, JoinTable, OneToMany } from 'typeorm';\nimport { Role } from './Role';\nimport { Identity } from './Identity';\nimport { ApiKey } from './ApiKey';\n\n@Entity()\nexport class User {\n\t@PrimaryGeneratedColumn('uuid')\n\tid!: string;\n\n\t@CreateDateColumn()\n\tcreated_at!: number;\n\n\t@Column('text')\n\tname!: string;\n\n\t@ManyToMany(() => Role)\n\t@JoinTable()\n\troles!: Role[];\n\n\t@OneToMany(() => Identity, (identity) => identity.user)\n\tidentities!: Identity[];\n\n\t@OneToMany(() => ApiKey, (apiKey) => apiKey.user)\n\tapiKeys!: ApiKey[];\n}\n","export * from './ApiKey';\nexport * from './Identity';\nexport * from './Permission';\nexport * from './Replicant';\nexport * from './Role';\nexport * from './Session';\nexport * from './User';\n","// Packages\nimport { type DataSource } from 'typeorm';\n\n// Ours\nimport createLogger from '../logger';\nimport dataSource, { testing } from './datasource';\nexport * from './entity';\n\nconst log = createLogger('database');\nlet initialized = false;\n\nexport async function getConnection(): Promise<DataSource> {\n\tif (!initialized) {\n\t\tif (testing) {\n\t\t\tlog.warn('Using in-memory test database.');\n\t\t}\n\n\t\tawait dataSource.initialize();\n\t\tinitialized = true;\n\t}\n\n\treturn dataSource;\n}\n","import { getConnection, User, Role, Identity } from '../database';\nimport { ApiKey } from './entity/ApiKey';\n\nexport async function findUser(id: User['id']): Promise<User | null> {\n\tconst database = await getConnection();\n\treturn database\n\t\t.getRepository(User)\n\t\t.findOne({ where: { id }, relations: ['roles', 'identities', 'apiKeys'], cache: true });\n}\n\nexport async function getSuperUserRole(): Promise<Role> {\n\tconst superUserRole = await findRole('superuser');\n\tif (!superUserRole) {\n\t\tthrow new Error('superuser role unexpectedly not found');\n\t}\n\n\treturn superUserRole;\n}\n\nexport async function upsertUser({\n\tname,\n\tprovider_type,\n\tprovider_hash,\n\tprovider_access_token,\n\tprovider_refresh_token,\n\troles,\n}: {\n\tname: User['name'];\n\tprovider_type: Identity['provider_type'];\n\tprovider_hash: Identity['provider_hash'];\n\tprovider_access_token?: Identity['provider_access_token'];\n\tprovider_refresh_token?: Identity['provider_refresh_token'];\n\troles: User['roles'];\n}): Promise<User> {\n\tconst database = await getConnection();\n\tconst { manager } = database;\n\tlet user: User;\n\n\t// Check for ident that matches.\n\t// If found, it should have an associated user, so return that.\n\t// Else, make an ident and user.\n\tconst existingIdent = await findIdent(provider_type, provider_hash);\n\tif (existingIdent) {\n\t\texistingIdent.provider_access_token = provider_access_token ?? null;\n\t\texistingIdent.provider_refresh_token = provider_refresh_token ?? null;\n\t\tawait manager.save(existingIdent);\n\t\tuser = existingIdent.user;\n\t} else {\n\t\tconst ident = await createIdentity({\n\t\t\tprovider_type,\n\t\t\tprovider_hash,\n\t\t\tprovider_access_token: provider_access_token ?? null,\n\t\t\tprovider_refresh_token: provider_refresh_token ?? null,\n\t\t});\n\t\tconst apiKey = await createApiKey();\n\t\tuser = manager.create(User, {\n\t\t\tname,\n\t\t\tidentities: [ident],\n\t\t\tapiKeys: [apiKey],\n\t\t});\n\t}\n\n\t// Always update the roles, regardless of if we are making a new user or updating an existing one.\n\tuser.roles = roles;\n\treturn manager.save(user);\n}\n\nexport function isSuperUser(user: User): boolean {\n\treturn Boolean(user.roles?.find((role) => role.name === 'superuser'));\n}\n\nasync function findRole(name: Role['name']): Promise<Role | null> {\n\tconst database = await getConnection();\n\tconst { manager } = database;\n\treturn manager.findOne(Role, { where: { name }, relations: ['permissions'] });\n}\n\nasync function createIdentity(\n\tidentInfo: Pick<Identity, 'provider_type' | 'provider_hash' | 'provider_access_token' | 'provider_refresh_token'>,\n): Promise<Identity> {\n\tconst database = await getConnection();\n\tconst { manager } = database;\n\t// See https://github.com/typeorm/typeorm/issues/9070\n\tconst ident = manager.create<Identity>(Identity, identInfo);\n\treturn manager.save(ident);\n}\n\nasync function createApiKey(): Promise<ApiKey> {\n\tconst database = await getConnection();\n\tconst { manager } = database;\n\tconst apiKey = manager.create(ApiKey);\n\treturn manager.save(apiKey);\n}\n\nasync function findIdent(type: Identity['provider_type'], hash: Identity['provider_hash']): Promise<Identity | null> {\n\tconst database = await getConnection();\n\treturn database.getRepository(Identity).findOne({\n\t\twhere: { provider_hash: hash, provider_type: type },\n\t\trelations: ['user'],\n\t});\n}\n","// Native\nimport path from 'path';\n\n// Packages\nimport express from 'express';\n\n// Ours\nimport { authCheck, injectScripts, sendFile } from '../util';\nimport RegistrationCoordinator from './registration';\nimport type { Replicator } from '../replicant';\nimport type { RootNS } from '../../types/socket-protocol';\nimport type BundleManager from '../bundle-manager';\n\nexport default class GraphicsLib {\n\tapp = express();\n\n\tconstructor(io: RootNS, bundleManager: BundleManager, replicator: Replicator) {\n\t\tconst { app } = this;\n\n\t\t// Start up the registration lib, which tracks how many instances of\n\t\t// a graphic are open, and enforces singleInstance behavior.\n\t\tapp.use(new RegistrationCoordinator(io, bundleManager, replicator).app);\n\n\t\tapp.get('/bundles/:bundleName/graphics*', authCheck, (req, res, next) => {\n\t\t\tconst { bundleName } = req.params as Record<string, string>;\n\t\t\tconst bundle = bundleManager.find(bundleName);\n\t\t\tif (!bundle) {\n\t\t\t\tnext();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// We start out assuming the user is trying to reach the index page\n\t\t\tlet resName = 'index.html';\n\n\t\t\t// We need a trailing slash for view index pages so that relatively linked assets can be reached as expected.\n\t\t\tif (req.path.endsWith(`/${bundleName}/graphics`)) {\n\t\t\t\tres.redirect(`${req.url}/`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If the url path has more params beyond just /graphics/,\n\t\t\t// then the user is trying to resolve an asset and not the index page.\n\t\t\tif (!req.path.endsWith(`/${bundleName}/graphics/`)) {\n\t\t\t\tresName = req.params[0];\n\t\t\t}\n\n\t\t\t// Set a flag if this graphic is one we should enforce singleInstance behavior on.\n\t\t\t// This flag is passed to injectScripts, which then injects the client-side portion of the\n\t\t\t// singleInstance enforcement.\n\t\t\tlet isGraphic = false;\n\t\t\tbundle.graphics.some((graphic) => {\n\t\t\t\tif (`/${graphic.file}` === resName || graphic.file === resName) {\n\t\t\t\t\tisGraphic = true;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tconst parentDir = path.join(bundle.dir, 'graphics');\n\t\t\tconst fileLocation = path.join(parentDir, resName);\n\t\t\t// If this file is a main HTML file for a graphic, inject the graphic setup scripts.\n\t\t\tif (isGraphic) {\n\t\t\t\tinjectScripts(\n\t\t\t\t\tfileLocation,\n\t\t\t\t\t'graphic',\n\t\t\t\t\t{\n\t\t\t\t\t\tcreateApiInstance: bundle,\n\t\t\t\t\t\tsound: bundle.soundCues && bundle.soundCues.length > 0,\n\t\t\t\t\t},\n\t\t\t\t\t(html) => res.send(html),\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tsendFile(parentDir, fileLocation, res, next);\n\t\t\t}\n\t\t});\n\n\t\t// This isn't really a graphics-specific thing, should probably be in the main server lib.\n\t\tapp.get('/bundles/:bundleName/:target(bower_components|node_modules)/*', (req, res, next) => {\n\t\t\tconst { bundleName } = req.params;\n\t\t\tconst bundle = bundleManager.find(bundleName);\n\t\t\tif (!bundle) {\n\t\t\t\tnext();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst resName = req.params[0];\n\t\t\tconst parentDir = path.join(bundle.dir, req.params.target);\n\t\t\tconst fileLocation = path.join(parentDir, resName);\n\t\t\tsendFile(parentDir, fileLocation, res, next);\n\t\t});\n\t}\n}\n","// Native\nimport path from 'path';\nimport fs from 'fs';\n\n// Packages\nimport express from 'express';\n\n// Ours\nimport { injectScripts } from '../util';\nimport type { Replicator } from '../replicant';\nimport type ServerReplicant from '../replicant/server-replicant';\nimport type { RootNS, GraphicRegRequest } from '../../types/socket-protocol';\nimport type BundleManager from '../bundle-manager';\nimport type { NodeCG } from '../../types/nodecg';\nimport isChildOf from '../util/isChildOf';\nimport rootPath from '../../shared/utils/rootPath';\n\ntype GraphicsInstance = NodeCG.GraphicsInstance;\n\nconst BUILD_PATH = path.join(rootPath.path, 'build/client/instance');\n\nexport default class RegistrationCoordinator {\n\tapp = express();\n\n\tprivate readonly _instancesRep: ServerReplicant<\n\t\tGraphicsInstance[],\n\t\tNodeCG.Replicant.OptionsWithDefault<GraphicsInstance[]>\n\t>;\n\n\tprivate readonly _bundleManager: BundleManager;\n\n\tconstructor(io: RootNS, bundleManager: BundleManager, replicator: Replicator) {\n\t\tthis._bundleManager = bundleManager;\n\t\tconst { app } = this;\n\n\t\tthis._instancesRep = replicator.declare('graphics:instances', 'nodecg', {\n\t\t\tschemaPath: path.resolve(rootPath.path, 'schemas/graphics%3Ainstances.json'),\n\t\t\tpersistent: false,\n\t\t\tdefaultValue: [],\n\t\t});\n\n\t\tbundleManager.on('bundleChanged', this._updateInstanceStatuses.bind(this));\n\t\tbundleManager.on('gitChanged', this._updateInstanceStatuses.bind(this));\n\n\t\tio.on('connection', (socket) => {\n\t\t\tsocket.on('graphic:registerSocket', (regRequest, cb) => {\n\t\t\t\tconst { bundleName } = regRequest;\n\t\t\t\tlet { pathName } = regRequest;\n\t\t\t\tif (pathName.endsWith(`/${bundleName}/graphics/`)) {\n\t\t\t\t\tpathName += 'index.html';\n\t\t\t\t}\n\n\t\t\t\tconst bundle = bundleManager.find(bundleName);\n\t\t\t\t/* istanbul ignore if: simple error trapping */\n\t\t\t\tif (!bundle) {\n\t\t\t\t\tcb(undefined, false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst graphicManifest = this._findGraphicManifest({ bundleName, pathName });\n\n\t\t\t\t/* istanbul ignore if: simple error trapping */\n\t\t\t\tif (!graphicManifest) {\n\t\t\t\t\tcb(undefined, false);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst existingSocketRegistration = this._findRegistrationBySocketId(socket.id);\n\t\t\t\tconst existingPathRegistration = this._findOpenRegistrationByPathName(pathName);\n\n\t\t\t\t// If there is an existing registration with this pathName,\n\t\t\t\t// and this is a singleInstance graphic,\n\t\t\t\t// then deny the registration, unless the socket ID matches.\n\t\t\t\tif (existingPathRegistration && graphicManifest.singleInstance) {\n\t\t\t\t\tif (existingPathRegistration.socketId === socket.id) {\n\t\t\t\t\t\tcb(undefined, true);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcb(undefined, !existingPathRegistration.open);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (existingSocketRegistration) {\n\t\t\t\t\texistingSocketRegistration.open = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis._addRegistration({\n\t\t\t\t\t\t...regRequest,\n\t\t\t\t\t\tipv4: socket.request.socket.remoteAddress!,\n\t\t\t\t\t\tsocketId: socket.id,\n\t\t\t\t\t\tsingleInstance: Boolean(graphicManifest.singleInstance),\n\t\t\t\t\t\tpotentiallyOutOfDate:\n\t\t\t\t\t\t\tcalcBundleGitMismatch(bundle, regRequest) || calcBundleVersionMismatch(bundle, regRequest),\n\t\t\t\t\t\topen: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (graphicManifest.singleInstance) {\n\t\t\t\t\t\tapp.emit('graphicOccupied', pathName);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcb(undefined, true);\n\t\t\t});\n\n\t\t\tsocket.on('graphic:queryAvailability', (pathName, cb) => {\n\t\t\t\tcb(undefined, !this._findOpenRegistrationByPathName(pathName));\n\t\t\t});\n\n\t\t\tsocket.on('graphic:requestBundleRefresh', (bundleName, cb) => {\n\t\t\t\tconst bundle = bundleManager.find(bundleName);\n\t\t\t\tif (!bundle) {\n\t\t\t\t\tcb(undefined, undefined);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tio.emit('graphic:bundleRefresh', bundleName);\n\t\t\t\tcb(undefined, undefined);\n\t\t\t});\n\n\t\t\tsocket.on('graphic:requestRefreshAll', (graphic, cb) => {\n\t\t\t\tio.emit('graphic:refreshAll', graphic);\n\t\t\t\tif (typeof cb === 'function') {\n\t\t\t\t\tcb(undefined, undefined);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsocket.on('graphic:requestRefresh', (instance, cb) => {\n\t\t\t\tio.emit('graphic:refresh', instance);\n\t\t\t\tcb(undefined, undefined);\n\t\t\t});\n\n\t\t\tsocket.on('graphic:requestKill', (instance, cb) => {\n\t\t\t\tio.emit('graphic:kill', instance);\n\t\t\t\tcb(undefined, undefined);\n\t\t\t});\n\n\t\t\tsocket.on('disconnect', () => {\n\t\t\t\t// Unregister the socket.\n\t\t\t\tconst registration = this._findRegistrationBySocketId(socket.id);\n\t\t\t\tif (!registration) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tregistration.open = false;\n\t\t\t\tif (registration.singleInstance) {\n\t\t\t\t\tapp.emit('graphicAvailable', registration.pathName);\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._removeRegistration(socket.id);\n\t\t\t\t}, 1000);\n\t\t\t});\n\t\t});\n\n\t\tapp.get('/instance/*', (req, res, next) => {\n\t\t\tconst resName = req.path.split('/').slice(2).join('/');\n\n\t\t\t// If it's a HTML file, inject the graphic setup script and serve that\n\t\t\t// otherwise, send the file unmodified\n\t\t\tconst fileLocation = path.join(BUILD_PATH, resName);\n\t\t\tif (resName.endsWith('.html') && isChildOf(BUILD_PATH, fileLocation)) {\n\t\t\t\tif (fs.existsSync(fileLocation)) {\n\t\t\t\t\tinjectScripts(fileLocation, 'graphic', {}, (html) => res.send(html));\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnext();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _addRegistration(registration: GraphicsInstance): void {\n\t\tthis._instancesRep.value.push({\n\t\t\t...registration,\n\t\t\topen: true,\n\t\t});\n\t}\n\n\tprivate _removeRegistration(socketId: string): GraphicsInstance | false {\n\t\tconst registrationIndex = this._instancesRep.value.findIndex((instance) => instance.socketId === socketId);\n\n\t\t/* istanbul ignore next: simple error trapping */\n\t\tif (registrationIndex < 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._instancesRep.value.splice(registrationIndex, 1)[0];\n\t}\n\n\tprivate _findRegistrationBySocketId(socketId: string): GraphicsInstance | undefined {\n\t\treturn this._instancesRep.value.find((instance) => instance.socketId === socketId);\n\t}\n\n\tprivate _findOpenRegistrationByPathName(pathName: string): GraphicsInstance | undefined {\n\t\treturn this._instancesRep.value.find((instance) => instance.pathName === pathName && instance.open);\n\t}\n\n\tprivate _updateInstanceStatuses(): void {\n\t\tthis._instancesRep.value.forEach((instance) => {\n\t\t\tconst { bundleName, pathName } = instance;\n\t\t\tconst bundle = this._bundleManager.find(bundleName);\n\t\t\t/* istanbul ignore next: simple error trapping */\n\t\t\tif (!bundle) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst graphicManifest = this._findGraphicManifest({ bundleName, pathName });\n\t\t\t/* istanbul ignore next: simple error trapping */\n\t\t\tif (!graphicManifest) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tinstance.potentiallyOutOfDate =\n\t\t\t\tcalcBundleGitMismatch(bundle, instance) || calcBundleVersionMismatch(bundle, instance);\n\t\t\tinstance.singleInstance = Boolean(graphicManifest.singleInstance);\n\t\t});\n\t}\n\n\tprivate _findGraphicManifest({\n\t\tpathName,\n\t\tbundleName,\n\t}: {\n\t\tpathName: string;\n\t\tbundleName: string;\n\t}): NodeCG.Bundle.Graphic | undefined {\n\t\tconst bundle = this._bundleManager.find(bundleName);\n\t\t/* istanbul ignore if: simple error trapping */\n\t\tif (!bundle) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn bundle.graphics.find((graphic) => graphic.url === pathName);\n\t}\n}\n\nfunction calcBundleGitMismatch(bundle: NodeCG.Bundle, regRequest: GraphicRegRequest): boolean {\n\tif (regRequest.bundleGit && !bundle.git) {\n\t\treturn true;\n\t}\n\n\tif (!regRequest.bundleGit && bundle.git) {\n\t\treturn true;\n\t}\n\n\tif (!regRequest.bundleGit && !bundle.git) {\n\t\treturn false;\n\t}\n\n\treturn regRequest.bundleGit!.hash !== bundle.git!.hash;\n}\n\nfunction calcBundleVersionMismatch(bundle: NodeCG.Bundle, regRequest: GraphicRegRequest): boolean {\n\treturn bundle.version !== regRequest.bundleVersion;\n}\n","// Packages\nimport * as Sentry from '@sentry/node';\n\n// Ours\nimport { config } from '../config';\nimport loggerFactory from './logger.server';\nimport type { LoggerInterface } from '../../shared/logger-interface';\n\nexport let Logger: new (name: string) => LoggerInterface;\nif (config.sentry?.enabled) {\n\tLogger = loggerFactory(config.logging, Sentry);\n} else {\n\tLogger = loggerFactory(config.logging);\n}\n\nexport default function (name: string): LoggerInterface {\n\treturn new Logger(name);\n}\n","// Native\nimport * as path from 'path';\nimport { format, inspect } from 'util';\n\n// Packages\nimport * as fs from 'fs-extra';\nimport winston from 'winston';\nimport type * as Sentry from '@sentry/node';\n\n// Ours\nimport type { LoggerInterface } from '../../shared/logger-interface';\nimport { LogLevel } from '../../shared/logger-interface';\n\ntype LoggerOptions = {\n\tconsole: Partial<{\n\t\tenabled: boolean;\n\t\ttimestamps: boolean;\n\t\tlevel: LogLevel;\n\t\treplicants: boolean;\n\t}>;\n\tfile: Partial<{\n\t\tenabled: boolean;\n\t\ttimestamps: boolean;\n\t\tlevel: LogLevel;\n\t\tpath: string;\n\t\treplicants: boolean;\n\t}>;\n};\n\n/**\n * A factory that configures and returns a Logger constructor.\n *\n * @returns A constructor used to create discrete logger instances.\n */\n\nexport default function (initialOpts: Partial<LoggerOptions> = {}, sentry: typeof Sentry | undefined = undefined) {\n\tinitialOpts = initialOpts || {};\n\tinitialOpts.console = initialOpts.console ?? {};\n\tinitialOpts.file = initialOpts.file ?? {};\n\tinitialOpts.file.path = initialOpts.file.path ?? 'logs/nodecg.log';\n\n\tconst consoleTransport = new winston.transports.Console({\n\t\tlevel: initialOpts.console.level ?? LogLevel.Info,\n\t\tsilent: !initialOpts.console.enabled,\n\t\tstderrLevels: ['warn', 'error'],\n\t\tformat: winston.format.combine(\n\t\t\twinston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }), // Format local time for console.\n\t\t\twinston.format.errors({ stack: true }),\n\t\t\twinston.format.colorize(),\n\t\t\twinston.format.printf(\n\t\t\t\t(info) =>\n\t\t\t\t\t`${initialOpts?.console?.timestamps ? `${info.timestamp} - ` : ''}${info.level}: ${info.message}`,\n\t\t\t),\n\t\t),\n\t});\n\n\tconst fileTransport = new winston.transports.File({\n\t\tfilename: initialOpts.file.path,\n\t\tlevel: initialOpts.file.level ?? LogLevel.Info,\n\t\tsilent: !initialOpts.file.enabled,\n\t\tformat: winston.format.combine(\n\t\t\twinston.format.timestamp(), // Leave formatting as ISO 8601 UTC for file.\n\t\t\twinston.format.errors({ stack: true }),\n\t\t\twinston.format.printf(\n\t\t\t\t(info) =>\n\t\t\t\t\t`${initialOpts?.file?.timestamps ? `${info.timestamp} - ` : ''}${info.level}: ${info.message}`,\n\t\t\t),\n\t\t),\n\t});\n\n\tif (typeof initialOpts.file.path !== 'undefined') {\n\t\tfileTransport.filename = initialOpts.file.path;\n\n\t\t// Make logs folder if it does not exist.\n\t\tif (!fs.existsSync(path.dirname(initialOpts.file.path))) {\n\t\t\tfs.mkdirpSync(path.dirname(initialOpts.file.path));\n\t\t}\n\t}\n\n\twinston.addColors({\n\t\tverbose: 'green',\n\t\tdebug: 'cyan',\n\t\tinfo: 'white',\n\t\twarn: 'yellow',\n\t\terror: 'red',\n\t});\n\n\tconst consoleLogger = winston.createLogger({\n\t\ttransports: [consoleTransport],\n\t\tlevels: {\n\t\t\tverbose: 4,\n\t\t\ttrace: 4,\n\t\t\tdebug: 3,\n\t\t\tinfo: 2,\n\t\t\twarn: 1,\n\t\t\terror: 0,\n\t\t},\n\t});\n\n\tconst fileLogger = winston.createLogger({\n\t\ttransports: [fileTransport],\n\t\tlevels: {\n\t\t\tverbose: 4,\n\t\t\ttrace: 4,\n\t\t\tdebug: 3,\n\t\t\tinfo: 2,\n\t\t\twarn: 1,\n\t\t\terror: 0,\n\t\t},\n\t});\n\n\t/**\n\t * Constructs a new Logger instance that prefixes all output with the given name.\n\t * @param name {String} - The label to prefix all output of this logger with.\n\t * @returns {Object} - A Logger instance.\n\t * @constructor\n\t */\n\treturn class Logger implements LoggerInterface {\n\t\tstatic readonly _consoleLogger = consoleLogger;\n\t\tstatic readonly _fileLogger = fileLogger;\n\n\t\t// A messy bit of internal state used to determine if the special-case \"replicants\" logging level is active.\n\t\tstatic _shouldConsoleLogReplicants = Boolean(initialOpts.console?.replicants);\n\t\tstatic _shouldFileLogReplicants = Boolean(initialOpts.file?.replicants);\n\n\t\tconstructor(public name: string) {\n\t\t\tthis.name = name;\n\t\t}\n\n\t\ttrace(...args: any[]): void {\n\t\t\t[consoleLogger, fileLogger].forEach((logger) =>\n\t\t\t\tlogger.verbose(`[${this.name}] ${format(args[0], ...args.slice(1))}`),\n\t\t\t);\n\t\t}\n\n\t\tdebug(...args: any[]): void {\n\t\t\t[consoleLogger, fileLogger].forEach((logger) =>\n\t\t\t\tlogger.debug(`[${this.name}] ${format(args[0], ...args.slice(1))}`),\n\t\t\t);\n\t\t}\n\n\t\tinfo(...args: any[]): void {\n\t\t\t[consoleLogger, fileLogger].forEach((logger) =>\n\t\t\t\tlogger.info(`[${this.name}] ${format(args[0], ...args.slice(1))}`),\n\t\t\t);\n\t\t}\n\n\t\twarn(...args: any[]): void {\n\t\t\t[consoleLogger, fileLogger].forEach((logger) =>\n\t\t\t\tlogger.warn(`[${this.name}] ${format(args[0], ...args.slice(1))}`),\n\t\t\t);\n\t\t}\n\n\t\terror(...args: any[]): void {\n\t\t\t[consoleLogger, fileLogger].forEach((logger) =>\n\t\t\t\tlogger.error(`[${this.name}] ${format(args[0], ...args.slice(1))}`),\n\t\t\t);\n\n\t\t\tif (sentry) {\n\t\t\t\tconst formattedArgs = args.map((argument) =>\n\t\t\t\t\ttypeof argument === 'object' ? inspect(argument, { depth: null, showProxy: true }) : argument,\n\t\t\t\t);\n\n\t\t\t\tsentry.captureException(\n\t\t\t\t\tnew Error(`[${this.name}] ` + format(formattedArgs[0], ...formattedArgs.slice(1))),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treplicants(...args: any[]): void {\n\t\t\tif (Logger._shouldConsoleLogReplicants) {\n\t\t\t\tconsoleLogger.info(`[${this.name}] ${format(args[0], ...args.slice(1))}`);\n\t\t\t}\n\n\t\t\tif (Logger._shouldFileLogReplicants) {\n\t\t\t\tfileLogger.info(`[${this.name}] ${format(args[0], ...args.slice(1))}`);\n\t\t\t}\n\t\t}\n\t};\n}\n","import type { UnAuthErrCode } from '../../types/socket-protocol';\n\nexport default class UnauthorizedError extends Error {\n\tserialized: { message: string; code: UnAuthErrCode; type: 'UnauthorizedError' };\n\n\tconstructor(code: UnAuthErrCode, message: string) {\n\t\tsuper(message);\n\t\tthis.message = message;\n\t\tthis.serialized = {\n\t\t\tmessage: this.message,\n\t\t\tcode,\n\t\t\ttype: 'UnauthorizedError',\n\t\t};\n\t}\n}\n","// Native\nimport path from 'path';\nimport crypto from 'crypto';\n\n// Packages\nimport express from 'express';\nimport expressSession from 'express-session';\nimport passport from 'passport';\nimport steamStrategy from 'passport-steam';\nimport { Strategy as LocalStrategy } from 'passport-local';\nimport { TypeormStore } from 'connect-typeorm';\nimport cookieParser from 'cookie-parser';\nimport fetch from 'node-fetch-commonjs';\n\n// Ours\nimport { config } from '../config';\nimport createLogger from '../logger';\nimport type { User, Role } from '../database';\nimport { Session, getConnection } from '../database';\nimport { findUser, upsertUser, getSuperUserRole, isSuperUser } from '../database/utils';\nimport rootPath from '../../shared/utils/rootPath';\n\ntype StrategyDoneCb = (error: NodeJS.ErrnoException | undefined, profile?: User) => void;\n\n/**\n * The \"user profile\" for Steam-authenticated users, as consumed by Express.\n */\ntype SteamProfile = { id: string; displayName: string };\n\n/**\n * The \"user profile\" for Twitch-authenticated users, as consumed by Express.\n */\ntype TwitchProfile = {\n\tprovider: 'twitch';\n\tid: string;\n\tusername: string;\n\tdisplayName: string;\n\temail: string;\n};\n\n/**\n * The \"user profile\" for Discord-authenticated users, as consumed by Express.\n */\ntype DiscordProfile = {\n\tprovider: 'discord';\n\taccessToken: string;\n\tusername: string;\n\tdiscriminator: string;\n\tid: string;\n\tguilds: Array<{ id: string; name: string }>;\n};\n\nconst log = createLogger('login');\nconst protocol = config.ssl?.enabled ?? config.login.forceHttpsReturn ? 'https' : 'http';\n\n// Required for persistent login sessions.\n// Passport needs ability to serialize and unserialize users out of session.\npassport.serializeUser<User['id']>((user, done) => {\n\tdone(null, user.id);\n});\npassport.deserializeUser<User['id']>(async (id, done) => {\n\ttry {\n\t\tdone(null, await findUser(id));\n\t} catch (error: unknown) {\n\t\tdone(error);\n\t}\n});\n\nif (config.login.steam?.enabled) {\n\tpassport.use(\n\t\tsteamStrategy(\n\t\t\t{\n\t\t\t\treturnURL: `${protocol}://${config.baseURL}/login/auth/steam`,\n\t\t\t\trealm: `${protocol}://${config.baseURL}/login/auth/steam`,\n\t\t\t\tapiKey: config.login.steam.apiKey,\n\t\t\t},\n\t\t\tasync (_: unknown, profile: SteamProfile, done: StrategyDoneCb) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst roles: Role[] = [];\n\t\t\t\t\tconst allowed = config.login.steam?.allowedIds?.includes(profile.id);\n\t\t\t\t\tif (allowed) {\n\t\t\t\t\t\tlog.info('(Steam) Granting \"%s\" (%s) access', profile.id, profile.displayName);\n\t\t\t\t\t\troles.push(await getSuperUserRole());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.info('(Steam) Denying \"%s\" (%s) access', profile.id, profile.displayName);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst user = await upsertUser({\n\t\t\t\t\t\tname: profile.displayName,\n\t\t\t\t\t\tprovider_type: 'steam',\n\t\t\t\t\t\tprovider_hash: profile.id,\n\t\t\t\t\t\troles,\n\t\t\t\t\t});\n\t\t\t\t\tdone(undefined, user);\n\t\t\t\t\treturn;\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t\t\t\t} catch (error: any) {\n\t\t\t\t\tdone(error);\n\t\t\t\t}\n\t\t\t},\n\t\t),\n\t);\n}\n\nif (config.login.twitch?.enabled) {\n\tconst TwitchStrategy = require('passport-twitch-helix').Strategy;\n\n\t// The \"user:read:email\" scope is required. Add it if not present.\n\tconst scopesArray = config.login.twitch.scope.split(' ');\n\tif (!scopesArray.includes('user:read:email')) {\n\t\tscopesArray.push('user:read:email');\n\t}\n\n\tconst concatScopes = scopesArray.join(' ');\n\n\tpassport.use(\n\t\tnew TwitchStrategy(\n\t\t\t{\n\t\t\t\tclientID: config.login.twitch.clientID,\n\t\t\t\tclientSecret: config.login.twitch.clientSecret,\n\t\t\t\tcallbackURL: `${protocol}://${config.baseURL}/login/auth/twitch`,\n\t\t\t\tscope: concatScopes,\n\t\t\t\tcustomHeaders: { 'Client-ID': config.login.twitch.clientID },\n\t\t\t},\n\t\t\tasync (accessToken: string, refreshToken: string, profile: TwitchProfile, done: StrategyDoneCb) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst roles: Role[] = [];\n\t\t\t\t\tconst allowed =\n\t\t\t\t\t\tconfig.login.twitch?.allowedUsernames?.includes(profile.username) ??\n\t\t\t\t\t\tconfig.login.twitch?.allowedIds?.includes(profile.id);\n\t\t\t\t\tif (allowed) {\n\t\t\t\t\t\tlog.info('(Twitch) Granting %s access', profile.username);\n\t\t\t\t\t\troles.push(await getSuperUserRole());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.info('(Twitch) Denying %s access', profile.username);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst user = await upsertUser({\n\t\t\t\t\t\tname: profile.displayName,\n\t\t\t\t\t\tprovider_type: 'twitch',\n\t\t\t\t\t\tprovider_hash: profile.id,\n\t\t\t\t\t\tprovider_access_token: accessToken,\n\t\t\t\t\t\tprovider_refresh_token: refreshToken,\n\t\t\t\t\t\troles,\n\t\t\t\t\t});\n\t\t\t\t\tdone(undefined, user);\n\t\t\t\t\treturn;\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t\t\t\t} catch (error: any) {\n\t\t\t\t\tdone(error);\n\t\t\t\t}\n\t\t\t},\n\t\t),\n\t);\n}\n\nasync function makeDiscordAPIRequest(\n\tguild: { guildID: string; guildBotToken: string; allowedRoleIDs: string[] },\n\tuserID: string,\n): Promise<[{ guildID: string; guildBotToken: string; allowedRoleIDs: string[] }, boolean, { roles: string[] }]> {\n\tconst res = await fetch(`https://discord.com/api/v8/guilds/${guild.guildID}/members/${userID}`, {\n\t\theaders: {\n\t\t\tAuthorization: `Bot ${guild.guildBotToken}`,\n\t\t},\n\t});\n\n\tconst data = (await res.json()) as any;\n\tif (res.status === 200) {\n\t\treturn [guild, false, data];\n\t}\n\n\treturn [guild, true, data];\n}\n\nif (config.login.discord?.enabled) {\n\tconst DiscordStrategy = require('passport-discord').Strategy;\n\n\t// The \"identify\" scope is required. Add it if not present.\n\tconst scopeArray = config.login.discord.scope.split(' ');\n\tif (!scopeArray.includes('identify')) {\n\t\tscopeArray.push('identify');\n\t}\n\n\t// The \"guilds\" scope is required if allowedGuilds are used. Add it if not present.\n\tif (!scopeArray.includes('guilds') && config.login.discord.allowedGuilds) {\n\t\tscopeArray.push('guilds');\n\t}\n\n\tconst scope = scopeArray.join(' ');\n\tpassport.use(\n\t\tnew DiscordStrategy(\n\t\t\t{\n\t\t\t\tclientID: config.login.discord.clientID,\n\t\t\t\tclientSecret: config.login.discord.clientSecret,\n\t\t\t\tcallbackURL: `${protocol}://${config.baseURL}/login/auth/discord`,\n\t\t\t\tscope,\n\t\t\t},\n\t\t\tasync (accessToken: string, refreshToken: string, profile: DiscordProfile, done: StrategyDoneCb) => {\n\t\t\t\tif (!config.login.discord) {\n\t\t\t\t\t// Impossible but TS doesn't know that.\n\t\t\t\t\tdone(new Error('Discord login config was impossibly undefined.'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet allowed = false;\n\t\t\t\tif (config.login.discord.allowedUserIDs?.includes(profile.id)) {\n\t\t\t\t\t// Users that are on allowedUserIDs are allowed\n\t\t\t\t\tallowed = true;\n\t\t\t\t} else if (config.login.discord.allowedGuilds) {\n\t\t\t\t\t// Get guilds that are specified in the config and that user is in\n\t\t\t\t\tconst intersectingGuilds = config.login.discord.allowedGuilds.filter((allowedGuild) =>\n\t\t\t\t\t\tprofile.guilds.some((profileGuild) => profileGuild.id === allowedGuild.guildID),\n\t\t\t\t\t);\n\n\t\t\t\t\tconst guildRequests = [];\n\n\t\t\t\t\tfor (const intersectingGuild of intersectingGuilds) {\n\t\t\t\t\t\tif (!intersectingGuild.allowedRoleIDs || intersectingGuild.allowedRoleIDs.length === 0) {\n\t\t\t\t\t\t\t// If the user matches any guilds that only have member and not role requirements we do not need to make requests to the discord API\n\t\t\t\t\t\t\tallowed = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Queue up all requests to the Discord API to improve speed\n\t\t\t\t\t\t\tguildRequests.push(makeDiscordAPIRequest(intersectingGuild, profile.id));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!allowed) {\n\t\t\t\t\t\tconst guildsData = await Promise.all(guildRequests);\n\t\t\t\t\t\tfor (const [guildWithRoles, err, memberResponse] of guildsData) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tlog.warn(\n\t\t\t\t\t\t\t\t\t`Got error while trying to get guild ${guildWithRoles.guildID} ` +\n\t\t\t\t\t\t\t\t\t\t`(Make sure you're using the correct bot token and guild id): ${JSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\tmemberResponse,\n\t\t\t\t\t\t\t\t\t\t)}`,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst intersectingRoles = guildWithRoles.allowedRoleIDs.filter((allowedRole) =>\n\t\t\t\t\t\t\t\tmemberResponse.roles.includes(allowedRole),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (intersectingRoles.length > 0) {\n\t\t\t\t\t\t\t\tallowed = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tallowed = false;\n\t\t\t\t}\n\n\t\t\t\tconst roles: Role[] = [];\n\t\t\t\tif (allowed) {\n\t\t\t\t\tlog.info(\n\t\t\t\t\t\t'(Discord) Granting %s#%s (%s) access',\n\t\t\t\t\t\tprofile.username,\n\t\t\t\t\t\tprofile.discriminator,\n\t\t\t\t\t\tprofile.id,\n\t\t\t\t\t);\n\t\t\t\t\troles.push(await getSuperUserRole());\n\t\t\t\t} else {\n\t\t\t\t\tlog.info(\n\t\t\t\t\t\t'(Discord) Denying %s#%s (%s) access',\n\t\t\t\t\t\tprofile.username,\n\t\t\t\t\t\tprofile.discriminator,\n\t\t\t\t\t\tprofile.id,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst user = await upsertUser({\n\t\t\t\t\tname: `${profile.username}#${profile.discriminator}`,\n\t\t\t\t\tprovider_type: 'discord',\n\t\t\t\t\tprovider_hash: profile.id,\n\t\t\t\t\tprovider_access_token: accessToken,\n\t\t\t\t\tprovider_refresh_token: refreshToken,\n\t\t\t\t\troles,\n\t\t\t\t});\n\t\t\t\tdone(undefined, user);\n\t\t\t},\n\t\t),\n\t);\n}\n\nif (config.login.local?.enabled) {\n\tconst {\n\t\tsessionSecret,\n\t\tlocal: { allowedUsers },\n\t} = config.login;\n\tconst hashes = crypto.getHashes();\n\n\tpassport.use(\n\t\tnew LocalStrategy(\n\t\t\t{\n\t\t\t\tusernameField: 'username',\n\t\t\t\tpasswordField: 'password',\n\t\t\t\tsession: false,\n\t\t\t},\n\t\t\tasync (username: string, password: string, done: StrategyDoneCb) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst roles: Role[] = [];\n\t\t\t\t\tconst foundUser = allowedUsers?.find(\n\t\t\t\t\t\t(u: { username: string; password: string }) => u.username === username,\n\t\t\t\t\t);\n\t\t\t\t\tlet allowed = false;\n\n\t\t\t\t\tif (foundUser) {\n\t\t\t\t\t\tconst match = /^([^:]+):(.+)$/.exec(foundUser.password ?? '');\n\t\t\t\t\t\tlet expected = foundUser.password;\n\t\t\t\t\t\tlet actual = password;\n\n\t\t\t\t\t\tif (match && hashes.includes(match[1])) {\n\t\t\t\t\t\t\texpected = match[2];\n\t\t\t\t\t\t\tactual = crypto.createHmac(match[1], sessionSecret).update(actual, 'utf8').digest('hex');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (expected === actual) {\n\t\t\t\t\t\t\tallowed = true;\n\t\t\t\t\t\t\troles.push(await getSuperUserRole());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlog.info('(Local) %s \"%s\" access', allowed ? 'Granting' : 'Denying', username);\n\n\t\t\t\t\tconst user = await upsertUser({\n\t\t\t\t\t\tname: username,\n\t\t\t\t\t\tprovider_type: 'local',\n\t\t\t\t\t\tprovider_hash: username,\n\t\t\t\t\t\troles,\n\t\t\t\t\t});\n\t\t\t\t\tdone(undefined, user);\n\t\t\t\t\treturn;\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t\t\t\t} catch (error: any) {\n\t\t\t\t\tdone(error);\n\t\t\t\t}\n\t\t\t},\n\t\t),\n\t);\n}\n\nexport async function createMiddleware(callbacks: {\n\tonLogin(user: Express.User): void;\n\tonLogout(user: Express.User): void;\n}): Promise<{ app: express.Application; sessionMiddleware: express.RequestHandler }> {\n\tconst database = await getConnection();\n\tconst sessionRepository = database.getRepository(Session);\n\tconst app = express();\n\tconst redirectPostLogin = (req: express.Request, res: express.Response): void => {\n\t\tconst url = req.session?.returnTo ?? '/dashboard';\n\t\tdelete req.session.returnTo;\n\t\tres.redirect(url);\n\t\tapp.emit('login', req.user);\n\t\tif (req.user) callbacks.onLogin(req.user);\n\t};\n\n\tif (!config.login.sessionSecret) {\n\t\tthrow new Error(\"no session secret defined, can't salt sessions, not safe, aborting\");\n\t}\n\n\tapp.use(cookieParser(config.login.sessionSecret));\n\n\tconst sessionMiddleware = expressSession({\n\t\tresave: false,\n\t\tsaveUninitialized: false,\n\t\tstore: new TypeormStore({\n\t\t\tcleanupLimit: 2,\n\t\t\tttl: Infinity,\n\t\t}).connect(sessionRepository),\n\t\tsecret: config.login.sessionSecret,\n\t\tcookie: {\n\t\t\tpath: '/',\n\t\t\thttpOnly: true,\n\t\t\tsecure: config.ssl?.enabled,\n\t\t},\n\t});\n\n\tapp.use(sessionMiddleware);\n\n\tapp.use(passport.initialize());\n\tapp.use(passport.session());\n\n\tconst VIEWS_DIR = path.join(rootPath.path, 'build/server/templates');\n\n\tapp.use('/login', express.static(path.join(rootPath.path, 'build/client/login')));\n\tapp.set('views', VIEWS_DIR);\n\n\tapp.get('/login', (req, res) => {\n\t\t// If the user is already logged in, don't show them the login page again.\n\t\tif (req.user && isSuperUser(req.user)) {\n\t\t\tres.redirect('/dashboard');\n\t\t} else {\n\t\t\tres.render(path.join(VIEWS_DIR, 'login.tmpl'), {\n\t\t\t\tuser: req.user,\n\t\t\t\tconfig,\n\t\t\t});\n\t\t}\n\t});\n\n\tapp.get('/authError', (req, res) => {\n\t\tres.render(path.join(VIEWS_DIR, 'authError.tmpl'), {\n\t\t\tmessage: req.query.message,\n\t\t\tcode: req.query.code,\n\t\t\tviewUrl: req.query.viewUrl,\n\t\t});\n\t});\n\n\tapp.get('/login/steam', passport.authenticate('steam'));\n\n\tapp.get('/login/auth/steam', passport.authenticate('steam', { failureRedirect: '/login' }), redirectPostLogin);\n\n\tapp.get('/login/twitch', passport.authenticate('twitch'));\n\n\tapp.get('/login/auth/twitch', passport.authenticate('twitch', { failureRedirect: '/login' }), redirectPostLogin);\n\n\tapp.get('/login/discord', passport.authenticate('discord'));\n\n\tapp.get('/login/auth/discord', passport.authenticate('discord', { failureRedirect: '/login' }), redirectPostLogin);\n\n\tapp.get('/login/local', passport.authenticate('local'));\n\n\tapp.post('/login/local', passport.authenticate('local', { failureRedirect: '/login' }), redirectPostLogin);\n\n\tapp.get('/logout', (req, res) => {\n\t\tapp.emit('logout', req.user);\n\t\treq.session?.destroy(() => {\n\t\t\tres.clearCookie('connect.sid', { path: '/' });\n\t\t\tres.clearCookie('io', { path: '/' });\n\t\t\tres.clearCookie('socketToken', {\n\t\t\t\tsecure: req.secure,\n\t\t\t\tsameSite: req.secure ? 'none' : undefined,\n\t\t\t});\n\t\t\tres.redirect('/login');\n\t\t});\n\t\tif (req.user) callbacks.onLogout(req.user);\n\t});\n\n\treturn { app, sessionMiddleware };\n}\n","// Packages\nimport type { ExtendedError } from 'socket.io/dist/namespace';\n\n// Ours\nimport { getConnection, ApiKey } from '../database';\nimport { isSuperUser, findUser } from '../database/utils';\nimport { config } from '../config';\nimport UnauthorizedError from '../login/UnauthorizedError';\nimport type { TypedServerSocket } from '../../types/socket-protocol';\nimport { UnAuthErrCode } from '../../types/socket-protocol';\nimport createLogger from '../logger';\nimport { serializeError } from 'serialize-error';\n\nconst log = createLogger('socket-auth');\nconst socketsByKey = new Map<string, Set<TypedServerSocket>>();\n\nexport default async function (socket: TypedServerSocket, next: (err?: ExtendedError) => void): Promise<void> {\n\ttry {\n\t\tconst { token } = socket.handshake.query;\n\t\tif (!token) {\n\t\t\tnext(new UnauthorizedError(UnAuthErrCode.InvalidToken, 'no token provided'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (Array.isArray(token)) {\n\t\t\tnext(new UnauthorizedError(UnAuthErrCode.InvalidToken, 'more than one token provided'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst database = await getConnection();\n\t\tconst apiKey = await database.getRepository(ApiKey).findOne({\n\t\t\twhere: { secret_key: token },\n\t\t\trelations: ['user'],\n\t\t});\n\n\t\tif (!apiKey) {\n\t\t\tnext(new UnauthorizedError(UnAuthErrCode.CredentialsRequired, 'no credentials found'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = await findUser(apiKey.user.id);\n\t\tif (!user) {\n\t\t\tnext(\n\t\t\t\tnew UnauthorizedError(\n\t\t\t\t\tUnAuthErrCode.CredentialsRequired,\n\t\t\t\t\t'no user associated with provided credentials',\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// But only authed sockets can join the Authed room.\n\t\tconst provider = user.identities[0]?.provider_type;\n\t\tconst providerAllowed = config.login?.[provider]?.enabled;\n\t\tconst allowed = isSuperUser(user) && providerAllowed;\n\n\t\tif (allowed) {\n\t\t\tif (!socketsByKey.has(token)) {\n\t\t\t\tsocketsByKey.set(token, new Set<TypedServerSocket>());\n\t\t\t}\n\n\t\t\tconst socketSet = socketsByKey.get(token);\n\t\t\t/* istanbul ignore next: should be impossible */\n\t\t\tif (!socketSet) {\n\t\t\t\tthrow new Error('socketSet was somehow falsey');\n\t\t\t}\n\n\t\t\tsocketSet.add(socket);\n\n\t\t\tsocket.on('regenerateToken', async (cb) => {\n\t\t\t\ttry {\n\t\t\t\t\t// Lookup the ApiKey for this token we want to revoke.\n\t\t\t\t\tconst keyToDelete = await database\n\t\t\t\t\t\t.getRepository(ApiKey)\n\t\t\t\t\t\t.findOne({ where: { secret_key: token }, relations: ['user'] });\n\n\t\t\t\t\t// If there's a User associated to this key (there should be)\n\t\t\t\t\t// give them a new ApiKey\n\t\t\t\t\tif (keyToDelete) {\n\t\t\t\t\t\t// Make the new api key\n\t\t\t\t\t\tconst newApiKey = database.manager.create(ApiKey);\n\t\t\t\t\t\tawait database.manager.save(newApiKey);\n\n\t\t\t\t\t\t// Remove the old key from the user, replace it with the new\n\t\t\t\t\t\tconst user = await findUser(keyToDelete.user.id);\n\t\t\t\t\t\tif (!user) {\n\t\t\t\t\t\t\tthrow new Error('should have been a user here');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tuser.apiKeys = user.apiKeys.filter((ak) => ak.secret_key !== token);\n\t\t\t\t\t\tuser.apiKeys.push(newApiKey);\n\t\t\t\t\t\tawait database.manager.save(user);\n\n\t\t\t\t\t\t// Delete the old key entirely\n\t\t\t\t\t\tawait database.manager.delete(ApiKey, { secret_key: token });\n\n\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\tcb(undefined, undefined);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Something is weird if we're here, just close the socket.\n\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\tcb(undefined, undefined);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsocket.disconnect(true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Close all sockets that are using the invalidated key,\n\t\t\t\t\t// EXCEPT the one that requested the revocation.\n\t\t\t\t\t// If we close the one that requested the revocation,\n\t\t\t\t\t// there will be a race condition where it might get redirected\n\t\t\t\t\t// to an error page before it receives the new key.\n\t\t\t\t\tfor (const s of socketSet) {\n\t\t\t\t\t\tif (s === socket) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ts.emit(\n\t\t\t\t\t\t\t'protocol_error',\n\t\t\t\t\t\t\tnew UnauthorizedError(UnAuthErrCode.TokenRevoked, 'This token has been invalidated')\n\t\t\t\t\t\t\t\t.serialized,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// We need to wait a bit before disconnecting the socket,\n\t\t\t\t\t\t// because we need to give them time to receive the \"error\"\n\t\t\t\t\t\t// message we just sent.\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\ts.disconnect(true);\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\n\t\t\t\t\tsocketsByKey.delete(token);\n\t\t\t\t} catch (error: unknown) {\n\t\t\t\t\tlog.error(serializeError(error));\n\t\t\t\t\tif (cb) {\n\t\t\t\t\t\tcb(error as string, undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Don't leak memory by retaining references to all sockets indefinitely\n\t\t\tsocket.on('disconnect', () => {\n\t\t\t\tsocketSet.delete(socket);\n\t\t\t});\n\t\t}\n\n\t\tif (allowed) {\n\t\t\tnext(undefined);\n\t\t} else {\n\t\t\tnext(new UnauthorizedError(UnAuthErrCode.InvalidToken, 'user is not allowed'));\n\t\t}\n\t} catch (error: unknown) {\n\t\tnext(error as any);\n\t}\n}\n","// Native\nimport path from 'path';\n\n// Packages\nimport express from 'express';\nimport { authCheck, sendFile } from './util';\nimport type { NodeCG } from '../types/nodecg';\n\nexport default class MountsLib {\n\tapp = express();\n\n\tconstructor(bundles: NodeCG.Bundle[]) {\n\t\tbundles.forEach((bundle) => {\n\t\t\tbundle.mount.forEach((mount) => {\n\t\t\t\tthis.app.get(`/bundles/${bundle.name}/${mount.endpoint}/*`, authCheck, (req, res, next) => {\n\t\t\t\t\tconst resName = req.params[0];\n\t\t\t\t\tconst parentDir = path.join(bundle.dir, mount.directory);\n\t\t\t\t\tconst fileLocation = path.join(parentDir, resName);\n\t\t\t\t\tsendFile(parentDir, fileLocation, res, next);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n}\n","// Packages\nimport clone from 'clone';\n\n// Ours\nimport createLogger from '../logger';\nimport Replicant from './server-replicant';\nimport { throttleName } from '../util';\nimport type ServerReplicant from './server-replicant';\nimport * as uuid from 'uuid';\nimport * as db from '../database';\nimport type { TypedServerSocket, ServerToClientEvents, RootNS } from '../../types/socket-protocol';\nimport type { NodeCG } from '../../types/nodecg';\nimport { stringifyError } from '../../shared/utils';\nimport type { EntityManager } from 'typeorm';\n\nconst log = createLogger('replicator');\n\nexport default class Replicator {\n\treadonly declaredReplicants = new Map<string, Map<string, Replicant<any>>>();\n\n\tprivate readonly _uuid = uuid.v4();\n\n\tprivate readonly _repEntities: db.Replicant[];\n\n\tprivate readonly _pendingSave = new WeakMap<Replicant<any>, Promise<any>>();\n\n\tconstructor(public readonly io: RootNS, repEntities: db.Replicant[]) {\n\t\tthis.io = io;\n\t\tio.on('connection', (socket) => {\n\t\t\tthis._attachToSocket(socket);\n\t\t});\n\n\t\tthis._repEntities = repEntities;\n\t}\n\n\t/**\n\t * Declares a Replicant.\n\t * @param {string} name - The name of the Replicant to declare.\n\t * @param {string} namespace - The namespace to which this Replicant belongs.\n\t * @param {object} [opts] - The options for this replicant.\n\t * @param {*} [opts.defaultValue] - The default value to instantiate this Replicant with. The default value is only\n\t * applied if this Replicant has not previously been declared and if it has no persisted value.\n\t * @param {boolean} [opts.persistent=true] - Whether to persist the Replicant's value to disk on every change.\n\t * Persisted values are re-loaded on startup.\n\t * @param {string} [opts.schemaPath] - The filepath at which to look for a JSON Schema for this Replicant.\n\t * Defaults to `nodecg/bundles/${bundleName}/schemas/${replicantName}.json`.\n\t * @returns {object}\n\t */\n\tdeclare<V, O extends NodeCG.Replicant.OptionsWithDefault<V> = NodeCG.Replicant.OptionsWithDefault<V>>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts?: O,\n\t): Replicant<V, O>;\n\tdeclare<V, O extends NodeCG.Replicant.OptionsNoDefault = NodeCG.Replicant.OptionsNoDefault>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts?: O,\n\t): Replicant<V, O>;\n\tdeclare<V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts?: O,\n\t): Replicant<V, O> {\n\t\t// If replicant already exists, return that.\n\t\tconst nsp = this.declaredReplicants.get(namespace);\n\t\tif (nsp) {\n\t\t\tconst existing = nsp.get(name);\n\t\t\tif (existing) {\n\t\t\t\texisting.log.replicants('Existing replicant found, returning that instead of creating a new one.');\n\t\t\t\treturn existing as any;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.declaredReplicants.set(namespace, new Map());\n\t\t}\n\n\t\t// Look up the persisted value, if any.\n\t\tlet parsedPersistedValue;\n\t\tconst repEnt = this._repEntities.find((re) => re.namespace === namespace && re.name === name);\n\t\tif (repEnt) {\n\t\t\ttry {\n\t\t\t\tparsedPersistedValue = repEnt.value === '' ? undefined : JSON.parse(repEnt.value);\n\t\t\t} catch (_: unknown) {\n\t\t\t\tparsedPersistedValue = repEnt.value;\n\t\t\t}\n\t\t}\n\n\t\t// Make the replicant and add it to the declaredReplicants map\n\t\tconst rep = new Replicant(name, namespace, opts, parsedPersistedValue);\n\t\tthis.declaredReplicants.get(namespace)!.set(name, rep);\n\n\t\t// Add persistence hooks\n\t\trep.on('change', () => {\n\t\t\tthis.saveReplicant(rep);\n\t\t});\n\n\t\t// Listen for server-side operations\n\t\trep.on('operations', (data) => {\n\t\t\tthis.emitToClients(rep, 'replicant:operations', data);\n\t\t});\n\n\t\treturn rep;\n\t}\n\n\t/**\n\t * Applies an array of operations to a replicant.\n\t * @param replicant {object} - The Replicant to perform these operation on.\n\t * @param operations {array} - An array of operations.\n\t */\n\tapplyOperations<V>(\n\t\treplicant: Replicant<V, NodeCG.Replicant.Options<V>>,\n\t\toperations: Array<NodeCG.Replicant.Operation<V>>,\n\t): void {\n\t\tconst oldValue = clone(replicant.value);\n\t\toperations.forEach((operation) => replicant._applyOperation(operation));\n\t\treplicant.revision++;\n\t\treplicant.emit('change', replicant.value, oldValue, operations);\n\t\tthis.emitToClients(replicant, 'replicant:operations', {\n\t\t\tname: replicant.name,\n\t\t\tnamespace: replicant.namespace,\n\t\t\trevision: replicant.revision,\n\t\t\toperations,\n\t\t});\n\t}\n\n\t/**\n\t * Emits an event to all remote Socket.IO listeners.\n\t * @param namespace - The namespace in which to emit this event. Only applies to Socket.IO listeners.\n\t * @param eventName - The name of the event to emit.\n\t * @param data - The data to emit with the event.\n\t */\n\temitToClients<T extends keyof ServerToClientEvents>(\n\t\treplicant: ServerReplicant<any>,\n\t\teventName: T,\n\t\tdata: Parameters<ServerToClientEvents[T]>[0],\n\t): void {\n\t\t// Emit to clients (in the given namespace's room) using Socket.IO\n\t\tconst namespace = `replicant:${replicant.namespace}:${replicant.name}`;\n\t\tlog.replicants('emitting %s to %s:', eventName, namespace, JSON.stringify(data, undefined, 2));\n\t\t(this.io as any).to(namespace).emit(eventName, data); // TODO: figure out how to type this properly\n\t}\n\n\tsaveAllReplicants(): void {\n\t\tfor (const replicants of this.declaredReplicants.values()) {\n\t\t\tfor (const replicant of replicants.values()) {\n\t\t\t\tthis.saveReplicant(replicant);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync saveAllReplicantsNow(): Promise<void> {\n\t\tconst promises: Array<Promise<void>> = [];\n\t\tfor (const replicants of this.declaredReplicants.values()) {\n\t\t\tfor (const replicant of replicants.values()) {\n\t\t\t\tpromises.push(this._saveReplicant(replicant));\n\t\t\t}\n\t\t}\n\n\t\tawait Promise.all(promises);\n\t}\n\n\tsaveReplicant(replicant: ServerReplicant<any>): void {\n\t\tif (!replicant.opts.persistent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthrottleName(\n\t\t\t`${this._uuid}:${replicant.namespace}:${replicant.name}`,\n\t\t\t() => {\n\t\t\t\tthis._saveReplicant(replicant).catch((error) => {\n\t\t\t\t\tlog.error('Error saving replicant:', error);\n\t\t\t\t});\n\t\t\t},\n\t\t\treplicant.opts.persistenceInterval,\n\t\t);\n\t}\n\n\tprivate async _saveReplicant(replicant: ServerReplicant<any>): Promise<void> {\n\t\tif (!replicant.opts.persistent) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet databaseSaveInProgress = false;\n\t\tlet valueChangedDuringSave = false;\n\n\t\t// Return the promise so that it can still be awaited\n\t\tif (this._pendingSave.has(replicant)) {\n\t\t\treturn this._pendingSave.get(replicant);\n\t\t}\n\n\t\ttry {\n\t\t\tconst promise = new Promise<EntityManager>((resolve, reject) => {\n\t\t\t\tdb.getConnection()\n\t\t\t\t\t.then((db) => {\n\t\t\t\t\t\tresolve(db.manager);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/promise-function-async\n\t\t\t}).then((manager) => {\n\t\t\t\tlet repEnt: db.Replicant;\n\t\t\t\tconst exitingEnt = this._repEntities.find(\n\t\t\t\t\t(pv) => pv.namespace === replicant.namespace && pv.name === replicant.name,\n\t\t\t\t);\n\t\t\t\tif (exitingEnt) {\n\t\t\t\t\trepEnt = exitingEnt;\n\t\t\t\t} else {\n\t\t\t\t\trepEnt = manager.create(db.Replicant, {\n\t\t\t\t\t\tnamespace: replicant.namespace,\n\t\t\t\t\t\tname: replicant.name,\n\t\t\t\t\t});\n\t\t\t\t\tthis._repEntities.push(repEnt);\n\t\t\t\t}\n\n\t\t\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\t\t\tconst valueRef = replicant.value;\n\t\t\t\t\tlet serializedValue = JSON.stringify(valueRef);\n\t\t\t\t\tif (typeof serializedValue === 'undefined') {\n\t\t\t\t\t\tserializedValue = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tconst changeHandler = (newVal: unknown) => {\n\t\t\t\t\t\tif (newVal !== valueRef && !isNaN(valueRef)) {\n\t\t\t\t\t\t\tvalueChangedDuringSave = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\trepEnt.value = serializedValue;\n\t\t\t\t\tdatabaseSaveInProgress = true;\n\t\t\t\t\treplicant.on('change', changeHandler);\n\t\t\t\t\tmanager\n\t\t\t\t\t\t.save(repEnt)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/promise-function-async\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t\tnew Promise<void>((resolve, reject) => {\n\t\t\t\t\t\t\t\t\tif (!valueChangedDuringSave) {\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// If we are here, then that means the value changed again during\n\t\t\t\t\t\t\t\t\t// the save operation, and so we have to do some recursion\n\t\t\t\t\t\t\t\t\t// to save it again.\n\t\t\t\t\t\t\t\t\tthis._pendingSave.delete(replicant);\n\t\t\t\t\t\t\t\t\tthis._saveReplicant(replicant).then(resolve).catch(reject);\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(reject)\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tdatabaseSaveInProgress = false;\n\t\t\t\t\t\t\treplicant.off('change', changeHandler);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._pendingSave.set(replicant, promise);\n\t\t\tawait promise;\n\t\t} catch (error: unknown) {\n\t\t\treplicant.log.error('Failed to persist value:', stringifyError(error));\n\t\t} finally {\n\t\t\tthis._pendingSave.delete(replicant);\n\t\t}\n\t}\n\n\tprivate _attachToSocket(socket: TypedServerSocket): void {\n\t\tsocket.on('replicant:declare', (data, cb) => {\n\t\t\tlog.replicants('received replicant:declare', JSON.stringify(data, undefined, 2));\n\t\t\ttry {\n\t\t\t\tconst replicant = this.declare(data.name, data.namespace, data.opts);\n\t\t\t\tcb(undefined, {\n\t\t\t\t\tvalue: replicant.value,\n\t\t\t\t\trevision: replicant.revision,\n\t\t\t\t\tschema: replicant.schema,\n\t\t\t\t\tschemaSum: replicant.schemaSum,\n\t\t\t\t});\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t\t\t} catch (e: any) {\n\t\t\t\tif (e.message.startsWith('Invalid value rejected for replicant')) {\n\t\t\t\t\tcb(e.message, undefined);\n\t\t\t\t} else {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-throw-literal\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsocket.on('replicant:proposeOperations', (data, cb) => {\n\t\t\tlog.replicants('received replicant:proposeOperations', JSON.stringify(data, undefined, 2));\n\t\t\tconst serverReplicant = this.declare(data.name, data.namespace, data.opts);\n\t\t\tif (serverReplicant.schema && (!('schemaSum' in data) || data.schemaSum !== serverReplicant.schemaSum)) {\n\t\t\t\tlog.replicants(\n\t\t\t\t\t'Change request %s:%s had mismatched schema sum (ours %s, theirs %s), invoking callback with new schema and fullupdate',\n\t\t\t\t\tdata.namespace,\n\t\t\t\t\tdata.name,\n\t\t\t\t\tserverReplicant.schemaSum,\n\t\t\t\t\t'schemaSum' in data ? data.schemaSum : '(no schema)',\n\t\t\t\t);\n\t\t\t\tcb('Mismatched schema version, assignment rejected', {\n\t\t\t\t\tschema: serverReplicant.schema,\n\t\t\t\t\tschemaSum: serverReplicant.schemaSum,\n\t\t\t\t\tvalue: serverReplicant.value,\n\t\t\t\t\trevision: serverReplicant.revision,\n\t\t\t\t});\n\t\t\t} else if (serverReplicant.revision !== data.revision) {\n\t\t\t\tlog.replicants(\n\t\t\t\t\t'Change request %s:%s had mismatched revision (ours %s, theirs %s), invoking callback with fullupdate',\n\t\t\t\t\tdata.namespace,\n\t\t\t\t\tdata.name,\n\t\t\t\t\tserverReplicant.revision,\n\t\t\t\t\tdata.revision,\n\t\t\t\t);\n\t\t\t\tcb('Mismatched revision number, assignment rejected', {\n\t\t\t\t\tvalue: serverReplicant.value,\n\t\t\t\t\trevision: serverReplicant.revision,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.applyOperations(serverReplicant, data.operations);\n\t\t});\n\n\t\tsocket.on('replicant:read', (data, cb) => {\n\t\t\tlog.replicants('replicant:read', JSON.stringify(data, undefined, 2));\n\t\t\tconst replicant = this.declare(data.name, data.namespace);\n\t\t\tif (typeof cb === 'function') {\n\t\t\t\tif (replicant) {\n\t\t\t\t\tcb(undefined, replicant.value);\n\t\t\t\t} else {\n\t\t\t\t\tcb(undefined, undefined);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","/* eslint-disable @typescript-eslint/prefer-for-of */\n\n// Packages\nimport clone from 'clone';\nimport { JsonPointer } from 'json-ptr';\n\n// Crimes\nimport jsonSchemaLibTypeOf = require('json-schema-lib/lib/util/typeOf');\nimport jsonSchemaStripHash = require('json-schema-lib/lib/util/stripHash');\n\ntype File = {\n\turl: string;\n\tdata: UnknownObject;\n\tschema: {\n\t\tplugins: {\n\t\t\tresolveURL(paths: { from: string; to: string }): string;\n\t\t};\n\t};\n};\n\ntype UnknownObject = { [k: string]: unknown; [k: number]: unknown };\ntype FileReference = { $ref: string } & UnknownObject;\ntype PointerReference = { $ref: string } & UnknownObject;\n\n/**\n * Mutates an object in place, replacing all its JSON Refs with their dereferenced values.\n */\nexport default function replaceRefs(inputObj: unknown, currentFile: File, allFiles: File[]): UnknownObject | undefined {\n\tconst type = jsonSchemaLibTypeOf(inputObj);\n\tif (!type.isPOJO && !type.isArray) {\n\t\treturn;\n\t}\n\n\tconst obj = inputObj as UnknownObject;\n\tif (type.isPOJO) {\n\t\tlet dereferencedData: UnknownObject | undefined;\n\t\tlet referenceFile: File | undefined;\n\t\tif (isFileReference(obj)) {\n\t\t\tconst referenceUrl = resolveFileReference(obj.$ref, currentFile);\n\t\t\treferenceFile = allFiles.find((file) => file.url === referenceUrl);\n\n\t\t\t/* istanbul ignore next: in theory this isn't possible */\n\t\t\tif (!referenceFile) {\n\t\t\t\tthrow new Error(\"Should have been a schema here but wasn't\");\n\t\t\t}\n\n\t\t\tdereferencedData = referenceFile.data;\n\n\t\t\t// If this file reference also has a local reference appended to it,\n\t\t\t// we need to resolve that local reference within the file we just dereferenced.\n\t\t\t// Example: schemaRefTargetWithDef.json#/definitions/exampleDef\n\t\t\tconst hashIndex = obj.$ref.indexOf('#');\n\t\t\tif (hashIndex >= 0) {\n\t\t\t\tconst hashPath = obj.$ref.slice(hashIndex);\n\t\t\t\tdereferencedData = resolvePointerReference(dereferencedData, hashPath);\n\t\t\t}\n\t\t} else if (isPointerReference(obj)) {\n\t\t\treferenceFile = currentFile;\n\t\t\tdereferencedData = resolvePointerReference(currentFile.data, obj.$ref);\n\t\t}\n\n\t\tif (dereferencedData && referenceFile) {\n\t\t\tdelete obj.$ref;\n\t\t\tfor (const key in dereferencedData) {\n\t\t\t\tif (key === '$schema') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tobj[key] = clone(dereferencedData[key]);\n\t\t\t}\n\n\t\t\t// Crawl this POJO or Array, looking for nested JSON References\n\t\t\tconst keys = Object.keys(dereferencedData);\n\t\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\t\tconst key = keys[i];\n\t\t\t\tconst value = obj[key];\n\t\t\t\treplaceRefs(value, referenceFile, allFiles);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Crawl this POJO or Array, looking for nested JSON References\n\tconst keys = Object.keys(obj);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst key = keys[i];\n\t\tconst value = obj[key];\n\t\treplaceRefs(value, currentFile, allFiles);\n\t}\n\n\treturn obj;\n}\n\n/**\n * Determines whether the given value is a JSON Reference that points to a file\n * (as opposed to an internal reference, which points to a location within its own file).\n *\n * @param {*} value - The value to inspect\n * @returns {boolean}\n */\nfunction isFileReference(value: UnknownObject): value is FileReference {\n\treturn typeof value.$ref === 'string' && !value.$ref.startsWith('#');\n}\n\n/**\n * Determines whether the given value is a JSON Pointer to another value in the same file.\n *\n * @param {*} value - The value to inspect\n * @returns {boolean}\n */\nfunction isPointerReference(value: UnknownObject): value is PointerReference {\n\treturn typeof value.$ref === 'string' && value.$ref.startsWith('#');\n}\n\n/**\n * Resolves the given JSON Reference URL against the specified file, and adds a new {@link File}\n * object to the schema if necessary.\n *\n * @param {string} url - The JSON Reference URL (may be absolute or relative)\n * @param {File} file - The file that the JSON Reference is in\n */\nfunction resolveFileReference(url: string, file: File): string {\n\tconst { schema } = file;\n\n\t// Remove any hash from the URL, since this URL represents the WHOLE file, not a fragment of it\n\turl = jsonSchemaStripHash(url);\n\n\t// Resolve the new file's absolute URL\n\treturn schema.plugins.resolveURL({ from: file.url, to: url });\n}\n\nfunction resolvePointerReference(obj: Record<string, unknown>, ref: string): UnknownObject {\n\treturn JsonPointer.get(obj, ref) as UnknownObject;\n}\n","// Native\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Packages\nimport $RefParser from 'json-schema-lib';\nimport clone from 'clone';\nimport sha1 from 'sha1';\n\n// Ours\nimport {\n\tproxyRecursive,\n\tignoreProxy,\n\tresumeProxy,\n\tAbstractReplicant,\n\ttype ReplicantValue,\n} from '../../shared/replicants.shared';\nimport replaceRefs from './schema-hacks';\nimport createLogger from '../logger';\nimport type { NodeCG } from '../../types/nodecg';\nimport { getSchemaDefault } from '../../shared/utils';\n\n/**\n * Never instantiate this directly.\n * Always use Replicator.declare instead.\n * The Replicator needs to have complete control over the ServerReplicant class.\n */\nexport default class ServerReplicant<\n\tV,\n\tO extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>,\n> extends AbstractReplicant<'server', V, O> {\n\tconstructor(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts: O = {} as Record<any, unknown>,\n\t\tstartingValue: V | undefined = undefined,\n\t) {\n\t\tsuper(name, namespace, opts);\n\n\t\t/**\n\t\t * Server Replicants are immediately considered declared.\n\t\t * Client Replicants aren't considered declared until they have\n\t\t * fetched the current value from the server, which is an\n\t\t * async operation that takes time.\n\t\t */\n\t\tthis.status = 'declared';\n\t\tthis.log = createLogger(`Replicant/${namespace}.${name}`);\n\n\t\t// If present, parse the schema and generate the validator function.\n\t\tif (opts.schemaPath) {\n\t\t\tconst absoluteSchemaPath = path.isAbsolute(opts.schemaPath)\n\t\t\t\t? opts.schemaPath\n\t\t\t\t: path.join(process.env.NODECG_ROOT, opts.schemaPath);\n\t\t\tif (fs.existsSync(absoluteSchemaPath)) {\n\t\t\t\ttry {\n\t\t\t\t\tconst rawSchema = $RefParser.readSync(absoluteSchemaPath);\n\t\t\t\t\tconst parsedSchema = replaceRefs(rawSchema.root, rawSchema.rootFile, rawSchema.files);\n\t\t\t\t\tif (!parsedSchema) {\n\t\t\t\t\t\tthrow new Error('parsed schema was unexpectedly undefined');\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schema = parsedSchema;\n\t\t\t\t\tthis.schemaSum = sha1(JSON.stringify(parsedSchema));\n\t\t\t\t\tthis.validate = this._generateValidator();\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-implicit-any-catch\n\t\t\t\t} catch (e: any) {\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (!process.env.NODECG_TEST) {\n\t\t\t\t\t\tthis.log.error('Schema could not be loaded, are you sure that it is valid JSON?\\n', e.stack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet defaultValue = 'defaultValue' in opts ? opts.defaultValue : undefined;\n\n\t\t// Set the default value, if a schema is present and no default value was provided.\n\t\tif (this.schema && defaultValue === undefined) {\n\t\t\tdefaultValue = getSchemaDefault(this.schema, `${this.namespace}:${this.name}`) as V;\n\t\t}\n\n\t\t// If `opts.persistent` is true and this replicant has a persisted value, try to load that persisted value.\n\t\t// Else, apply `defaultValue`.\n\t\tif (opts.persistent && typeof startingValue !== 'undefined' && startingValue !== null) {\n\t\t\tif (this.validate(startingValue, { throwOnInvalid: false })) {\n\t\t\t\tthis._value = proxyRecursive(this, startingValue, '/') as any;\n\t\t\t\tthis.log.replicants('Loaded a persisted value:', startingValue);\n\t\t\t} else if (this.schema) {\n\t\t\t\tthis._value = proxyRecursive(\n\t\t\t\t\tthis,\n\t\t\t\t\tgetSchemaDefault(this.schema, `${this.namespace}:${this.name}`),\n\t\t\t\t\t'/',\n\t\t\t\t) as any;\n\t\t\t\tthis.log.replicants(\n\t\t\t\t\t'Discarded persisted value, as it failed schema validation. Replaced with defaults from schema.',\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.schema && defaultValue !== undefined) {\n\t\t\t\tthis.validate(defaultValue);\n\t\t\t}\n\n\t\t\tif (defaultValue === undefined) {\n\t\t\t\tthis.log.replicants('Declared \"%s\" in namespace \"%s\"\\n', name, namespace);\n\t\t\t} else {\n\t\t\t\tthis._value = proxyRecursive(this, clone(defaultValue), '/') as any;\n\t\t\t\tthis.log.replicants(\n\t\t\t\t\t'Declared \"%s\" in namespace \"%s\" with defaultValue:\\n',\n\t\t\t\t\tname,\n\t\t\t\t\tnamespace,\n\t\t\t\t\tdefaultValue,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tget value(): ReplicantValue<'server', V, O> {\n\t\treturn this._value as any;\n\t}\n\n\tset value(newValue) {\n\t\tif (newValue === this._value) {\n\t\t\tthis.log.replicants('value unchanged, no action will be taken');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.validate(newValue);\n\t\tthis.log.replicants('running setter with', newValue);\n\t\tconst clonedNewVal = clone(newValue);\n\t\tthis._addOperation({\n\t\t\tpath: '/',\n\t\t\tmethod: 'overwrite',\n\t\t\targs: {\n\t\t\t\tnewValue: clonedNewVal,\n\t\t\t},\n\t\t});\n\t\tignoreProxy(this);\n\t\tthis._value = proxyRecursive(this, newValue, '/');\n\t\tresumeProxy(this);\n\t}\n\n\t/**\n\t * Refer to the abstract base class' implementation for details.\n\t * @private\n\t */\n\t_addOperation(operation: NodeCG.Replicant.Operation<ReplicantValue<'server', V, O>>): void {\n\t\tthis._operationQueue.push(operation);\n\t\tif (!this._pendingOperationFlush) {\n\t\t\tthis._oldValue = clone(this.value);\n\t\t\tthis._pendingOperationFlush = true;\n\t\t\tprocess.nextTick(() => {\n\t\t\t\tthis._flushOperations();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Refer to the abstract base class' implementation for details.\n\t * @private\n\t */\n\t_flushOperations(): void {\n\t\tthis._pendingOperationFlush = false;\n\t\tif (this._operationQueue.length <= 0) return;\n\t\tthis.revision++;\n\t\tthis.emit('operations', {\n\t\t\tname: this.name,\n\t\t\tnamespace: this.namespace,\n\t\t\toperations: this._operationQueue,\n\t\t\trevision: this.revision,\n\t\t});\n\t\tconst opQ = this._operationQueue;\n\t\tthis._operationQueue = [];\n\t\tthis.emit('change', this.value, this._oldValue, opQ);\n\t}\n}\n","// Native\nimport { EventEmitter } from 'events';\nimport path from 'path';\n\n// Packages\nimport semver from 'semver';\nimport * as Sentry from '@sentry/node';\n\n// Ours\nimport extensionApiClassFactory from '../api.server';\nimport createLogger from '../logger';\nimport type { Replicator } from '../replicant';\nimport type { RootNS } from '../../types/socket-protocol';\nimport type BundleManager from '../bundle-manager';\nimport type { NodeCG } from '../../types/nodecg';\nimport { stringifyError } from '../../shared/utils';\n\nconst log = createLogger('extensions');\n\nexport type ExtensionEventMap = {\n\tlogin: (user: Express.Request['user']) => void;\n\tlogout: (user: Express.Request['user']) => void;\n\textensionsLoaded: () => void;\n\tserverStarted: () => void;\n\tserverStopping: () => void;\n};\n\nexport default class ExtensionManager extends EventEmitter {\n\treadonly extensions: Record<string, unknown> = {};\n\n\tprivate readonly _satisfiedDepNames = new WeakMap<NodeCG.Bundle, string[]>();\n\n\tprivate readonly _ExtensionApi: ReturnType<typeof extensionApiClassFactory>;\n\n\tprivate readonly _bundleManager: BundleManager;\n\n\tprivate readonly _apiInstances = new Set<InstanceType<ReturnType<typeof extensionApiClassFactory>>>();\n\n\tconstructor(io: RootNS, bundleManager: BundleManager, replicator: Replicator, mount: NodeCG.Middleware) {\n\t\tsuper();\n\n\t\tlog.trace('Starting extension mounting');\n\t\tthis._bundleManager = bundleManager;\n\t\tthis._ExtensionApi = extensionApiClassFactory(io, replicator, this.extensions, mount);\n\n\t\t// Prevent us from messing with other listeners of this event\n\t\tconst allBundles = bundleManager.all();\n\n\t\t// Track which bundles we know are fully loaded (extension and all)\n\t\tconst fullyLoaded = [];\n\n\t\twhile (allBundles.length > 0) {\n\t\t\tconst startLen = allBundles.length;\n\t\t\tfor (let i = 0; i < startLen; i++) {\n\t\t\t\t// If this bundle has no dependencies, load it and remove it from the list\n\t\t\t\tif (!allBundles[i].bundleDependencies) {\n\t\t\t\t\tlog.debug('Bundle %s has no dependencies', allBundles[i].name);\n\n\t\t\t\t\tif (allBundles[i].hasExtension) {\n\t\t\t\t\t\tthis._loadExtension(allBundles[i]);\n\t\t\t\t\t}\n\n\t\t\t\t\tfullyLoaded.push(allBundles[i]);\n\t\t\t\t\tallBundles.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// If this bundle has dependencies, and all of them are satisfied, load it and remove it from the list\n\t\t\t\tif (this._bundleDepsSatisfied(allBundles[i], fullyLoaded)) {\n\t\t\t\t\tlog.debug('Bundle %s has extension with satisfied dependencies', allBundles[i].name);\n\n\t\t\t\t\tif (allBundles[i].hasExtension) {\n\t\t\t\t\t\tthis._loadExtension(allBundles[i]);\n\t\t\t\t\t}\n\n\t\t\t\t\tfullyLoaded.push(allBundles[i]);\n\t\t\t\t\tallBundles.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst endLen = allBundles.length;\n\t\t\tif (startLen === endLen) {\n\t\t\t\t// Any bundles left over must have had unsatisfied dependencies.\n\t\t\t\t// Print a warning about each bundle, and what its unsatisfied deps were.\n\t\t\t\t// Then, unload the bundle.\n\t\t\t\tallBundles.forEach((bundle) => {\n\t\t\t\t\tconst unsatisfiedDeps = [];\n\n\t\t\t\t\tfor (const dep in bundle.bundleDependencies) {\n\t\t\t\t\t\t/* istanbul ignore if */\n\t\t\t\t\t\tif (!{}.hasOwnProperty.call(bundle.bundleDependencies, dep)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* istanbul ignore if */\n\t\t\t\t\t\tconst satisfied = this._satisfiedDepNames.get(bundle);\n\t\t\t\t\t\tif (satisfied?.includes(dep)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tunsatisfiedDeps.push(`${dep}@${bundle.bundleDependencies[dep]}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tlog.error(\n\t\t\t\t\t\t'Bundle \"%s\" can not be loaded, as it has unsatisfied dependencies:\\n',\n\t\t\t\t\t\tbundle.name,\n\t\t\t\t\t\tunsatisfiedDeps.join(', '),\n\t\t\t\t\t);\n\t\t\t\t\tbundleManager.remove(bundle.name);\n\t\t\t\t});\n\n\t\t\t\tlog.error('%d bundle(s) can not be loaded because they have unsatisfied dependencies', endLen);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlog.trace('Completed extension mounting');\n\t}\n\n\tpublic emitToAllInstances<K extends keyof ExtensionEventMap>(\n\t\teventName: K,\n\t\t...params: Parameters<ExtensionEventMap[K]>\n\t): void {\n\t\tfor (const instance of this._apiInstances) {\n\t\t\tinstance.emit(eventName, ...params);\n\t\t}\n\t}\n\n\tprivate _loadExtension(bundle: NodeCG.Bundle): void {\n\t\tconst ExtensionApi = this._ExtensionApi;\n\t\tconst extPath = path.join(bundle.dir, 'extension');\n\t\ttry {\n\t\t\tconst requireFunc = process.env.NODECG_TEST ? require : __non_webpack_require__;\n\t\t\tlet mod = requireFunc(extPath);\n\n\t\t\t// If the extension has been generated by Babel/TypeScript and exported with \"export default\".\n\t\t\tif (mod.__esModule) {\n\t\t\t\tmod = mod.default;\n\t\t\t}\n\n\t\t\tconst apiInstance = new ExtensionApi(bundle);\n\t\t\tthis._apiInstances.add(apiInstance);\n\t\t\tconst extension = mod(apiInstance);\n\t\t\tlog.info('Mounted %s extension', bundle.name);\n\t\t\tthis.extensions[bundle.name] = extension;\n\t\t} catch (err: unknown) {\n\t\t\tthis._bundleManager.remove(bundle.name);\n\t\t\tlog.warn('Failed to mount %s extension:\\n', bundle.name, stringifyError(err));\n\t\t\tif (global.sentryEnabled) {\n\t\t\t\t(err as Error).message = `Failed to mount ${bundle.name} extension: ${\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n\t\t\t\t\t((err as Error)?.message ?? err) as string\n\t\t\t\t}`;\n\t\t\t\tSentry.captureException(err);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _bundleDepsSatisfied(bundle: NodeCG.Bundle, loadedBundles: NodeCG.Bundle[]): boolean {\n\t\tconst deps = bundle.bundleDependencies;\n\t\tif (!deps) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst unsatisfiedDepNames = Object.keys(deps);\n\t\tconst arr = this._satisfiedDepNames.get(bundle)?.slice(0) ?? [];\n\n\t\tloadedBundles.forEach((loadedBundle) => {\n\t\t\t// Find out if this loaded bundle is one of the dependencies of the bundle in question.\n\t\t\t// If so, check if the version loaded satisfies the dependency.\n\t\t\tconst index = unsatisfiedDepNames.indexOf(loadedBundle.name);\n\t\t\tif (index > -1) {\n\t\t\t\tif (semver.satisfies(loadedBundle.version, deps[loadedBundle.name])) {\n\t\t\t\t\tarr.push(loadedBundle.name);\n\t\t\t\t\tunsatisfiedDepNames.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._satisfiedDepNames.set(bundle, arr);\n\t\treturn unsatisfiedDepNames.length === 0;\n\t}\n}\n","// Minimal imports for first setup\nimport '../../../scripts/warn-engines.js';\nimport * as os from 'os';\nimport * as Sentry from '@sentry/node';\nimport { config, filteredConfig } from '../config';\nimport '../util/sentry-config';\nimport { pjson } from '../util';\n\nglobal.exitOnUncaught = config.exitOnUncaught;\nif (config.sentry?.enabled) {\n\tSentry.init({\n\t\tdsn: config.sentry.dsn,\n\t\tserverName: os.hostname(),\n\t\trelease: pjson.version,\n\t});\n\tSentry.configureScope((scope) => {\n\t\tscope.setTags({\n\t\t\tnodecgHost: config.host,\n\t\t\tnodecgBaseURL: config.baseURL,\n\t\t});\n\t});\n\tglobal.sentryEnabled = true;\n\n\tprocess.on('unhandledRejection', (reason, p) => {\n\t\tconsole.error('Unhandled Rejection at:', p, 'reason:', reason);\n\t\tSentry.captureException(reason);\n\t});\n\n\tconsole.info('[nodecg] Sentry enabled.');\n}\n\n// Native\nimport fs = require('fs');\nimport path = require('path');\n\n// Packages\nimport bodyParser from 'body-parser';\nimport clone from 'clone';\nimport debounce from 'lodash.debounce';\nimport express from 'express';\nimport template from 'lodash.template';\nimport memoize from 'fast-memoize';\nimport transformMiddleware from 'express-transform-bare-module-specifiers';\nimport compression from 'compression';\nimport type { Server } from 'http';\nimport SocketIO from 'socket.io';\nimport passport from 'passport';\n\n// Ours\nimport BundleManager from '../bundle-manager';\nimport createLogger from '../logger';\nimport socketAuthMiddleware from '../login/socketAuthMiddleware';\nimport socketApiMiddleware from './socketApiMiddleware';\nimport Replicator from '../replicant/replicator';\nimport * as db from '../database';\nimport type { ClientToServerEvents, ServerToClientEvents, TypedSocketServer } from '../../types/socket-protocol';\nimport GraphicsLib from '../graphics';\nimport DashboardLib from '../dashboard';\nimport MountsLib from '../mounts';\nimport SoundsLib from '../sounds';\nimport AssetManager from '../assets';\nimport SharedSourcesLib from '../shared-sources';\nimport ExtensionManager from './extensions';\nimport SentryConfig from '../util/sentry-config';\nimport type { NodeCG } from '../../types/nodecg';\nimport { TypedEmitter } from '../../shared/typed-emitter';\nimport rootPath from '../../shared/utils/rootPath';\n\nconst renderTemplate = memoize((content, options) => template(content)(options));\n\ntype EventMap = {\n\terror: (error: unknown) => void;\n\textensionsLoaded: () => void;\n\tstarted: () => void;\n\tstopped: () => void;\n};\n\nexport default class NodeCGServer extends TypedEmitter<EventMap> {\n\treadonly log = createLogger('server');\n\n\tprivate readonly _io: TypedSocketServer;\n\n\tprivate readonly _app = express();\n\n\tprivate readonly _server: Server;\n\n\tprivate _replicator?: Replicator;\n\n\tprivate _extensionManager?: ExtensionManager;\n\n\t/**\n\t * Only used by tests. Gross hack.\n\t */\n\t// @ts-expect-error Used only by tests.\n\tprivate _bundleManager: BundleManager;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.mount = this.mount.bind(this);\n\n\t\t/**\n\t\t * HTTP(S) server setup\n\t\t */\n\t\tconst { _app: app } = this;\n\t\tlet server: Server;\n\t\tif (config.ssl?.enabled) {\n\t\t\tconst sslOpts: { key: Buffer; cert: Buffer; passphrase?: string } = {\n\t\t\t\tkey: fs.readFileSync(config.ssl.keyPath),\n\t\t\t\tcert: fs.readFileSync(config.ssl.certificatePath),\n\t\t\t};\n\t\t\tif (config.ssl.passphrase) {\n\t\t\t\tsslOpts.passphrase = config.ssl.passphrase;\n\t\t\t}\n\n\t\t\t// If we allow HTTP on the same port, use httpolyglot\n\t\t\t// otherwise, standard https server\n\t\t\tserver = config.ssl.allowHTTP\n\t\t\t\t? require('httpolyglot').createServer(sslOpts, app)\n\t\t\t\t: require('https').createServer(sslOpts, app);\n\t\t} else {\n\t\t\tserver = require('http').createServer(app);\n\t\t}\n\n\t\t/**\n\t\t * Socket.IO server setup.\n\t\t */\n\t\tthis._io = new SocketIO.Server<ClientToServerEvents, ServerToClientEvents>(server);\n\t\tthis._io.setMaxListeners(75); // Prevent console warnings when many extensions are installed\n\t\tthis._io.on('error', (err) => {\n\t\t\tif (global.sentryEnabled) {\n\t\t\t\tSentry.captureException(err);\n\t\t\t}\n\n\t\t\tthis.log.error(err.stack);\n\t\t});\n\n\t\tthis._server = server;\n\t}\n\n\tasync start(): Promise<void> {\n\t\tconst { _app: app, _server: server, log } = this;\n\t\tconst io = this._io.of('/');\n\t\tlog.info('Starting NodeCG %s (Running on Node.js %s)', pjson.version, process.version);\n\n\t\tconst database = await db.getConnection();\n\t\tif (global.sentryEnabled) {\n\t\t\tapp.use(Sentry.Handlers.requestHandler());\n\t\t}\n\n\t\t// Set up Express\n\t\tapp.use(compression());\n\t\tapp.use(bodyParser.json());\n\t\tapp.use(bodyParser.urlencoded({ extended: true }));\n\n\t\tapp.set('trust proxy', true);\n\n\t\tapp.engine('tmpl', (filePath: string, options: any, callback: any) => {\n\t\t\tfs.readFile(filePath, (error, content) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn callback(error);\n\t\t\t\t}\n\n\t\t\t\treturn callback(null, renderTemplate(content, options));\n\t\t\t});\n\t\t});\n\n\t\tif (config.login?.enabled) {\n\t\t\tlog.info('Login security enabled');\n\t\t\tconst login = await import('../login');\n\t\t\tconst { app: loginMiddleware, sessionMiddleware } = await login.createMiddleware({\n\t\t\t\tonLogin: (user) => {\n\t\t\t\t\tthis._extensionManager?.emitToAllInstances('login', user);\n\t\t\t\t},\n\t\t\t\tonLogout: (user) => {\n\t\t\t\t\tthis._extensionManager?.emitToAllInstances('logout', user);\n\t\t\t\t},\n\t\t\t});\n\t\t\tapp.use(loginMiddleware);\n\n\t\t\t// convert a connect middleware to a Socket.IO middleware\n\t\t\tconst wrap = (middleware: any) => (socket: SocketIO.Socket, next: any) =>\n\t\t\t\tmiddleware(socket.request, {}, next);\n\n\t\t\tio.use(wrap(sessionMiddleware));\n\t\t\tio.use(wrap(passport.initialize()));\n\t\t\tio.use(wrap(passport.session()));\n\n\t\t\tthis._io.use(socketAuthMiddleware);\n\t\t} else {\n\t\t\tapp.get('/login*', (_, res) => {\n\t\t\t\tres.redirect('/dashboard');\n\t\t\t});\n\t\t}\n\n\t\tthis._io.use(socketApiMiddleware);\n\n\t\tconst bundlesPaths = [path.join(process.env.NODECG_ROOT, 'bundles')].concat(config.bundles?.paths ?? []);\n\t\tconst cfgPath = path.join(process.env.NODECG_ROOT, 'cfg');\n\t\tconst bundleManager = new BundleManager(bundlesPaths, cfgPath, pjson.version, config);\n\n\t\t// Wait for Chokidar to finish its initial scan.\n\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\tlet handled = false;\n\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\tif (handled) return;\n\t\t\t\thandled = true;\n\t\t\t\treject(new Error('Timed out while waiting for the bundle manager to become ready.'));\n\t\t\t}, 15000);\n\n\t\t\tif (bundleManager.ready) {\n\t\t\t\tsucceed();\n\t\t\t} else {\n\t\t\t\tbundleManager.once('ready', () => {\n\t\t\t\t\tsucceed();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction succeed() {\n\t\t\t\tif (handled) return;\n\t\t\t\thandled = true;\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\n\t\tbundleManager.all().forEach((bundle) => {\n\t\t\t// TODO: remove this feature in v3\n\t\t\tif (bundle.transformBareModuleSpecifiers) {\n\t\t\t\tlog.warn(\n\t\t\t\t\t`${bundle.name} uses the deprecated \"transformBareModuleSpecifiers\" feature. ` +\n\t\t\t\t\t\t'This feature will be removed in NodeCG v3. ' +\n\t\t\t\t\t\t'Please migrate to using browser-native import maps instead: ' +\n\t\t\t\t\t\t'https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script/type/importmap',\n\t\t\t\t);\n\t\t\t\tconst opts = {\n\t\t\t\t\trootDir: process.env.NODECG_ROOT,\n\t\t\t\t\tmodulesUrl: `/bundles/${bundle.name}/node_modules`,\n\t\t\t\t};\n\t\t\t\tapp.use(`/bundles/${bundle.name}/*`, transformMiddleware(opts));\n\t\t\t}\n\t\t});\n\n\t\t// Only used by tests. Kinda gross. Sorry.\n\t\tthis._bundleManager = bundleManager;\n\n\t\tlog.trace(`Attempting to listen on ${config.host}:${config.port}`);\n\t\tserver.on('error', (err) => {\n\t\t\tswitch ((err as any).code) {\n\t\t\t\tcase 'EADDRINUSE':\n\t\t\t\t\tif (process.env.NODECG_TEST) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlog.error(\n\t\t\t\t\t\t`Listen ${config.host}:${config.port} in use, is NodeCG already running? NodeCG will now exit.`,\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlog.error('Unhandled error!', err);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.emit('error', err);\n\t\t});\n\n\t\tif (global.sentryEnabled) {\n\t\t\tconst sentryHelpers = new SentryConfig(bundleManager);\n\t\t\tapp.use(sentryHelpers.app);\n\t\t}\n\n\t\tconst persistedReplicantEntities = await database.getRepository(db.Replicant).find();\n\t\tconst replicator = new Replicator(io, persistedReplicantEntities);\n\t\tthis._replicator = replicator;\n\n\t\tconst graphics = new GraphicsLib(io, bundleManager, replicator);\n\t\tapp.use(graphics.app);\n\n\t\tconst dashboard = new DashboardLib(bundleManager);\n\t\tapp.use(dashboard.app);\n\n\t\tconst mounts = new MountsLib(bundleManager.all());\n\t\tapp.use(mounts.app);\n\n\t\tconst sounds = new SoundsLib(bundleManager.all(), replicator);\n\t\tapp.use(sounds.app);\n\n\t\tconst assets = new AssetManager(bundleManager.all(), replicator);\n\t\tapp.use(assets.app);\n\n\t\tconst sharedSources = new SharedSourcesLib(bundleManager.all());\n\t\tapp.use(sharedSources.app);\n\n\t\tif (global.sentryEnabled) {\n\t\t\tapp.use(Sentry.Handlers.errorHandler());\n\t\t}\n\n\t\t// Fallthrough error handler,\n\t\t// Taken from https://docs.sentry.io/platforms/node/express/\n\t\tapp.use((err: unknown, _req: express.Request, res: express.Response, _next: express.NextFunction) => {\n\t\t\tres.statusCode = 500;\n\t\t\tif (global.sentryEnabled) {\n\t\t\t\t// The error id is attached to `res.sentry` to be returned\n\t\t\t\t// and optionally displayed to the user for support.\n\t\t\t\tres.end(`Internal error\\nSentry issue ID: ${String((res as any).sentry)}\\n`);\n\t\t\t} else {\n\t\t\t\tres.end('Internal error');\n\t\t\t}\n\n\t\t\tthis.log.error(err);\n\t\t});\n\n\t\t// Set up \"bundles\" Replicant.\n\t\tconst bundlesReplicant = replicator.declare('bundles', 'nodecg', {\n\t\t\tschemaPath: path.resolve(rootPath.path, 'schemas/bundles.json'),\n\t\t\tpersistent: false,\n\t\t});\n\t\tconst updateBundlesReplicant = debounce(() => {\n\t\t\tbundlesReplicant.value = clone(bundleManager.all());\n\t\t}, 100);\n\t\tbundleManager.on('ready', updateBundlesReplicant);\n\t\tbundleManager.on('bundleChanged', updateBundlesReplicant);\n\t\tbundleManager.on('gitChanged', updateBundlesReplicant);\n\t\tbundleManager.on('bundleRemoved', updateBundlesReplicant);\n\t\tupdateBundlesReplicant();\n\n\t\tconst extensionManager = new ExtensionManager(io, bundleManager, replicator, this.mount);\n\t\tthis._extensionManager = extensionManager;\n\t\tthis.emit('extensionsLoaded');\n\t\tthis._extensionManager?.emitToAllInstances('extensionsLoaded');\n\n\t\t// We intentionally wait until all bundles and extensions are loaded before starting the server.\n\t\t// This has two benefits:\n\t\t// 1) Prevents the dashboard/views from being opened before everything has finished loading\n\t\t// 2) Prevents dashboard/views from re-declaring replicants on reconnect before extensions have had a chance\n\t\treturn new Promise((resolve) => {\n\t\t\tserver.listen(\n\t\t\t\t{\n\t\t\t\t\thost: config.host,\n\t\t\t\t\tport: process.env.NODECG_TEST ? undefined : config.port,\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tif (process.env.NODECG_TEST) {\n\t\t\t\t\t\tconst addrInfo = server.address();\n\t\t\t\t\t\tif (typeof addrInfo !== 'object' || addrInfo === null) {\n\t\t\t\t\t\t\tthrow new Error(\"couldn't get port number\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { port } = addrInfo;\n\t\t\t\t\t\tlog.warn(`Test mode active, using automatic listen port: ${port}`);\n\t\t\t\t\t\tconfig.port = port;\n\t\t\t\t\t\tfilteredConfig.port = port;\n\t\t\t\t\t\tprocess.env.NODECG_TEST_PORT = String(port);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst protocol = config.ssl?.enabled ? 'https' : 'http';\n\t\t\t\t\tlog.info('NodeCG running on %s://%s', protocol, config.baseURL);\n\t\t\t\t\tthis.emit('started');\n\t\t\t\t\tthis._extensionManager?.emitToAllInstances('serverStarted');\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\tasync stop(): Promise<void> {\n\t\tthis._extensionManager?.emitToAllInstances('serverStopping');\n\t\tthis._io.disconnectSockets(true);\n\n\t\tawait new Promise<void>((resolve) => {\n\t\t\t// Also closes the underlying HTTP server.\n\t\t\tthis._io.close(() => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t\tif (this._replicator) {\n\t\t\tthis._replicator.saveAllReplicants();\n\t\t}\n\n\t\tthis.emit('stopped');\n\t}\n\n\tgetExtensions(): Record<string, unknown> {\n\t\treturn { ...this._extensionManager?.extensions };\n\t}\n\n\tgetSocketIOServer(): TypedSocketServer {\n\t\treturn this._io;\n\t}\n\n\tmount: NodeCG.Middleware = (...args: any[]) => this._app.use(...args);\n\n\tasync saveAllReplicantsNow(): Promise<void> {\n\t\treturn this._replicator?.saveAllReplicantsNow();\n\t}\n}\n","// Packages\nimport * as Sentry from '@sentry/node';\nimport type { ExtendedError } from 'socket.io/dist/namespace';\n\n// Ours\nimport createLogger from '../logger';\nimport type { TypedServerSocket } from '../../types/socket-protocol';\n\nconst log = createLogger('socket-api');\n\nexport default async function (socket: TypedServerSocket, next: (err?: ExtendedError) => void): Promise<void> {\n\ttry {\n\t\tlog.trace('New socket connection: ID %s with IP %s', socket.id, socket.handshake.address);\n\n\t\tsocket.on('error', (err) => {\n\t\t\tif (global.sentryEnabled) {\n\t\t\t\tSentry.captureException(err);\n\t\t\t}\n\n\t\t\tlog.error(err);\n\t\t});\n\n\t\tsocket.on('message', (data) => {\n\t\t\tlog.trace(\n\t\t\t\t'Received message %s (sent to bundle %s) with data:',\n\t\t\t\tdata.messageName,\n\t\t\t\tdata.bundleName,\n\t\t\t\tdata.content,\n\t\t\t);\n\n\t\t\tsocket.broadcast.emit('message', data);\n\t\t});\n\n\t\tsocket.on('joinRoom', async (room, cb) => {\n\t\t\tif (typeof room !== 'string') {\n\t\t\t\tcb('Room must be a string', undefined);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Object.keys(socket.rooms).includes(room)) {\n\t\t\t\tlog.trace('Socket %s joined room:', socket.id, room);\n\t\t\t\tawait socket.join(room);\n\t\t\t}\n\n\t\t\tcb(undefined, undefined);\n\t\t});\n\n\t\tnext();\n\t} catch (error: unknown) {\n\t\tnext(error as any);\n\t}\n}\n","// Native\nimport path from 'path';\n\n// Packages\nimport express from 'express';\n\n// Ours\nimport { authCheck, sendFile } from './util';\nimport type { NodeCG } from '../types/nodecg';\n\nexport default class SharedSourcesLib {\n\tapp = express();\n\n\tconstructor(bundles: NodeCG.Bundle[]) {\n\t\tthis.app.get('/bundles/:bundleName/shared/*', authCheck, (req, res, next) => {\n\t\t\tconst { bundleName } = req.params as Record<string, string>;\n\t\t\tconst bundle = bundles.find((b) => b.name === bundleName);\n\t\t\tif (!bundle) {\n\t\t\t\tnext();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Essentially behave like express.static\n\t\t\t// Serve up files with no extra logic\n\t\t\tconst resName = req.params[0];\n\t\t\tconst parentDir = path.join(bundle.dir, 'shared');\n\t\t\tconst fileLocation = path.join(parentDir, resName);\n\t\t\tsendFile(parentDir, fileLocation, res, next);\n\t\t});\n\t}\n}\n","// Native\nimport path from 'path';\n\n// Packages\nimport clone from 'clone';\nimport express from 'express';\nimport sha1File from 'sha1-file';\n\n// Ours\nimport type { Replicator } from './replicant';\nimport type ServerReplicant from './replicant/server-replicant';\nimport { sendFile } from './util';\nimport type { NodeCG } from '../types/nodecg';\nimport rootPath from '../shared/utils/rootPath';\n\nexport default class SoundsLib {\n\tapp = express();\n\n\tprivate readonly _bundles: NodeCG.Bundle[];\n\n\tprivate readonly _cueRepsByBundle = new Map<string, ServerReplicant<NodeCG.SoundCue[]>>();\n\n\tconstructor(bundles: NodeCG.Bundle[], replicator: Replicator) {\n\t\tthis._bundles = bundles;\n\n\t\t// Create the replicant for the \"Master Fader\"\n\t\treplicator.declare('volume:master', '_sounds', { defaultValue: 100 });\n\n\t\tbundles.forEach((bundle) => {\n\t\t\t// If this bundle has sounds\n\t\t\tif (bundle.soundCues.length > 0) {\n\t\t\t\t// Create an array replicant that will hold all this bundle's sound cues.\n\t\t\t\tconst defaultCuesRepValue = this._makeCuesRepDefaultValue(bundle);\n\n\t\t\t\tconst cuesRep = replicator.declare<NodeCG.SoundCue[]>('soundCues', bundle.name, {\n\t\t\t\t\tschemaPath: path.resolve(rootPath.path, 'schemas/soundCues.json'),\n\t\t\t\t\tdefaultValue: [],\n\t\t\t\t});\n\n\t\t\t\tthis._cueRepsByBundle.set(bundle.name, cuesRep);\n\n\t\t\t\tif (cuesRep.value.length > 0) {\n\t\t\t\t\t// Remove any persisted cues that are no longer in the bundle manifest.\n\t\t\t\t\tcuesRep.value = cuesRep.value.filter((persistedCue) =>\n\t\t\t\t\t\tdefaultCuesRepValue.find((defaultCue) => defaultCue.name === persistedCue.name),\n\t\t\t\t\t);\n\n\t\t\t\t\t// Add/update any cues in the bundle manifest that aren't in the persisted replicant.\n\t\t\t\t\tdefaultCuesRepValue.forEach((defaultCue) => {\n\t\t\t\t\t\tconst existingIndex = cuesRep.value.findIndex(\n\t\t\t\t\t\t\t(persistedCue) => persistedCue.name === defaultCue.name,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// We need to just update a few key properties in the persisted cue.\n\t\t\t\t\t\t// We leave things like volume as-is.\n\t\t\t\t\t\tif (existingIndex >= 0) {\n\t\t\t\t\t\t\tcuesRep.value[existingIndex].assignable = defaultCue.assignable;\n\t\t\t\t\t\t\tcuesRep.value[existingIndex].defaultFile = defaultCue.defaultFile;\n\n\t\t\t\t\t\t\t// If we're updating the cue to not be assignable, then we have to\n\t\t\t\t\t\t\t// set the `defaultFile` as the selected `file`.\n\t\t\t\t\t\t\tif (!defaultCue.assignable && defaultCue.defaultFile) {\n\t\t\t\t\t\t\t\tcuesRep.value[existingIndex].file = clone(defaultCue.defaultFile);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcuesRep.value.push(defaultCue);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// There's no persisted value, so just assign the default.\n\t\t\t\t\tcuesRep.value = defaultCuesRepValue;\n\t\t\t\t}\n\n\t\t\t\t// Create this bundle's \"Bundle Fader\"\n\t\t\t\treplicator.declare(`volume:${bundle.name}`, '_sounds', {\n\t\t\t\t\tdefaultValue: 100,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.app.get('/sound/:bundleName/:cueName/default.mp3', this._serveDefault.bind(this));\n\t\tthis.app.get('/sound/:bundleName/:cueName/default.ogg', this._serveDefault.bind(this));\n\t}\n\n\tprivate _serveDefault(req: express.Request, res: express.Response, next: express.NextFunction): void {\n\t\tconst bundle = this._bundles.find((b) => b.name === req.params.bundleName);\n\t\tif (!bundle) {\n\t\t\tres.status(404).send(`File not found: ${req.path}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst cue = bundle.soundCues.find((cue) => cue.name === req.params.cueName);\n\t\tif (!cue) {\n\t\t\tres.status(404).send(`File not found: ${req.path}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!cue.defaultFile) {\n\t\t\tres.status(404).send(`Cue \"${cue.name}\" had no default file`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentDir = bundle.dir;\n\t\tconst fullPath = path.join(parentDir, cue.defaultFile);\n\t\tsendFile(parentDir, fullPath, res, next);\n\t}\n\n\tprivate _makeCuesRepDefaultValue(bundle: NodeCG.Bundle): NodeCG.SoundCue[] {\n\t\tconst formattedCues: NodeCG.SoundCue[] = [];\n\t\tfor (const rawCue of bundle.soundCues) {\n\t\t\tlet file: NodeCG.CueFile | undefined;\n\t\t\tif (rawCue.defaultFile) {\n\t\t\t\tconst filepath = path.join(bundle.dir, rawCue.defaultFile);\n\t\t\t\tconst parsedPath = path.parse(filepath);\n\t\t\t\tfile = {\n\t\t\t\t\tsum: sha1File.sync(filepath),\n\t\t\t\t\tbase: parsedPath.base,\n\t\t\t\t\text: parsedPath.ext,\n\t\t\t\t\tname: parsedPath.name,\n\t\t\t\t\turl: `/sound/${bundle.name}/${rawCue.name}/default${parsedPath.ext}`,\n\t\t\t\t\tdefault: true,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst formatted: NodeCG.SoundCue = {\n\t\t\t\tname: rawCue.name,\n\t\t\t\tassignable: Boolean(rawCue.assignable),\n\t\t\t\tvolume: rawCue.defaultVolume ?? 30,\n\t\t\t};\n\n\t\t\tif ('defaultVolume' in rawCue) {\n\t\t\t\tformatted.defaultVolume = rawCue.defaultVolume;\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tformatted.file = file;\n\t\t\t\tformatted.defaultFile = clone(file);\n\t\t\t}\n\n\t\t\tformattedCues.push(formatted);\n\t\t}\n\n\t\treturn formattedCues;\n\t}\n}\n","// Packages\nimport type express from 'express';\n\n// Ours\nimport { getConnection, ApiKey } from '../database';\nimport { isSuperUser, findUser } from '../database/utils';\nimport { config } from '../config';\n\n/**\n * Express middleware that checks if the user is authenticated.\n */\nexport default async function (req: express.Request, res: express.Response, next: express.NextFunction): Promise<void> {\n\ttry {\n\t\tif (!config.login?.enabled) {\n\t\t\tnext();\n\t\t\treturn;\n\t\t}\n\n\t\tlet { user } = req;\n\t\tlet isUsingKeyOrSocketToken = false;\n\t\tlet keyOrSocketTokenAuthenticated = false;\n\t\tif (req.query.key ?? req.cookies.socketToken) {\n\t\t\tisUsingKeyOrSocketToken = true;\n\t\t\tconst database = await getConnection();\n\t\t\tconst apiKey = await database.getRepository(ApiKey).findOne({\n\t\t\t\twhere: { secret_key: req.query.key ?? req.cookies.socketToken },\n\t\t\t\trelations: ['user'],\n\t\t\t});\n\n\t\t\t// No record of this API Key found, reject the request.\n\t\t\tif (!apiKey) {\n\t\t\t\t// Ensure we delete the existing cookie so that it doesn't become poisoned\n\t\t\t\t// and cause an infinite login loop.\n\t\t\t\treq.session?.destroy(() => {\n\t\t\t\t\tres.clearCookie('socketToken', {\n\t\t\t\t\t\tsecure: req.secure,\n\t\t\t\t\t\tsameSite: req.secure ? 'none' : undefined,\n\t\t\t\t\t});\n\t\t\t\t\tres.clearCookie('connect.sid', { path: '/' });\n\t\t\t\t\tres.clearCookie('io', { path: '/' });\n\n\t\t\t\t\tres.redirect('/login');\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tuser = (await findUser(apiKey.user.id)) ?? undefined;\n\t\t}\n\n\t\tif (!user) {\n\t\t\tif (req.session) {\n\t\t\t\treq.session.returnTo = req.url;\n\t\t\t}\n\n\t\t\tres.status(403).redirect('/login');\n\t\t\treturn;\n\t\t}\n\n\t\tconst allowed = isSuperUser(user);\n\t\tkeyOrSocketTokenAuthenticated = isUsingKeyOrSocketToken && allowed;\n\t\tconst provider = user.identities[0]?.provider_type;\n\t\tconst providerAllowed = config.login?.[provider]?.enabled;\n\t\tif ((keyOrSocketTokenAuthenticated || req.isAuthenticated()) && allowed && providerAllowed) {\n\t\t\tlet apiKey = user.apiKeys[0];\n\n\t\t\t// This should only happen if the database is manually edited, say, in the event of a security breach\n\t\t\t// that reavealed an API key that needed to be deleted.\n\t\t\tif (!apiKey) {\n\t\t\t\t// Make a new api key.\n\t\t\t\tconst database = await getConnection();\n\t\t\t\tapiKey = database.manager.create(ApiKey);\n\t\t\t\tawait database.manager.save(apiKey);\n\n\t\t\t\t// Assign this key to the user.\n\t\t\t\tuser.apiKeys.push(apiKey);\n\t\t\t\tawait database.manager.save(user);\n\t\t\t}\n\n\t\t\t// Set the cookie so that requests to other resources on the page\n\t\t\t// can also be authenticated.\n\t\t\t// This is crucial for things like OBS browser sources,\n\t\t\t// where we don't have a session.\n\t\t\tres.cookie('socketToken', apiKey.secret_key, {\n\t\t\t\tsecure: req.secure,\n\t\t\t\tsameSite: req.secure ? 'none' : undefined,\n\t\t\t});\n\n\t\t\tnext();\n\t\t\treturn;\n\t\t}\n\n\t\tif (req.session) {\n\t\t\treq.session.returnTo = req.url;\n\t\t}\n\n\t\tres.status(403).redirect('/login');\n\t\treturn;\n\t} catch (error: unknown) {\n\t\tnext(error);\n\t}\n}\n","const timers = new Map<string, NodeJS.Timer>();\n\n/**\n * A standard debounce, but uses a string `name` as the key instead of the callback.\n */\nexport default function (name: string, callback: () => void, duration = 500): void {\n\tconst existing = timers.get(name);\n\tif (existing) {\n\t\tclearTimeout(existing);\n\t}\n\n\ttimers.set(\n\t\tname,\n\t\tsetTimeout(() => {\n\t\t\ttimers.delete(name);\n\t\t\tcallback();\n\t\t}, duration),\n\t);\n}\n","// Adapted from https://github.com/sindresorhus/exit-hook/blob/9fdc03b855f12f79a0d13246c38ca9b2114c8d2e/index.js\nimport process from 'node:process';\n\ntype syncExitFn = (signal: number) => void;\ntype asyncExitFn = (signal: number) => void | Promise<void>;\ntype anyExitFn = syncExitFn | asyncExitFn;\n\nconst asyncCallbacks = new Set<[asyncExitFn, number | undefined]>();\nconst callbacks = new Set<syncExitFn>();\n\nlet isCalled = false;\nlet isRegistered = false;\n\nasync function exit(shouldManuallyExit: boolean, isSynchronous: boolean, signal: number) {\n\tif (isCalled) {\n\t\treturn;\n\t}\n\n\tisCalled = true;\n\n\tif (asyncCallbacks.size > 0 && isSynchronous) {\n\t\tconsole.error(\n\t\t\t[\n\t\t\t\t'SYNCHRONOUS TERMINATION NOTICE:',\n\t\t\t\t'When explicitly exiting the process via process.exit or via a parent process,',\n\t\t\t\t'asynchronous tasks in your exitHooks will not run. Either remove these tasks,',\n\t\t\t\t'use gracefulExit() instead of process.exit(), or ensure your parent process',\n\t\t\t\t'sends a SIGINT to the process running this code.',\n\t\t\t].join(' '),\n\t\t);\n\t}\n\n\tconst exitCode = 128 + signal;\n\n\tconst done = (force = false) => {\n\t\tif (force || shouldManuallyExit) {\n\t\t\tprocess.exit(exitCode);\n\t\t}\n\t};\n\n\tfor (const callback of callbacks) {\n\t\tcallback(exitCode);\n\t}\n\n\tif (isSynchronous) {\n\t\tdone();\n\t\treturn;\n\t}\n\n\tconst promises = [];\n\tlet forceAfter = 0;\n\tfor (const [callback, wait] of asyncCallbacks) {\n\t\tforceAfter = Math.max(forceAfter, wait ?? 0);\n\t\tpromises.push(Promise.resolve(callback(exitCode)));\n\t}\n\n\t// Force exit if we exceeded our wait value\n\tconst asyncTimer = setTimeout(() => {\n\t\tdone(true);\n\t}, forceAfter);\n\n\tawait Promise.all(promises);\n\tclearTimeout(asyncTimer);\n\tdone();\n}\n\nfunction addHook(options: { onExit: anyExitFn; minimumWait?: number; isSynchronous: boolean }) {\n\tconst { onExit, minimumWait, isSynchronous } = options;\n\tconst asyncCallbackConfig: [asyncExitFn, number | undefined] = [onExit, minimumWait];\n\n\tif (isSynchronous) {\n\t\tcallbacks.add(onExit);\n\t} else {\n\t\tasyncCallbacks.add(asyncCallbackConfig);\n\t}\n\n\tif (!isRegistered) {\n\t\tisRegistered = true;\n\n\t\t// Exit cases that support asynchronous handling\n\t\tprocess.once('beforeExit', exit.bind(undefined, true, false, -128));\n\t\tprocess.once('SIGHUP', exit.bind(undefined, true, false, 1));\n\t\tprocess.once('SIGINT', exit.bind(undefined, true, false, 2));\n\t\tprocess.once('SIGTERM', exit.bind(undefined, true, false, 15));\n\n\t\t// Explicit exit events. Calling will force an immediate exit and run all\n\t\t// synchronous hooks. Explicit exits must not extend the node process\n\t\t// artificially. Will log errors if asynchronous calls exist.\n\t\tprocess.once('exit', exit.bind(undefined, false, true, 0));\n\n\t\t// PM2 Cluster shutdown message. Caught to support async handlers with pm2,\n\t\t// needed because explicitly calling process.exit() doesn't trigger the\n\t\t// beforeExit event, and the exit event cannot support async handlers,\n\t\t// since the event loop is never called after it.\n\t\tprocess.on('message', (message) => {\n\t\t\tif (message === 'shutdown') {\n\t\t\t\tvoid exit(true, true, -128);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn () => {\n\t\tif (isSynchronous) {\n\t\t\tcallbacks.delete(onExit);\n\t\t} else {\n\t\t\tasyncCallbacks.delete(asyncCallbackConfig);\n\t\t}\n\t};\n}\n\nexport default function exitHook(onExit: syncExitFn) {\n\tif (typeof onExit !== 'function') {\n\t\tthrow new TypeError('onExit must be a function');\n\t}\n\n\treturn addHook({\n\t\tonExit,\n\t\tisSynchronous: true,\n\t});\n}\n\nexport function asyncExitHook(onExit: asyncExitFn, options: { minimumWait?: number } = {}) {\n\tif (typeof onExit !== 'function') {\n\t\tthrow new TypeError('onExit must be a function');\n\t}\n\n\tif (!(typeof options.minimumWait === 'number' && options.minimumWait > 0)) {\n\t\tthrow new TypeError('minimumWait must be set to a positive numeric value');\n\t}\n\n\treturn addHook({\n\t\tonExit,\n\t\tminimumWait: options.minimumWait,\n\t\tisSynchronous: false,\n\t});\n}\n\nexport function gracefulExit(signal = 0) {\n\tvoid exit(true, false, -128 + signal);\n}\n","export { default as noop } from './noop';\nexport { default as debounceName } from './debounce-name';\nexport { default as injectScripts } from './injectscripts';\nexport { default as authCheck } from './authcheck';\nexport { default as throttleName } from './throttle-name';\nexport { default as pjson } from './pjson';\nexport { default as sendFile } from './sendFile';\nexport { asyncExitHook } from './exit-hook';\n","/* eslint-disable complexity */\n// Native\nimport fs from 'fs';\n\n// Packages\nimport cheerio from 'cheerio';\nimport semver from 'semver';\n\n// Ours\nimport { filteredConfig } from '../config';\nimport { noop } from '../util';\nimport type { NodeCG } from '../../types/nodecg';\n\ntype Options = {\n\tstandalone?: boolean;\n\tcreateApiInstance?: NodeCG.Bundle;\n\tsound?: boolean;\n\tfullbleed?: boolean;\n};\n\n/**\n * Injects the appropriate assets into a panel, dialog, or graphic.\n */\nexport default function (\n\tpathOrHtml: string,\n\tresourceType: 'panel' | 'dialog' | 'graphic',\n\t{ standalone = false, createApiInstance, sound = false, fullbleed = false }: Options = {} as Options,\n\tcb: (html: string) => void = noop,\n): void {\n\t// Graphics only pass the path to the html file.\n\t// Panels and dialogs pass a cached HTML string.\n\tif (resourceType === 'graphic') {\n\t\tfs.readFile(pathOrHtml, { encoding: 'utf8' }, (error, data) => {\n\t\t\tinject(error ?? undefined, data);\n\t\t});\n\t} else {\n\t\tinject(undefined, pathOrHtml);\n\t}\n\n\tfunction inject(err: NodeJS.ErrnoException | undefined, html: string): void {\n\t\tif (err) {\n\t\t\tthrow err;\n\t\t}\n\n\t\tconst $ = cheerio.load(html);\n\t\tconst scripts = [];\n\t\tconst styles = [];\n\n\t\t// Everything needs the config\n\t\tscripts.push(`<script>globalThis.ncgConfig = ${JSON.stringify(filteredConfig)};</script>`);\n\n\t\tif (resourceType === 'panel' || resourceType === 'dialog') {\n\t\t\tif (standalone) {\n\t\t\t\t// Load the API\n\t\t\t\tscripts.push('<script src=\"/nodecg-api.min.js\"></script>');\n\t\t\t} else {\n\t\t\t\t// Panels and dialogs can grab the API from the dashboard\n\t\t\t\tscripts.push('<script>window.NodeCG = window.top.NodeCG</script>');\n\t\t\t}\n\n\t\t\t// Both panels and dialogs need the main default styles\n\t\t\tscripts.push('<link rel=\"stylesheet\" href=\"/dashboard/css/panel-and-dialog-defaults.css\">');\n\n\t\t\tif (standalone) {\n\t\t\t\t// Load the socket\n\t\t\t\tscripts.push('<script src=\"/socket.js\"></script>');\n\t\t\t} else {\n\t\t\t\t// They both also need to reference the dashboard window's socket, rather than make their own\n\t\t\t\tscripts.push('<script>window.socket = window.top.socket;</script>');\n\t\t\t}\n\n\t\t\t// Likewise, they both need the contentWindow portion of the iframeResizer.\n\t\t\t// We put this at the start and make it async so it loads ASAP.\n\t\t\tif (!fullbleed) {\n\t\t\t\tscripts.unshift(\n\t\t\t\t\t'<script async src=\"/node_modules/iframe-resizer/js/iframeResizer.contentWindow.min.js\">' +\n\t\t\t\t\t\t'</script>',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Panels need the default panel styles and the dialog_opener.\n\t\t\tif (resourceType === 'panel') {\n\t\t\t\t// In v1.1.0, we changed the Dashboard to have a dark theme.\n\t\t\t\t// This also meant that we wanted to update the default panel styles.\n\t\t\t\t// However, this technically would have been a breaking change...\n\t\t\t\t// To minimize breakage, we only inject the new styles if\n\t\t\t\t// the bundle specifically lists support for v1.0.0.\n\t\t\t\t// If it only supports v1.1.0 and on, we assume it wants the dark theme styles.\n\t\t\t\tif (createApiInstance && semver.satisfies('1.0.0', createApiInstance.compatibleRange)) {\n\t\t\t\t\tstyles.push('<link rel=\"stylesheet\" href=\"/dashboard/css/old-panel-defaults.css\">');\n\t\t\t\t} else {\n\t\t\t\t\tstyles.push('<link rel=\"stylesheet\" href=\"/dashboard/css/panel-defaults.css\">');\n\t\t\t\t}\n\n\t\t\t\tscripts.push('<script async src=\"/dialog_opener.js\"></script>');\n\t\t\t} else if (resourceType === 'dialog') {\n\t\t\t\tstyles.push('<link rel=\"stylesheet\" href=\"/dashboard/css/dialog-defaults.css\">');\n\t\t\t}\n\t\t} else if (resourceType === 'graphic') {\n\t\t\tif (global.sentryEnabled) {\n\t\t\t\tscripts.unshift(\n\t\t\t\t\t'<script src=\"/node_modules/@sentry/browser/build/bundle.es6.min.js\"></script>',\n\t\t\t\t\t'<script src=\"/sentry.js\"></script>',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Graphics need to create their own socket\n\t\t\tscripts.push('<script src=\"/socket.io/socket.io.js\"></script>');\n\t\t\tscripts.push('<script src=\"/socket.js\"></script>');\n\n\t\t\t// If this bundle has sounds, inject SoundJS\n\t\t\tif (sound) {\n\t\t\t\tscripts.push('<script src=\"/node_modules/soundjs/lib/soundjs.min.js\"></script>');\n\t\t\t}\n\n\t\t\t// Graphics must include the API script themselves before attempting to make an instance of it\n\t\t\tscripts.push('<script src=\"/nodecg-api.min.js\"></script>');\n\t\t}\n\n\t\t// Inject a small script to create a NodeCG API instance, if requested.\n\t\tif (createApiInstance) {\n\t\t\tconst partialBundle = {\n\t\t\t\tname: createApiInstance.name,\n\t\t\t\tconfig: createApiInstance.config,\n\t\t\t\tversion: createApiInstance.version,\n\t\t\t\tgit: createApiInstance.git,\n\t\t\t\t_hasSounds: sound,\n\t\t\t};\n\n\t\t\tscripts.push(\n\t\t\t\t`<script>globalThis.nodecg = new globalThis.NodeCG(${JSON.stringify(\n\t\t\t\t\tpartialBundle,\n\t\t\t\t)}, globalThis.socket)</script>`,\n\t\t\t);\n\t\t}\n\n\t\t// Inject the scripts required for singleInstance behavior, if requested.\n\t\tif (resourceType === 'graphic' && !(pathOrHtml.endsWith('busy.html') || pathOrHtml.endsWith('killed.html'))) {\n\t\t\tscripts.push('<script src=\"/client_registration.js\"></script>');\n\t\t}\n\n\t\tconst concattedScripts = scripts.join('\\n');\n\n\t\t// Put our scripts before their first script or HTML import.\n\t\t// If they have no scripts or imports, put our scripts at the end of <body>.\n\t\tconst theirScriptsAndImports = $('script, link[rel=\"import\"]');\n\t\tif (theirScriptsAndImports.length > 0) {\n\t\t\ttheirScriptsAndImports.first().before(concattedScripts);\n\t\t} else {\n\t\t\t$('body').append(concattedScripts);\n\t\t}\n\n\t\t// Prepend our styles before the first one.\n\t\t// If there are no styles, put our styles at the end of <head>.\n\t\tif (styles.length > 0) {\n\t\t\tconst concattedStyles = styles.join('\\n');\n\t\t\tconst headStyles = $('head').find('style, link[rel=\"stylesheet\"]');\n\t\t\tif (headStyles.length > 0) {\n\t\t\t\theadStyles.first().before(concattedStyles);\n\t\t\t} else {\n\t\t\t\t$('head').append(concattedStyles);\n\t\t\t}\n\t\t}\n\n\t\tcb($.html());\n\t}\n}\n","import path from 'path';\n\n/**\n * Checks if a given path (dirOrFile) is a child of another given path (parent).\n */\nexport default function isChildOf(parent: string, dirOrFile: string): boolean {\n\tconst relative = path.relative(parent, dirOrFile);\n\treturn Boolean(relative) && !relative.startsWith('..') && !path.isAbsolute(relative);\n}\n","export default (): void => {}; // eslint-disable-line @typescript-eslint/no-empty-function\n","// Native\nimport path from 'path';\nimport fs from 'fs';\n\n// Ours\nimport rootPath from '../../shared/utils/rootPath';\n\nconst pjsonPath = path.join(rootPath.path, 'package.json');\nconst rawContents = fs.readFileSync(pjsonPath, 'utf8');\nconst pjson = JSON.parse(rawContents);\nexport default pjson;\n","// Native\nimport path from 'path';\n\n// Packages\nimport type express from 'express';\nimport isChildOf from './isChildOf';\n\nexport default (\n\tdirectoryToPreventTraversalOutOf: string,\n\tfileLocation: string,\n\tres: express.Response,\n\tnext: express.NextFunction,\n): void => {\n\tif (isChildOf(directoryToPreventTraversalOutOf, fileLocation)) {\n\t\tres.sendFile(fileLocation, (err: NodeJS.ErrnoException) => {\n\t\t\tif (err) {\n\t\t\t\tif (err.code === 'ENOENT') {\n\t\t\t\t\treturn res.type(path.extname(fileLocation)).sendStatus(404);\n\t\t\t\t}\n\n\t\t\t\t/* istanbul ignore next */\n\t\t\t\tif (!res.headersSent) {\n\t\t\t\t\tnext(err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t});\n\t} else {\n\t\tres.sendStatus(404);\n\t}\n};\n","// Native\nimport path from 'path';\nimport os from 'os';\n\n// Packages\nimport * as Sentry from '@sentry/node';\nimport express from 'express';\n\n// Ours\nimport { config } from '../config';\nimport type BundleManager from '../bundle-manager';\nimport { authCheck, pjson } from '../util';\nimport type { NodeCG } from '../../types/nodecg';\nimport rootPath from '../../shared/utils/rootPath';\n\nconst VIEWS_PATH = path.join(rootPath.path, 'build/server/templates');\nconst baseSentryConfig = {\n\tdsn: config.sentry?.dsn,\n\tserverName: os.hostname(),\n\trelease: pjson.version,\n};\n\nexport default class SentryConfig {\n\treadonly bundleMetadata: Array<{ name: string; git: NodeCG.Bundle.GitData; version: string }> = [];\n\treadonly app = express();\n\n\tconstructor(bundleManager: BundleManager) {\n\t\tconst { app, bundleMetadata } = this;\n\t\tapp.set('views', VIEWS_PATH);\n\n\t\tbundleManager.on('ready', () => {\n\t\t\tSentry.configureScope((scope) => {\n\t\t\t\tbundleManager.all().forEach((bundle) => {\n\t\t\t\t\tbundleMetadata.push({\n\t\t\t\t\t\tname: bundle.name,\n\t\t\t\t\t\tgit: bundle.git,\n\t\t\t\t\t\tversion: bundle.version,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tscope.setExtra('bundles', bundleMetadata);\n\t\t\t});\n\t\t});\n\n\t\tbundleManager.on('gitChanged', (bundle) => {\n\t\t\tconst metadataToUpdate = bundleMetadata.find((data) => data.name === bundle.name);\n\t\t\tif (!metadataToUpdate) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmetadataToUpdate.git = bundle.git;\n\t\t\tmetadataToUpdate.version = bundle.version;\n\t\t});\n\n\t\t// Render a pre-configured Sentry instance for client pages that request it.\n\t\tapp.get('/sentry.js', authCheck, (_req, res) => {\n\t\t\tres.type('.js');\n\t\t\tres.render(path.join(VIEWS_PATH, 'sentry.js.tmpl'), {\n\t\t\t\tbaseSentryConfig,\n\t\t\t\tbundleMetadata,\n\t\t\t});\n\t\t});\n\t}\n}\n","const timers = new Map<string, NodeJS.Timer>();\nconst queued = new Set<string>();\n\n/**\n * A standard throttle, but uses a string `name` as the key instead of the callback.\n */\nexport default function (name: string, callback: () => void, duration = 500): void {\n\tconst existing = timers.get(name);\n\tif (existing) {\n\t\tqueued.add(name);\n\t\treturn;\n\t}\n\n\tcallback();\n\ttimers.set(\n\t\tname,\n\t\tsetTimeout(() => {\n\t\t\ttimers.delete(name);\n\t\t\tif (queued.has(name)) {\n\t\t\t\tqueued.delete(name);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}, duration),\n\t);\n}\n","// Packages\nimport type { DeepReadonly } from 'ts-essentials';\n\n// Ours\nconst { version } = require('../../package.json');\nimport type { AbstractReplicant } from './replicants.shared';\nimport type { NodeCG } from '../types/nodecg';\nimport { TypedEmitter, type EventMap } from './typed-emitter';\n\ntype MessageHandler = {\n\tmessageName: string;\n\tbundleName: string;\n\tfunc: NodeCG.ListenHandler;\n};\n\nexport abstract class NodeCGAPIBase<\n\tP extends NodeCG.Platform,\n\tC extends Record<string, any>,\n\tE extends EventMap,\n> extends TypedEmitter<E> {\n\tstatic version = version;\n\n\t/**\n\t * An object containing references to all Replicants that have been declared in this `window`, sorted by bundle.\n\t * E.g., `NodeCG.declaredReplicants.myBundle.myRep`\n\t */\n\tstatic declaredReplicants: Map<string, Map<string, AbstractReplicant<'client', any>>>;\n\n\t/**\n\t * Lets you easily wait for a group of Replicants to finish declaring.\n\t *\n\t * Returns a promise which is resolved once all provided Replicants\n\t * have emitted a `change` event, which is indicates that they must\n\t * have finished declaring.\n\t *\n\t * This method is only useful in client-side code.\n\t * Server-side code never has to wait for Replicants.\n\t *\n\t * @param replicants {Replicant}\n\t * @returns {Promise<any>}\n\t *\n\t * @example <caption>From a graphic or dashboard panel:</caption>\n\t * const rep1 = nodecg.Replicant('rep1');\n\t * const rep2 = nodecg.Replicant('rep2');\n\t *\n\t * // You can provide as many Replicant arguments as you want,\n\t * // this example just uses two Replicants.\n\t * NodeCG.waitForReplicants(rep1, rep2).then(() => {\n\t *     console.log('rep1 and rep2 are fully declared and ready to use!');\n\t * });\n\t */\n\tstatic async waitForReplicants(...replicants: Array<AbstractReplicant<'client', any>>): Promise<void> {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst numReplicants = replicants.length;\n\t\t\tlet declaredReplicants = 0;\n\t\t\treplicants.forEach((replicant) => {\n\t\t\t\treplicant.once('change', () => {\n\t\t\t\t\tdeclaredReplicants++;\n\t\t\t\t\tif (declaredReplicants >= numReplicants) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * The name of the bundle which this NodeCG API instance is for.\n\t */\n\treadonly bundleName: string;\n\n\t/**\n\t * An object containing the parsed content of `cfg/<bundle-name>.json`, the contents of which\n\t * are read once when NodeCG starts up. Used to quickly access per-bundle configuration properties.\n\t */\n\treadonly bundleConfig: DeepReadonly<C>;\n\n\t/**\n\t * The version (from package.json) of the bundle which this NodeCG API instance is for.\n\t * @name NodeCG#bundleVersion\n\t */\n\treadonly bundleVersion: string;\n\n\t/**\n\t * Provides information about the current git status of this bundle, if found.\n\t */\n\treadonly bundleGit: Readonly<NodeCG.Bundle.GitData>;\n\n\t_messageHandlers: MessageHandler[] = [];\n\n\t/**\n\t * Since the process of instantiating a Replicant is quite different on\n\t * the client and server, this abstract class relies on its child classes\n\t * to define this method that handles this context-specific logic.\n\t */\n\tprotected abstract readonly _replicantFactory: <\n\t\tV,\n\t\tO extends NodeCG.Replicant.Options<any> = NodeCG.Replicant.Options<V>,\n\t>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts: O,\n\t) => AbstractReplicant<P, V, O>;\n\n\t/**\n\t * Provides easy access to the Logger class.\n\t * Useful in cases where you want to create your own custom logger.\n\t */\n\tabstract get Logger(): new (name: string) => NodeCG.Logger;\n\n\t/**\n\t * An instance of NodeCG's Logger, with the following methods. The logging level is set in `cfg/nodecg.json`,\n\t * NodeCG's global config file.\n\t * ```\n\t * nodecg.log.trace('trace level logging');\n\t * nodecg.log.debug('debug level logging');\n\t * nodecg.log.info('info level logging');\n\t * nodecg.log.warn('warn level logging');\n\t * nodecg.log.error('error level logging');\n\t * ```\n\t */\n\tabstract get log(): NodeCG.Logger;\n\n\tconstructor(bundle: NodeCG.Bundle) {\n\t\tsuper();\n\t\tthis.bundleName = bundle.name;\n\t\tthis.bundleConfig = bundle.config as DeepReadonly<C>;\n\t\tthis.bundleVersion = bundle.version;\n\t\tthis.bundleGit = bundle.git;\n\t}\n\n\t/**\n\t * Listens for a message, and invokes the provided callback each time the message is received.\n\t * If any data was sent with the message, it will be passed to the callback.\n\t *\n\t * Messages are namespaced by bundle.\n\t * To listen to a message in another bundle's namespace, provide it as the second argument.\n\t *\n\t * You may define multiple listenFor handlers for a given message.\n\t * They will be called in the order they were registered.\n\t *\n\t * @example\n\t * nodecg.listenFor('printMessage', message => {\n\t *     console.log(message);\n\t * });\n\t *\n\t * @example <caption>Listening to a message in another bundle's namespace:</caption>\n\t * nodecg.listenFor('printMessage', 'another-bundle', message => {\n\t *     console.log(message);\n\t * });\n\t */\n\tlistenFor(messageName: string, handlerFunc: NodeCG.ListenHandler): void;\n\tlistenFor(messageName: string, bundleName: string, handlerFunc: NodeCG.ListenHandler): void;\n\tlistenFor(\n\t\tmessageName: string,\n\t\tbundleNameOrHandlerFunc: string | NodeCG.ListenHandler,\n\t\thandlerFunc?: NodeCG.ListenHandler,\n\t): void {\n\t\tlet bundleName: string;\n\t\tif (typeof bundleNameOrHandlerFunc === 'string') {\n\t\t\tbundleName = bundleNameOrHandlerFunc;\n\t\t} else {\n\t\t\tbundleName = this.bundleName;\n\t\t\thandlerFunc = bundleNameOrHandlerFunc;\n\t\t}\n\n\t\tif (typeof handlerFunc !== 'function') {\n\t\t\tthrow new Error(`argument \"handler\" must be a function, but you provided a(n) ${typeof handlerFunc}`);\n\t\t}\n\n\t\tthis.log.trace('Listening for %s from bundle %s', messageName, bundleNameOrHandlerFunc);\n\t\tthis._messageHandlers.push({\n\t\t\tmessageName,\n\t\t\tbundleName,\n\t\t\tfunc: handlerFunc,\n\t\t});\n\t}\n\n\t/**\n\t * Removes a listener for a message.\n\t *\n\t * Messages are namespaced by bundle.\n\t * To remove a listener to a message in another bundle's namespace, provide it as the second argument.\n\t *\n\t * @param {string} messageName - The name of the message.\n\t * @param {string} [bundleName=CURR_BNDL] - The bundle namespace to in which to listen for this message\n\t * @param {function} handlerFunc - A reference to a handler function added as a listener to this message via {@link NodeCG#listenFor}.\n\t * @returns {boolean}\n\t *\n\t * @example\n\t * nodecg.unlisten('printMessage', someFunctionName);\n\t *\n\t * @example <caption>Removing a listener from a message in another bundle's namespace:</caption>\n\t * nodecg.unlisten('printMessage', 'another-bundle', someFunctionName);\n\t */\n\tunlisten(messageName: string, handlerFunc: NodeCG.ListenHandler): boolean;\n\tunlisten(\n\t\tmessageName: string,\n\t\tbundleNameOrHandler: string | NodeCG.ListenHandler,\n\t\tmaybeHandler?: NodeCG.ListenHandler,\n\t): boolean {\n\t\tlet { bundleName } = this;\n\t\tlet handlerFunc = maybeHandler;\n\t\tif (typeof bundleNameOrHandler === 'string') {\n\t\t\tbundleName = bundleNameOrHandler;\n\t\t} else {\n\t\t\thandlerFunc = bundleNameOrHandler;\n\t\t}\n\n\t\tif (typeof handlerFunc !== 'function') {\n\t\t\tthrow new Error(`argument \"handler\" must be a function, but you provided a(n) ${typeof handlerFunc}`);\n\t\t}\n\n\t\tthis.log.trace('[%s] Removing listener for %s from bundle %s', this.bundleName, messageName, bundleName);\n\n\t\t// Find the index of this handler in the array.\n\t\tconst index = this._messageHandlers.findIndex(\n\t\t\t(handler) =>\n\t\t\t\thandler.messageName === messageName &&\n\t\t\t\thandler.bundleName === bundleName &&\n\t\t\t\thandler.func === handlerFunc,\n\t\t);\n\n\t\t// If the handler exists, remove it and return true.\n\t\tif (index >= 0) {\n\t\t\tthis._messageHandlers.splice(index, 1);\n\t\t\treturn true;\n\t\t}\n\n\t\t// Else, return false.\n\t\treturn false;\n\t}\n\n\t/**\n\t * Replicants are objects which monitor changes to a variable's value.\n\t * The changes are replicated across all extensions, graphics, and dashboard panels.\n\t * When a Replicant changes in one of those places it is quickly updated in the rest,\n\t * and a `change` event is emitted allowing bundles to react to the changes in the data.\n\t *\n\t * If a Replicant with a given name in a given bundle namespace has already been declared,\n\t * the Replicant will automatically be assigned the existing value.\n\t *\n\t * Replicants must be declared in each context that wishes to use them. For instance,\n\t * declaring a replicant in an extension does not automatically make it available in a graphic.\n\t * The graphic must also declare it.\n\t *\n\t * By default Replicants will be saved to disk, meaning they will automatically be restored when NodeCG is restarted,\n\t * such as after an unexpected crash.\n\t * If you need to opt-out of this behaviour simply set `persistent: false` in the `opts` argument.\n\t *\n\t * As of NodeCG 0.8.4, Replicants can also be automatically validated against a JSON Schema that you provide.\n\t * See {@tutorial replicant-schemas} for more information.\n\t *\n\t * @param {string} name - The name of the replicant.\n\t * @param {string} [namespace] - The namespace to in which to look for this replicant. Defaults to the name of the current bundle.\n\t * @param {object} [opts] - The options for this replicant.\n\t * @param {*} [opts.defaultValue] - The default value to instantiate this Replicant with. The default value is only\n\t * applied if this Replicant has not previously been declared and if it has no persisted value.\n\t * @param {boolean} [opts.persistent=true] - Whether to persist the Replicant's value to disk on every change.\n\t * Persisted values are re-loaded on startup.\n\t * @param {number} [opts.persistenceInterval=DEFAULT_PERSISTENCE_INTERVAL] - Interval between each persistence, in milliseconds.\n\t * @param {string} [opts.schemaPath] - The filepath at which to look for a JSON Schema for this Replicant.\n\t * Defaults to `nodecg/bundles/${bundleName}/schemas/${replicantName}.json`. Please note that this default\n\t * path will be URIEncoded to ensure that it results in a valid filename.\n\t *\n\t * @example\n\t * const myRep = nodecg.Replicant('myRep', {defaultValue: 123});\n\t *\n\t * myRep.on('change', (newValue, oldValue) => {\n\t *     console.log(`myRep changed from ${oldValue} to ${newValue}`);\n\t * });\n\t *\n\t * myRep.value = 'Hello!';\n\t * myRep.value = {objects: 'work too!'};\n\t * myRep.value = {objects: {can: {be: 'nested!'}}};\n\t * myRep.value = ['Even', 'arrays', 'work!'];\n\t */\n\tReplicant<V, O extends NodeCG.Replicant.OptionsNoDefault = NodeCG.Replicant.OptionsNoDefault>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.OptionsNoDefault = NodeCG.Replicant.OptionsNoDefault>(\n\t\tname: string,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.OptionsNoDefault = NodeCG.Replicant.OptionsNoDefault>(\n\t\tname: string,\n\t\tnamespaceOrOpts?: string | O,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.OptionsWithDefault<V> = NodeCG.Replicant.OptionsWithDefault<V>>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.OptionsWithDefault<V> = NodeCG.Replicant.OptionsWithDefault<V>>(\n\t\tname: string,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.OptionsWithDefault<V> = NodeCG.Replicant.OptionsWithDefault<V>>(\n\t\tname: string,\n\t\tnamespaceOrOpts?: string | O,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>>(\n\t\tname: string,\n\t\tnamespace: string,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>>(\n\t\tname: string,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O>;\n\tReplicant<V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>>(\n\t\tname: string,\n\t\tnamespaceOrOpts?: string | O,\n\t\topts?: O,\n\t): AbstractReplicant<P, V, O> {\n\t\tlet namespace: string;\n\t\tif (typeof namespaceOrOpts === 'string') {\n\t\t\tnamespace = namespaceOrOpts;\n\t\t} else {\n\t\t\tnamespace = this.bundleName;\n\t\t}\n\n\t\tif (typeof namespaceOrOpts !== 'string') {\n\t\t\topts = namespaceOrOpts;\n\t\t}\n\n\t\tconst defaultOpts: Record<any, unknown> = {};\n\t\topts = opts ?? defaultOpts;\n\t\tif (typeof opts.schemaPath === 'undefined') {\n\t\t\topts.schemaPath = `bundles/${encodeURIComponent(namespace)}/schemas/${encodeURIComponent(name)}.json`;\n\t\t}\n\n\t\treturn this._replicantFactory(name, namespace, opts);\n\t}\n}\n","export type LoggerInterface = {\n\tname: string;\n\ttrace: (...args: any[]) => void;\n\tdebug: (...args: any[]) => void;\n\tinfo: (...args: any[]) => void;\n\twarn: (...args: any[]) => void;\n\terror: (...args: any[]) => void;\n\treplicants: (...args: any[]) => void;\n};\n\nexport enum LogLevel {\n\tTrace = 'verbose',\n\tDebug = 'debug',\n\tInfo = 'info',\n\tWarn = 'warn',\n\tError = 'error',\n\tSilent = 'silent',\n}\n","// This file contains code that is used in both server-side and client-side replicants.\n/* eslint-disable @typescript-eslint/no-dynamic-delete */\n// Packages\nimport type { ErrorObject, ValidateFunction } from 'ajv';\nimport clone from 'clone';\nimport objectPath from 'object-path';\n\n// Ours\nimport type { LoggerInterface } from './logger-interface';\nimport type { NodeCG } from '../types/nodecg';\nimport { TypedEmitter } from '../shared/typed-emitter';\nimport { compileJsonSchema, formatJsonSchemaErrors, isBrowser, stringifyError } from './utils';\n\nexport type ReplicantValue<P extends NodeCG.Platform, V, O, S extends boolean = false> = P extends 'server'\n\t? S extends true\n\t\t? V\n\t\t: O extends { defaultValue: infer D extends V }\n\t\t? D\n\t\t: V | undefined\n\t: (O extends { defaultValue: infer D extends V } ? D : V) | undefined;\n\ntype Events<P extends NodeCG.Platform, V, O, S extends boolean> = {\n\tchange: (\n\t\tnewVal: ReplicantValue<P, V, O, S>,\n\t\toldVal: ReplicantValue<P, V, O, S> | undefined,\n\t\toperations: Array<NodeCG.Replicant.Operation<ReplicantValue<P, V, O, S>>>,\n\t) => void;\n\tdeclared: (\n\t\tdata:\n\t\t\t| { value: ReplicantValue<P, V, O, S>; revision: number }\n\t\t\t| { value: ReplicantValue<P, V, O, S>; revision: number; schemaSum: string; schema: Record<string, any> },\n\t) => void;\n\tdeclarationRejected: (rejectReason: string) => void;\n\toperations: (params: {\n\t\tname: string;\n\t\tnamespace: string;\n\t\toperations: Array<NodeCG.Replicant.Operation<ReplicantValue<P, V, O, S>>>;\n\t\trevision: number;\n\t}) => void;\n\toperationsRejected: (rejectReason: string) => void;\n\tfullUpdate: (data: ReplicantValue<P, V, O, S>) => void;\n};\n\n/**\n * If you're wondering why some things are prefixed with \"_\",\n * but not marked as protected or private, this is because our Proxy\n * trap handlers need to access these parts of the Replicant internals,\n * but don't have access to private or protected members.\n *\n * So, we code this like its 2010 and just use \"_\" on some public members.\n */\nexport abstract class AbstractReplicant<\n\tP extends NodeCG.Platform,\n\tV,\n\tO extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>,\n\tS extends boolean = false,\n> extends TypedEmitter<Events<P, V, O, S>> {\n\tname: string;\n\n\tnamespace: string;\n\n\topts: O;\n\n\trevision = 0;\n\n\tlog!: LoggerInterface; // Gets assigned by implementing classes\n\n\tschema?: Record<string, any>;\n\n\tschemaSum?: string;\n\n\tstatus: 'undeclared' | 'declared' | 'declaring' = 'undeclared';\n\n\t// eslint-disable-next-line @typescript-eslint/ban-types\n\tvalidationErrors?: null | ErrorObject[] = [];\n\n\tprotected _value: ReplicantValue<P, V, O, S> | undefined;\n\n\tprotected _oldValue: ReplicantValue<P, V, O, S> | undefined;\n\n\tprotected _operationQueue: Array<NodeCG.Replicant.Operation<ReplicantValue<P, V, O, S>>> = [];\n\n\tprotected _pendingOperationFlush = false;\n\n\tconstructor(name: string, namespace: string, opts: O = {} as Record<any, unknown>) {\n\t\tsuper();\n\n\t\tif (!name || typeof name !== 'string') {\n\t\t\tthrow new Error('Must supply a name when instantiating a Replicant');\n\t\t}\n\n\t\tif (!namespace || typeof namespace !== 'string') {\n\t\t\tthrow new Error('Must supply a namespace when instantiating a Replicant');\n\t\t}\n\n\t\tif (typeof opts.persistent === 'undefined') {\n\t\t\topts.persistent = true;\n\t\t}\n\n\t\tif (typeof opts.persistenceInterval === 'undefined') {\n\t\t\topts.persistenceInterval = DEFAULT_PERSISTENCE_INTERVAL;\n\t\t}\n\n\t\tthis.name = name;\n\t\tthis.namespace = namespace;\n\t\tthis.opts = opts;\n\n\t\t// Prevents one-time change listeners from potentially being called twice.\n\t\t// https://github.com/nodecg/nodecg/issues/296\n\t\tconst originalOnce = this.once.bind(this);\n\t\tthis.once = (event: string, listener: (...params: any[]) => void) => {\n\t\t\tif (event === 'change' && this.status === 'declared') {\n\t\t\t\tlistener(this.value);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-confusing-void-expression\n\t\t\treturn originalOnce(event as any, listener);\n\t\t};\n\n\t\t/**\n\t\t * When a new \"change\" listener is added, chances are that the developer wants it to be initialized ASAP.\n\t\t * However, if this replicant has already been declared previously in this context, their \"change\"\n\t\t * handler will *not* get run until another change comes in, which may never happen for Replicants\n\t\t * that change very infrequently.\n\t\t * To resolve this, we immediately invoke all new \"change\" handlers if appropriate.\n\t\t */\n\t\tthis.on('newListener', (event, listener) => {\n\t\t\tif (event === 'change' && this.status === 'declared') {\n\t\t\t\tlistener(this.value);\n\t\t\t}\n\t\t});\n\t}\n\n\tabstract get value(): ReplicantValue<P, V, O, S>;\n\tabstract set value(newValue: ReplicantValue<P, V, O, S>);\n\n\t/**\n\t * If the operation is an array mutator method, call it on the target array with the operation arguments.\n\t * Else, handle it with objectPath.\n\t */\n\t_applyOperation(operation: NodeCG.Replicant.Operation<V>): boolean {\n\t\tignoreProxy(this);\n\n\t\tlet result;\n\t\tconst path = pathStrToPathArr(operation.path);\n\t\tif (ARRAY_MUTATOR_METHODS.includes(operation.method)) {\n\t\t\tif (typeof this.value !== 'object' || this.value === null) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`expected replicant \"${this.namespace}:${\n\t\t\t\t\t\tthis.name\n\t\t\t\t\t}\" to have a value with type \"object\", got \"${typeof this.value}\" instead`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst arr: unknown = objectPath.get(this.value as unknown as Record<string, unknown>, path);\n\t\t\tif (!Array.isArray(arr)) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`expected to find an array in replicant \"${this.namespace}:${this.name}\" at path \"${operation.path}\"`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line prefer-spread\n\t\t\tresult = arr[operation.method as any].apply(\n\t\t\t\tarr,\n\t\t\t\t'args' in operation && 'mutatorArgs' in operation.args ? operation.args.mutatorArgs : [],\n\t\t\t);\n\n\t\t\t// Recursively check for any objects that may have been added by the above method\n\t\t\t// and that need to be Proxied.\n\t\t\tproxyRecursive(this as AbstractReplicant<P, V, O>, arr, operation.path);\n\t\t} else {\n\t\t\tswitch (operation.method) {\n\t\t\t\tcase 'overwrite': {\n\t\t\t\t\tconst { newValue } = operation.args;\n\t\t\t\t\tthis[isBrowser() ? 'value' : '_value'] = proxyRecursive(this, newValue as any, operation.path);\n\t\t\t\t\tresult = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'add':\n\t\t\t\tcase 'update': {\n\t\t\t\t\tpath.push(operation.args.prop);\n\n\t\t\t\t\tlet { newValue } = operation.args;\n\t\t\t\t\tif (typeof newValue === 'object') {\n\t\t\t\t\t\tnewValue = proxyRecursive(this, newValue, pathArrToPathStr(path));\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = objectPath.set(this.value as any, path, newValue);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'delete':\n\t\t\t\t\t// Workaround for https://github.com/mariocasciaro/object-path/issues/69\n\t\t\t\t\tif (path.length === 0 || objectPath.has(this.value as any, path)) {\n\t\t\t\t\t\tconst target = objectPath.get(this.value as any, path);\n\t\t\t\t\t\tresult = delete target[operation.args.prop];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t/* istanbul ignore next */\n\t\t\t\tdefault:\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tthrow new Error(`Unexpected operation method \"${operation.method}\"`);\n\t\t\t}\n\t\t}\n\n\t\tresumeProxy(this as AbstractReplicant<P, V, O>);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Used to validate the new value of a replicant.\n\t *\n\t * This is a stub that will be replaced if a Schema is available.\n\t */\n\tvalidate: Validator = (): boolean => true;\n\n\t/**\n\t * Adds an operation to the operation queue, to be flushed at the end of the current tick.\n\t * @private\n\t */\n\tabstract _addOperation(operation: NodeCG.Replicant.Operation<V>): void;\n\n\t/**\n\t * Emits all queued operations via Socket.IO & empties this._operationQueue.\n\t * @private\n\t */\n\tabstract _flushOperations(): void;\n\n\t/**\n\t * Generates a JSON Schema validator function from the `schema` property of the provided replicant.\n\t * @param replicant {object} - The Replicant to perform the operation on.\n\t * @returns {function} - The generated validator function.\n\t */\n\tprotected _generateValidator(): Validator {\n\t\tconst { schema } = this;\n\t\tif (!schema) {\n\t\t\tthrow new Error(\"can't generate a validator for a replicant which lacks a schema\");\n\t\t}\n\n\t\tlet validate: ValidateFunction;\n\t\ttry {\n\t\t\tvalidate = compileJsonSchema(schema);\n\t\t} catch (error: unknown) {\n\t\t\tthrow new Error(\n\t\t\t\t`Error compiling JSON Schema for Replicant \"${this.namespace}:${this.name}\":\\n\\t${stringifyError(\n\t\t\t\t\terror,\n\t\t\t\t)}`,\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Validates a value against the current Replicant's schema.\n\t\t * Throws when the value fails validation.\n\t\t * @param [value=replicant.value] {*} - The value to validate. Defaults to the replicant's current value.\n\t\t * @param [opts] {Object}\n\t\t * @param [opts.throwOnInvalid = true] {Boolean} - Whether or not to immediately throw when the provided value fails validation against the schema.\n\t\t */\n\t\treturn function (\n\t\t\tthis: AbstractReplicant<P, V, O>,\n\t\t\tvalue: any = this.value,\n\t\t\t{ throwOnInvalid = true }: ValidatorOptions = {},\n\t\t) {\n\t\t\tconst valid = validate(value);\n\t\t\tif (!valid) {\n\t\t\t\tthis.validationErrors = validate.errors;\n\t\t\t\tif (throwOnInvalid) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Invalid value rejected for replicant \"${this.name}\" in namespace \"${\n\t\t\t\t\t\t\tthis.namespace\n\t\t\t\t\t\t}\":\\n${formatJsonSchemaErrors(schema, validate.errors)}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn valid;\n\t\t};\n\t}\n}\n\ntype Metadata<V, O extends NodeCG.Replicant.Options<V> = NodeCG.Replicant.Options<V>> = {\n\treplicant: AbstractReplicant<any, V, O>;\n\tpath: string;\n\tproxy: unknown;\n};\n\nexport type ValidatorOptions = {\n\tthrowOnInvalid?: boolean;\n};\n\nexport type Validator = (newValue: any, opts?: ValidatorOptions) => boolean;\n\nconst proxyMetadataMap = new WeakMap();\nconst metadataMap = new WeakMap<any, Metadata<any>>();\nconst proxySet = new WeakSet();\nconst ignoringProxy = new WeakSet<AbstractReplicant<any, any>>();\n\nexport const ARRAY_MUTATOR_METHODS = [\n\t'copyWithin',\n\t'fill',\n\t'pop',\n\t'push',\n\t'reverse',\n\t'shift',\n\t'sort',\n\t'splice',\n\t'unshift',\n];\n\n/**\n * The default persistence interval, in milliseconds.\n */\nconst DEFAULT_PERSISTENCE_INTERVAL = 100;\n\nexport function ignoreProxy(replicant: AbstractReplicant<any, any, NodeCG.Replicant.Options<any>, any>): void {\n\tignoringProxy.add(replicant);\n}\n\nexport function resumeProxy(replicant: AbstractReplicant<any, any, NodeCG.Replicant.Options<any>, any>): void {\n\tignoringProxy.delete(replicant);\n}\n\nexport function isIgnoringProxy(replicant: AbstractReplicant<any, any, NodeCG.Replicant.Options<any>, any>): boolean {\n\treturn ignoringProxy.has(replicant);\n}\n\nconst deleteTrap = function <T>(target: T, prop: keyof T): boolean | void {\n\tconst metadata = metadataMap.get(target);\n\tif (!metadata) {\n\t\tthrow new Error('arrived at delete trap without any metadata');\n\t}\n\n\tconst { replicant } = metadata;\n\n\tif (isIgnoringProxy(replicant)) {\n\t\treturn delete target[prop];\n\t}\n\n\t// If the target doesn't have this prop, return true.\n\tif (!{}.hasOwnProperty.call(target, prop)) {\n\t\treturn true;\n\t}\n\n\tif (replicant.schema) {\n\t\tconst valueClone = clone(replicant.value);\n\t\tconst targetClone = objectPath.get(valueClone, pathStrToPathArr(metadata.path));\n\t\tdelete targetClone[prop];\n\t\treplicant.validate(valueClone);\n\t}\n\n\treplicant._addOperation({ path: metadata.path, method: 'delete', args: { prop } });\n\tif (!isBrowser()) {\n\t\treturn delete target[prop];\n\t}\n};\n\nconst CHILD_ARRAY_HANDLER = {\n\tget<T>(target: T, prop: keyof T) {\n\t\tconst metadata = metadataMap.get(target);\n\t\tif (!metadata) {\n\t\t\tthrow new Error('arrived at get trap without any metadata');\n\t\t}\n\n\t\tconst { replicant } = metadata;\n\t\tif (isIgnoringProxy(replicant)) {\n\t\t\treturn target[prop];\n\t\t}\n\n\t\tif (\n\t\t\t{}.hasOwnProperty.call(Array.prototype, prop) &&\n\t\t\ttypeof Array.prototype[prop as any] === 'function' &&\n\t\t\ttarget[prop] === Array.prototype[prop as any] &&\n\t\t\tARRAY_MUTATOR_METHODS.includes(prop as any)\n\t\t) {\n\t\t\treturn (...args: any[]) => {\n\t\t\t\tif (replicant.schema) {\n\t\t\t\t\tconst valueClone = clone(replicant.value);\n\t\t\t\t\tconst targetClone = objectPath.get(valueClone, pathStrToPathArr(metadata.path));\n\t\t\t\t\t// eslint-disable-next-line prefer-spread\n\t\t\t\t\ttargetClone[prop].apply(targetClone, args);\n\t\t\t\t\treplicant.validate(valueClone);\n\t\t\t\t}\n\n\t\t\t\tif (isBrowser()) {\n\t\t\t\t\tmetadata.replicant._addOperation({\n\t\t\t\t\t\tpath: metadata.path,\n\t\t\t\t\t\tmethod: prop as any,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tmutatorArgs: Array.prototype.slice.call(args),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tignoreProxy(replicant);\n\t\t\t\t\tmetadata.replicant._addOperation({\n\t\t\t\t\t\tpath: metadata.path,\n\t\t\t\t\t\tmethod: prop as any,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tmutatorArgs: Array.prototype.slice.call(args),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst retValue = (target as any)[prop].apply(target, args);\n\t\t\t\t\tresumeProxy(replicant);\n\n\t\t\t\t\t// We have to re-proxy the target because the items could have been inserted.\n\t\t\t\t\tproxyRecursive(replicant, target, metadata.path);\n\n\t\t\t\t\t// TODO: This could leak a non-proxied object and cause bugs!\n\t\t\t\t\treturn retValue;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn target[prop];\n\t},\n\n\tset<T>(target: T, prop: keyof T, newValue: any) {\n\t\tif (target[prop] === newValue) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst metadata = metadataMap.get(target);\n\t\tif (!metadata) {\n\t\t\tthrow new Error('arrived at set trap without any metadata');\n\t\t}\n\n\t\tconst { replicant } = metadata;\n\n\t\tif (isIgnoringProxy(replicant)) {\n\t\t\ttarget[prop] = newValue;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (replicant.schema) {\n\t\t\tconst valueClone = clone(replicant.value);\n\t\t\tconst targetClone = objectPath.get(valueClone, pathStrToPathArr(metadata.path));\n\t\t\ttargetClone[prop] = newValue;\n\t\t\treplicant.validate(valueClone);\n\t\t}\n\n\t\t// It is crucial that this happen *before* the assignment below.\n\t\tif ({}.hasOwnProperty.call(target, prop)) {\n\t\t\treplicant._addOperation({\n\t\t\t\tpath: metadata.path,\n\t\t\t\tmethod: 'update',\n\t\t\t\targs: {\n\t\t\t\t\tprop: prop as string,\n\t\t\t\t\tnewValue,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\treplicant._addOperation({\n\t\t\t\tpath: metadata.path,\n\t\t\t\tmethod: 'add',\n\t\t\t\targs: {\n\t\t\t\t\tprop: prop as string,\n\t\t\t\t\tnewValue,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// If this Replicant is running in the server context, immediately apply the value.\n\t\tif (!isBrowser()) {\n\t\t\ttarget[prop] = proxyRecursive(metadata.replicant, newValue, joinPathParts(metadata.path, prop as string));\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tdeleteProperty: deleteTrap,\n};\n\nconst CHILD_OBJECT_HANDLER = {\n\tget<T>(target: T, prop: keyof T) {\n\t\tconst value = target[prop];\n\n\t\tconst tag = Object.prototype.toString.call(value);\n\t\tconst shouldBindProperty =\n\t\t\tprop !== 'constructor' &&\n\t\t\t(tag === '[object Function]' || tag === '[object AsyncFunction]' || tag === '[object GeneratorFunction]');\n\n\t\tif (shouldBindProperty) {\n\t\t\treturn (value as any).bind(target);\n\t\t}\n\n\t\treturn value;\n\t},\n\n\tset<T>(target: T, prop: keyof T, newValue: any) {\n\t\tif (target[prop] === newValue) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst metadata = metadataMap.get(target);\n\t\tif (!metadata) {\n\t\t\tthrow new Error('arrived at set trap without any metadata');\n\t\t}\n\n\t\tconst { replicant } = metadata;\n\n\t\tif (isIgnoringProxy(replicant)) {\n\t\t\ttarget[prop] = newValue;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (replicant.schema) {\n\t\t\tconst valueClone = clone(replicant.value);\n\t\t\tconst targetClone = objectPath.get(valueClone, pathStrToPathArr(metadata.path));\n\t\t\ttargetClone[prop] = newValue;\n\t\t\treplicant.validate(valueClone);\n\t\t}\n\n\t\t// It is crucial that this happen *before* the assignment below.\n\t\tif ({}.hasOwnProperty.call(target, prop)) {\n\t\t\treplicant._addOperation({\n\t\t\t\tpath: metadata.path,\n\t\t\t\tmethod: 'update',\n\t\t\t\targs: {\n\t\t\t\t\tprop: prop as string,\n\t\t\t\t\tnewValue,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\treplicant._addOperation({\n\t\t\t\tpath: metadata.path,\n\t\t\t\tmethod: 'add',\n\t\t\t\targs: {\n\t\t\t\t\tprop: prop as string,\n\t\t\t\t\tnewValue,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// If this Replicant is running in the server context, immediately apply the value.\n\t\tif (!isBrowser()) {\n\t\t\ttarget[prop] = proxyRecursive(metadata.replicant, newValue, joinPathParts(metadata.path, prop as string));\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tdeleteProperty: deleteTrap,\n};\n\n/**\n * Recursively Proxies an Array or Object. Does nothing to primitive values.\n * @param replicant {object} - The Replicant in which to do the work.\n * @param value {*} - The value to recursively Proxy.\n * @param path {string} - The objectPath to this value.\n * @returns {*} - The recursively Proxied value (or just `value` unchanged, if `value` is a primitive)\n * @private\n */\nexport function proxyRecursive<T>(\n\treplicant: AbstractReplicant<any, any, NodeCG.Replicant.Options<any>, any>,\n\tvalue: T,\n\tpath: string,\n): T {\n\tif (typeof value === 'object' && value !== null) {\n\t\tlet p;\n\n\t\tassertSingleOwner(replicant, value);\n\n\t\t// If \"value\" is already a Proxy, don't re-proxy it.\n\t\tif (proxySet.has(value as any)) {\n\t\t\tp = value;\n\t\t\tconst metadata = proxyMetadataMap.get(value as any);\n\t\t\tmetadata.path = path; // Update the path, as it may have changed.\n\t\t} else if (metadataMap.has(value)) {\n\t\t\tconst metadata = metadataMap.get(value);\n\t\t\tif (!metadata) {\n\t\t\t\tthrow new Error('metadata unexpectedly not found');\n\t\t\t}\n\n\t\t\tp = metadata.proxy;\n\t\t\tmetadata.path = path; // Update the path, as it may have changed.\n\t\t} else {\n\t\t\tconst handler = Array.isArray(value) ? CHILD_ARRAY_HANDLER : CHILD_OBJECT_HANDLER;\n\t\t\tp = new Proxy(value as any, handler as any);\n\t\t\tproxySet.add(p);\n\t\t\tconst metadata = {\n\t\t\t\treplicant,\n\t\t\t\tpath,\n\t\t\t\tproxy: p,\n\t\t\t};\n\t\t\tmetadataMap.set(value, metadata);\n\t\t\tproxyMetadataMap.set(p, metadata);\n\t\t}\n\n\t\tfor (const key in value) {\n\t\t\t/* istanbul ignore if */\n\t\t\tif (!{}.hasOwnProperty.call(value, key)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst escapedKey = key.replace(/\\//g, '~1');\n\t\t\tif (path) {\n\t\t\t\tconst joinedPath = joinPathParts(path, escapedKey);\n\t\t\t\tvalue[key] = proxyRecursive(replicant, value[key], joinedPath);\n\t\t\t} else {\n\t\t\t\tvalue[key] = proxyRecursive(replicant, value[key], escapedKey);\n\t\t\t}\n\t\t}\n\n\t\treturn p;\n\t}\n\n\treturn value;\n}\n\nfunction joinPathParts(part1: string, part2: string): string {\n\treturn part1.endsWith('/') ? `${part1}${part2}` : `${part1}/${part2}`;\n}\n\n/**\n * Converts a string path (/a/b/c) to an array path ['a', 'b', 'c']\n * @param path {String} - The path to convert.\n * @returns {Array} - The converted path.\n */\nfunction pathStrToPathArr(path: string): string[] {\n\tconst pathArr = path\n\t\t.substr(1)\n\t\t.split('/')\n\t\t.map((part) =>\n\t\t\t// De-tokenize '/' characters in path name\n\t\t\tpart.replace(/~1/g, '/'),\n\t\t);\n\n\t// For some reason, path arrays whose only item is an empty string cause errors.\n\t// In this case, we replace the path with an empty array, which seems to be fine.\n\tif (pathArr.length === 1 && pathArr[0] === '') {\n\t\treturn [];\n\t}\n\n\treturn pathArr;\n}\n\n/**\n * Converts an array path ['a', 'b', 'c'] to a string path /a/b/c)\n * @param path {Array} - The path to convert.\n * @returns {String} - The converted path.\n */\nfunction pathArrToPathStr(path: string[]): string {\n\tconst strPath = path.join('/');\n\tif (!strPath.startsWith('/')) {\n\t\treturn `/${strPath}`;\n\t}\n\n\treturn strPath;\n}\n\n/**\n * Throws an exception if an object belongs to more than one Replicant.\n * @param replicant {object} - The Replicant that this value should belong to.\n * @param value {*} - The value to check ownership of.\n */\nfunction assertSingleOwner(replicant: AbstractReplicant<any, any>, value: any): void {\n\tlet metadata: Metadata<any>;\n\tif (proxySet.has(value)) {\n\t\tmetadata = proxyMetadataMap.get(value);\n\t} else if (metadataMap.has(value)) {\n\t\tmetadata = metadataMap.get(value)!;\n\t} else {\n\t\t// If there's no metadata for this value, then it doesn't belong to any Replicants yet,\n\t\t// and we're okay to continue.\n\t\treturn;\n\t}\n\n\tif (metadata.replicant !== replicant) {\n\t\tthrow new Error(\n\t\t\t`This object belongs to another Replicant, ${metadata.replicant.namespace}::${metadata.replicant.name}.` +\n\t\t\t\t`\\nA given object cannot belong to multiple Replicants. Object value:\\n${JSON.stringify(\n\t\t\t\t\tvalue,\n\t\t\t\t\tnull,\n\t\t\t\t\t2,\n\t\t\t\t)}`,\n\t\t);\n\t}\n}\n","// Native\nimport { EventEmitter } from 'events';\n\ntype Builtins = {\n\tnewListener(event: string, listener: EventReceiver<unknown>): void;\n};\n\nexport type EventMap = Record<string, any>;\nexport type EventKey<T extends EventMap> = string & keyof T;\nexport type EventReceiver<T> = (params: T) => void;\n\nexport class TypedEmitter<T extends EventMap> {\n\treadonly _emitter = new EventEmitter();\n\n\taddListener<K extends EventKey<T & Builtins>>(eventName: K, fn: (T & Builtins)[K]): void {\n\t\tthis._emitter.addListener(eventName, fn);\n\t}\n\n\ton<K extends EventKey<T & Builtins>>(eventName: K, fn: (T & Builtins)[K]): void {\n\t\tthis._emitter.on(eventName, fn);\n\t}\n\n\toff<K extends EventKey<T & Builtins>>(eventName: K, fn: (T & Builtins)[K]): void {\n\t\tthis._emitter.off(eventName, fn);\n\t}\n\n\tremoveListener<K extends EventKey<T & Builtins>>(eventName: K, fn: (T & Builtins)[K]): void {\n\t\tthis._emitter.removeListener(eventName, fn);\n\t}\n\n\temit<K extends EventKey<T & Builtins>>(eventName: K, ...params: Parameters<(T & Builtins)[K]>): void {\n\t\tthis._emitter.emit(eventName, ...params);\n\t}\n\n\tonce<K extends EventKey<T & Builtins>>(eventName: K, fn: (T & Builtins)[K]): void {\n\t\tthis._emitter.once(eventName, fn);\n\t}\n\n\tsetMaxListeners(max: number): void {\n\t\tthis._emitter.setMaxListeners(max);\n\t}\n\n\tlistenerCount(eventName: string): number {\n\t\treturn this._emitter.listenerCount(eventName);\n\t}\n\n\tlisteners<K extends EventKey<T & Builtins>>(eventName: K): Array<(T & Builtins)[K]> {\n\t\treturn this._emitter.listeners(eventName) as any;\n\t}\n\n\t// We intentionally don't expose removeAllListeners because it would break Replicants when used.\n}\n","// Packages\nimport AjvDraft07, { type ValidateFunction, type Options, type ErrorObject } from 'ajv';\nimport AjvDraft04 from 'ajv-draft-04';\nimport Ajv2019 from 'ajv/dist/2019';\nimport Ajv2020 from 'ajv/dist/2020';\nimport addFormats from 'ajv-formats';\nimport defaults from '@nodecg/json-schema-defaults';\nimport { stringifyError } from '.';\n\nconst options: Options = {\n\tallErrors: true,\n\tverbose: true,\n\tstrict: undefined,\n\tstrictSchema: true,\n\tstrictNumbers: true,\n\tstrictTypes: true,\n\tstrictTuples: true,\n\tstrictRequired: false,\n};\n\nconst ajv = {\n\tdraft04: addFormats(new AjvDraft04(options)),\n\tdraft07: addFormats(new AjvDraft07(options)),\n\t'draft2019-09': addFormats(new Ajv2019(options)),\n\t'draft2020-12': addFormats(new Ajv2020(options)),\n};\n\nexport function compileJsonSchema(schema: Record<any, unknown>): ValidateFunction {\n\tconst schemaVersion = extractSchemaVersion(schema);\n\tif (schemaVersion.includes('draft-04')) {\n\t\treturn ajv.draft04.compile(schema);\n\t}\n\n\tif (schemaVersion.includes('draft-07')) {\n\t\treturn ajv.draft07.compile(schema);\n\t}\n\n\tif (schemaVersion.includes('draft-2019-09')) {\n\t\treturn ajv['draft2019-09'].compile(schema);\n\t}\n\n\tif (schemaVersion.includes('draft-2020-12')) {\n\t\treturn ajv['draft2020-12'].compile(schema);\n\t}\n\n\tthrow new Error(`Unsupported JSON Schema version \"${schemaVersion}\"`);\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function formatJsonSchemaErrors(schema: Record<any, unknown>, errors?: ErrorObject[] | null): string {\n\tconst schemaVersion = extractSchemaVersion(schema);\n\tif (schemaVersion.includes('draft-04')) {\n\t\treturn ajv.draft04.errorsText(errors).replace(/^data\\//gm, '');\n\t}\n\n\tif (schemaVersion.includes('draft-07')) {\n\t\treturn ajv.draft07.errorsText(errors).replace(/^data\\//gm, '');\n\t}\n\n\tif (schemaVersion.includes('draft-2019-09')) {\n\t\treturn ajv['draft2019-09'].errorsText(errors).replace(/^data\\//gm, '');\n\t}\n\n\tif (schemaVersion.includes('draft-2020-12')) {\n\t\treturn ajv['draft2020-12'].errorsText(errors).replace(/^data\\//gm, '');\n\t}\n\n\tthrow new Error(`Unsupported JSON Schema version \"${schemaVersion}\"`);\n}\n\nexport function getSchemaDefault(schema: Record<any, unknown>, labelForDebugging: string): unknown {\n\ttry {\n\t\treturn defaults(schema);\n\t} catch (error: unknown) {\n\t\tthrow new Error(\n\t\t\t`Error generating default value(s) for schema \"${labelForDebugging}\":\\n\\t${stringifyError(error)}`,\n\t\t);\n\t}\n}\n\nfunction extractSchemaVersion(schema: Record<any, unknown>): string {\n\t// For backwards compat, we default to draft-04.\n\tconst defaultVersion = 'https://json-schema.org/draft-04/schema';\n\tconst extractedVersion = schema.$schema;\n\treturn typeof extractedVersion === 'string' ? extractedVersion : defaultVersion;\n}\n","export * from './compileJsonSchema';\n\n/**\n * Make a string out of an error (or other equivalents),\n * including any additional data such as stack trace if available.\n * Safe to use on unknown inputs.\n */\nexport function stringifyError(error: unknown, noStack = false): string {\n\tconst o = stringifyErrorInner(error);\n\tif (noStack || !o.stack) {\n\t\treturn o.message;\n\t}\n\n\treturn `${o.message}, ${o.stack}`;\n}\n\nexport function stringifyErrorInner(error: unknown): {\n\tmessage: string;\n\tstack: string | undefined;\n} {\n\tlet message: string | undefined;\n\tlet stack: string | undefined;\n\tif (typeof error === 'string') {\n\t\tmessage = error;\n\t} else if (error === null) {\n\t\tmessage = 'null';\n\t} else if (error === undefined) {\n\t\tmessage = 'undefined';\n\t} else if (error && typeof error === 'object') {\n\t\tif (typeof (error as any).error === 'object' && (error as any).error.message) {\n\t\t\tmessage = (error as any).error.message;\n\t\t\tstack = (error as any).error.stack;\n\t\t} else if ((error as any).reason) {\n\t\t\tif ((error as any).reason.message) {\n\t\t\t\tmessage = (error as any).reason.message;\n\t\t\t\tstack = (error as any).reason.stack || (error as any).reason.reason;\n\t\t\t} else {\n\t\t\t\t// Is a Meteor.Error\n\t\t\t\tmessage = (error as any).reason;\n\t\t\t\tstack = (error as Error).stack;\n\t\t\t}\n\t\t} else if ((error as Error).message) {\n\t\t\t// Is an Error\n\t\t\tmessage = (error as Error).message;\n\t\t\tstack = (error as Error).stack;\n\t\t} else if ((error as any).details) {\n\t\t\tmessage = (error as any).details;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\t// Try to stringify the object:\n\t\t\t\tmessage = JSON.stringify(error);\n\t\t\t} catch (e: unknown) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-base-to-string\n\t\t\t\tmessage = `${error} (stringifyError: ${e})`;\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// eslint-disable-next-line @typescript-eslint/no-base-to-string\n\t\tmessage = `${error}`;\n\t}\n\n\tmessage = `${message}`;\n\n\treturn {\n\t\tmessage,\n\t\tstack,\n\t};\n}\n\nexport function isBrowser(): boolean {\n\treturn typeof globalThis.window !== 'undefined';\n}\n","import path from 'path';\nimport fs from 'fs';\n\nconst rootPath = {\n\tpath: findRootPath(__dirname),\n};\n\nfunction findRootPath(dir: string): string {\n\tconst filePath = path.join(dir, 'package.json');\n\tif (fs.existsSync(filePath)) {\n\t\treturn path.dirname(filePath);\n\t}\n\n\tconst parentDir = path.dirname(dir);\n\tif (dir === parentDir) {\n\t\treturn '';\n\t}\n\n\treturn findRootPath(parentDir);\n}\n\nexport default rootPath;\n","// Ours\nimport type { NodeCG } from './nodecg';\n\n// Packages\nimport type { Namespace, Server, Socket as ServerSocket } from 'socket.io';\nimport type { Socket as ClientSocket } from 'socket.io-client';\n\ninterface NodeCallback<T = undefined> {\n\t(err: string, response: undefined): void;\n\t(err: undefined, response: T): void;\n}\n\nexport enum UnAuthErrCode {\n\tCredentialsBadFormat = 'credentials_bad_format',\n\tCredentialsRequired = 'credentials_required',\n\tInternalError = 'internal_error',\n\tInvalidToken = 'invalid_token',\n\tTokenRevoked = 'token_invalidated',\n\tInvalidSession = 'invalid_session',\n}\n\nexport type ProtocolError = {\n\tmessage: string;\n\tcode: UnAuthErrCode;\n\ttype: string;\n};\n\nexport type GraphicRegRequest = {\n\ttimestamp: number;\n\tpathName: string;\n\tbundleName: string;\n\tbundleVersion: string;\n\tbundleGit: NodeCG.Bundle.GitData;\n};\n\nexport interface ServerToClientEvents {\n\tprotocol_error: (error: ProtocolError) => void;\n\t'graphic:bundleRefresh': (bundleName: string) => void;\n\t'graphic:refreshAll': (graphic: NodeCG.Bundle.Graphic) => void;\n\t'graphic:refresh': (graphicInstance: NodeCG.GraphicsInstance) => void;\n\t'graphic:kill': (graphicInstance: NodeCG.GraphicsInstance) => void;\n\t'replicant:operations': (data: {\n\t\tname: string;\n\t\tnamespace: string;\n\t\trevision: number;\n\t\toperations: Array<NodeCG.Replicant.Operation<any>>;\n\t}) => void;\n\tmessage: (data: { messageName: string; bundleName: string; content: unknown }) => void;\n}\n\nexport interface ClientToServerEvents {\n\tregenerateToken: (callback: NodeCallback) => Promise<void>;\n\t'graphic:registerSocket': (request: GraphicRegRequest, callback: NodeCallback<boolean>) => void;\n\t'graphic:queryAvailability': (request: string, callback: NodeCallback<boolean>) => void;\n\t'graphic:requestBundleRefresh': (request: string, callback: NodeCallback) => void;\n\t'graphic:requestRefreshAll': (request: NodeCG.Bundle.Graphic, callback: NodeCallback) => void;\n\t'graphic:requestRefresh': (request: NodeCG.GraphicsInstance, callback: NodeCallback) => void;\n\t'graphic:requestKill': (request: NodeCG.GraphicsInstance, callback: NodeCallback) => void;\n\t'replicant:declare': (\n\t\trequest: {\n\t\t\tname: string;\n\t\t\tnamespace: string;\n\t\t\topts: NodeCG.Replicant.Options<any>;\n\t\t},\n\t\tcallback: NodeCallback<\n\t\t\t| {\n\t\t\t\t\tvalue: any;\n\t\t\t\t\trevision: number;\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tvalue: any;\n\t\t\t\t\trevision: number;\n\t\t\t\t\tschema: Record<string, any>;\n\t\t\t\t\tschemaSum: string;\n\t\t\t  }\n\t\t>,\n\t) => void;\n\t'replicant:proposeOperations': (\n\t\trequest:\n\t\t\t| {\n\t\t\t\t\tname: string;\n\t\t\t\t\tnamespace: string;\n\t\t\t\t\toperations: Array<NodeCG.Replicant.Operation<any>>;\n\t\t\t\t\topts: NodeCG.Replicant.Options<any>;\n\t\t\t\t\trevision: number;\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tname: string;\n\t\t\t\t\tnamespace: string;\n\t\t\t\t\toperations: Array<NodeCG.Replicant.Operation<any>>;\n\t\t\t\t\topts: NodeCG.Replicant.Options<any>;\n\t\t\t\t\trevision: number;\n\t\t\t\t\tschema: Record<string, any>;\n\t\t\t\t\tschemaSum: string;\n\t\t\t  },\n\t\tcallback: (\n\t\t\trejectReason: string | undefined,\n\t\t\tdata: {\n\t\t\t\tvalue: any;\n\t\t\t\trevision: number;\n\t\t\t\tschema?: Record<string, any>;\n\t\t\t\tschemaSum?: string;\n\t\t\t},\n\t\t) => void,\n\t) => void;\n\t'replicant:read': (\n\t\trequest: {\n\t\t\tname: string;\n\t\t\tnamespace: string;\n\t\t},\n\t\tcallback: NodeCallback<unknown>,\n\t) => void;\n\tmessage: (\n\t\trequest: {\n\t\t\tmessageName: string;\n\t\t\tbundleName: string;\n\t\t\tcontent: unknown;\n\t\t},\n\t\tcallback: NodeCallback<unknown>,\n\t) => void;\n\tjoinRoom: (request: string, callback: NodeCallback) => void;\n}\n\nexport type TypedClientSocket = ClientSocket<ServerToClientEvents, ClientToServerEvents>;\nexport type TypedSocketServer = Server<ClientToServerEvents, ServerToClientEvents>;\nexport type RootNS = Namespace<ClientToServerEvents, ServerToClientEvents>;\nexport type TypedServerSocket = ServerSocket<ClientToServerEvents, ServerToClientEvents>;\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = \"./src/server/server sync recursive\";\nmodule.exports = webpackEmptyContext;","module.exports = require(\"@nodecg/json-schema-defaults\");","module.exports = require(\"@sentry/node\");","module.exports = require(\"ajv\");","module.exports = require(\"ajv-draft-04\");","module.exports = require(\"ajv-formats\");","module.exports = require(\"ajv/dist/2019\");","module.exports = require(\"ajv/dist/2020\");","module.exports = require(\"body-parser\");","module.exports = require(\"cheerio\");","module.exports = require(\"chokidar\");","module.exports = require(\"clone\");","module.exports = require(\"compression\");","module.exports = require(\"connect-typeorm\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"cosmiconfig\");","module.exports = require(\"events\");","module.exports = require(\"express\");","module.exports = require(\"express-session\");","module.exports = require(\"express-transform-bare-module-specifiers\");","module.exports = require(\"extend\");","module.exports = require(\"fast-memoize\");","module.exports = require(\"fs-extra\");","module.exports = require(\"git-rev-sync\");","module.exports = require(\"httpolyglot\");","module.exports = require(\"is-error\");","module.exports = require(\"joi\");","module.exports = require(\"json-ptr\");","module.exports = require(\"json-schema-lib\");","module.exports = require(\"json-schema-lib/lib/util/stripHash\");","module.exports = require(\"json-schema-lib/lib/util/typeOf\");","module.exports = require(\"lodash.debounce\");","module.exports = require(\"lodash.template\");","module.exports = require(\"multer\");","module.exports = require(\"node-fetch-commonjs\");","module.exports = require(\"object-path\");","module.exports = require(\"passport\");","module.exports = require(\"passport-discord\");","module.exports = require(\"passport-local\");","module.exports = require(\"passport-steam\");","module.exports = require(\"passport-twitch-helix\");","module.exports = require(\"reflect-metadata\");","module.exports = require(\"semver\");","module.exports = require(\"serialize-error\");","module.exports = require(\"sha1\");","module.exports = require(\"sha1-file\");","module.exports = require(\"socket.io\");","module.exports = require(\"typeorm\");","module.exports = require(\"util\");","module.exports = require(\"uuid\");","module.exports = require(\"winston\");","module.exports = require(\"yargs\");","module.exports = require(\"crypto\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"node:process\");","module.exports = require(\"os\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/server/bootstrap.ts\");\n",""],"names":["semver","require","satisfies","process","versions","node","console","warn"],"sourceRoot":""}