{"version":3,"file":"migration/1669424617013-initialize.js","mappings":"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","sources":["webpack://nodecg/webpack/universalModuleDefinition","webpack://nodecg/./src/server/database/migration/1669424617013-initialize.ts","webpack://nodecg/webpack/before-startup","webpack://nodecg/webpack/startup","webpack://nodecg/webpack/after-startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(global, () => {\nreturn ","import { type MigrationInterface, type QueryRunner } from 'typeorm';\n\nexport class initialize1669424617013 implements MigrationInterface {\n\tname = 'initialize1669424617013';\n\n\tpublic async up(queryRunner: QueryRunner): Promise<void> {\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"permission\" (\"id\" varchar PRIMARY KEY NOT NULL, \"name\" text NOT NULL, \"entityId\" text NOT NULL, \"actions\" integer NOT NULL, \"roleId\" varchar)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"role\" (\"id\" varchar PRIMARY KEY NOT NULL, \"name\" text NOT NULL, CONSTRAINT \"UQ_ae4578dcaed5adff96595e61660\" UNIQUE (\"name\"))`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"identity\" (\"id\" varchar PRIMARY KEY NOT NULL, \"provider_type\" text NOT NULL, \"provider_hash\" text NOT NULL, \"provider_access_token\" text, \"provider_refresh_token\" text, \"userId\" varchar)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"user\" (\"id\" varchar PRIMARY KEY NOT NULL, \"created_at\" datetime NOT NULL DEFAULT (datetime('now')), \"name\" text NOT NULL)`,\n\t\t);\n\t\tawait queryRunner.query(`CREATE TABLE \"api_key\" (\"secret_key\" varchar PRIMARY KEY NOT NULL, \"userId\" varchar)`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"replicant\" (\"namespace\" text NOT NULL, \"name\" text NOT NULL, \"value\" text NOT NULL, PRIMARY KEY (\"namespace\", \"name\"))`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"session\" (\"expiredAt\" bigint NOT NULL, \"id\" varchar(255) PRIMARY KEY NOT NULL, \"json\" text NOT NULL, \"destroyedAt\" datetime)`,\n\t\t);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_28c5d1d16da7908c97c9bc2f74\" ON \"session\" (\"expiredAt\") `);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"user_roles_role\" (\"userId\" varchar NOT NULL, \"roleId\" varchar NOT NULL, PRIMARY KEY (\"userId\", \"roleId\"))`,\n\t\t);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_5f9286e6c25594c6b88c108db7\" ON \"user_roles_role\" (\"userId\") `);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_4be2f7adf862634f5f803d246b\" ON \"user_roles_role\" (\"roleId\") `);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"temporary_permission\" (\"id\" varchar PRIMARY KEY NOT NULL, \"name\" text NOT NULL, \"entityId\" text NOT NULL, \"actions\" integer NOT NULL, \"roleId\" varchar, CONSTRAINT \"FK_cdb4db95384a1cf7a837c4c683e\" FOREIGN KEY (\"roleId\") REFERENCES \"role\" (\"id\") ON DELETE NO ACTION ON UPDATE NO ACTION)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"temporary_permission\"(\"id\", \"name\", \"entityId\", \"actions\", \"roleId\") SELECT \"id\", \"name\", \"entityId\", \"actions\", \"roleId\" FROM \"permission\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"permission\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"temporary_permission\" RENAME TO \"permission\"`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"temporary_identity\" (\"id\" varchar PRIMARY KEY NOT NULL, \"provider_type\" text NOT NULL, \"provider_hash\" text NOT NULL, \"provider_access_token\" text, \"provider_refresh_token\" text, \"userId\" varchar, CONSTRAINT \"FK_12915039d2868ab654567bf5181\" FOREIGN KEY (\"userId\") REFERENCES \"user\" (\"id\") ON DELETE NO ACTION ON UPDATE NO ACTION)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"temporary_identity\"(\"id\", \"provider_type\", \"provider_hash\", \"provider_access_token\", \"provider_refresh_token\", \"userId\") SELECT \"id\", \"provider_type\", \"provider_hash\", \"provider_access_token\", \"provider_refresh_token\", \"userId\" FROM \"identity\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"identity\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"temporary_identity\" RENAME TO \"identity\"`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"temporary_api_key\" (\"secret_key\" varchar PRIMARY KEY NOT NULL, \"userId\" varchar, CONSTRAINT \"FK_277972f4944205eb29127f9bb6c\" FOREIGN KEY (\"userId\") REFERENCES \"user\" (\"id\") ON DELETE NO ACTION ON UPDATE NO ACTION)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"temporary_api_key\"(\"secret_key\", \"userId\") SELECT \"secret_key\", \"userId\" FROM \"api_key\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"api_key\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"temporary_api_key\" RENAME TO \"api_key\"`);\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_5f9286e6c25594c6b88c108db7\"`);\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_4be2f7adf862634f5f803d246b\"`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"temporary_user_roles_role\" (\"userId\" varchar NOT NULL, \"roleId\" varchar NOT NULL, CONSTRAINT \"FK_5f9286e6c25594c6b88c108db77\" FOREIGN KEY (\"userId\") REFERENCES \"user\" (\"id\") ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT \"FK_4be2f7adf862634f5f803d246b8\" FOREIGN KEY (\"roleId\") REFERENCES \"role\" (\"id\") ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY (\"userId\", \"roleId\"))`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"temporary_user_roles_role\"(\"userId\", \"roleId\") SELECT \"userId\", \"roleId\" FROM \"user_roles_role\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"user_roles_role\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"temporary_user_roles_role\" RENAME TO \"user_roles_role\"`);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_5f9286e6c25594c6b88c108db7\" ON \"user_roles_role\" (\"userId\") `);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_4be2f7adf862634f5f803d246b\" ON \"user_roles_role\" (\"roleId\") `);\n\t}\n\n\tpublic async down(queryRunner: QueryRunner): Promise<void> {\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_4be2f7adf862634f5f803d246b\"`);\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_5f9286e6c25594c6b88c108db7\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"user_roles_role\" RENAME TO \"temporary_user_roles_role\"`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"user_roles_role\" (\"userId\" varchar NOT NULL, \"roleId\" varchar NOT NULL, PRIMARY KEY (\"userId\", \"roleId\"))`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"user_roles_role\"(\"userId\", \"roleId\") SELECT \"userId\", \"roleId\" FROM \"temporary_user_roles_role\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"temporary_user_roles_role\"`);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_4be2f7adf862634f5f803d246b\" ON \"user_roles_role\" (\"roleId\") `);\n\t\tawait queryRunner.query(`CREATE INDEX \"IDX_5f9286e6c25594c6b88c108db7\" ON \"user_roles_role\" (\"userId\") `);\n\t\tawait queryRunner.query(`ALTER TABLE \"api_key\" RENAME TO \"temporary_api_key\"`);\n\t\tawait queryRunner.query(`CREATE TABLE \"api_key\" (\"secret_key\" varchar PRIMARY KEY NOT NULL, \"userId\" varchar)`);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"api_key\"(\"secret_key\", \"userId\") SELECT \"secret_key\", \"userId\" FROM \"temporary_api_key\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"temporary_api_key\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"identity\" RENAME TO \"temporary_identity\"`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"identity\" (\"id\" varchar PRIMARY KEY NOT NULL, \"provider_type\" text NOT NULL, \"provider_hash\" text NOT NULL, \"provider_access_token\" text, \"provider_refresh_token\" text, \"userId\" varchar)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"identity\"(\"id\", \"provider_type\", \"provider_hash\", \"provider_access_token\", \"provider_refresh_token\", \"userId\") SELECT \"id\", \"provider_type\", \"provider_hash\", \"provider_access_token\", \"provider_refresh_token\", \"userId\" FROM \"temporary_identity\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"temporary_identity\"`);\n\t\tawait queryRunner.query(`ALTER TABLE \"permission\" RENAME TO \"temporary_permission\"`);\n\t\tawait queryRunner.query(\n\t\t\t`CREATE TABLE \"permission\" (\"id\" varchar PRIMARY KEY NOT NULL, \"name\" text NOT NULL, \"entityId\" text NOT NULL, \"actions\" integer NOT NULL, \"roleId\" varchar)`,\n\t\t);\n\t\tawait queryRunner.query(\n\t\t\t`INSERT INTO \"permission\"(\"id\", \"name\", \"entityId\", \"actions\", \"roleId\") SELECT \"id\", \"name\", \"entityId\", \"actions\", \"roleId\" FROM \"temporary_permission\"`,\n\t\t);\n\t\tawait queryRunner.query(`DROP TABLE \"temporary_permission\"`);\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_4be2f7adf862634f5f803d246b\"`);\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_5f9286e6c25594c6b88c108db7\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"user_roles_role\"`);\n\t\tawait queryRunner.query(`DROP INDEX \"IDX_28c5d1d16da7908c97c9bc2f74\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"session\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"replicant\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"api_key\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"user\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"identity\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"role\"`);\n\t\tawait queryRunner.query(`DROP TABLE \"permission\"`);\n\t}\n}\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[\"./src/server/database/migration/1669424617013-initialize.ts\"](0, __webpack_exports__);\n",""],"names":[],"sourceRoot":""}